{
  "title": "Replace Comment With Assertion",
  "story": [
    {
      "type": "html",
      "text": "A refactoring in which you change a comment into an assertion. Described as [[Introduce Assertion]] in [[Martin Fowler]]'s excellent book, [[Refactoring Improving The Design Of Existing Code]]. See [http://www.refactoring.com/catalog/introduceAssertion.html www.refactoring.com] for his example.",
      "id": "bad5716ab17da77954667447525d8256"
    },
    {
      "type": "html",
      "text": "\n[[Martin Fowler]]'s use of [[Introduce Assertion]] is better than [[Replace Comment With Assertion]], because it applies even when there is no comment (but there should have been).",
      "id": "8383713c66836b385a10afff8c5b51f6"
    },
    {
      "type": "html",
      "text": "<b>Example:</b>",
      "id": "ee01f4ad3bd3091bf0c7ebb46b5e2deb"
    },
    {
      "type": "html",
      "text": "\nBefore:",
      "id": "cb164125202cd5cf97146527b70bb01d"
    },
    {
      "type": "code",
      "text": " // value must not be negative\n public double squareRootOf(int value) {\n   ''...square root algorithm...''\n }",
      "id": "bef334c7d9ed6b4974b6983495963dfe"
    },
    {
      "type": "html",
      "text": "After:",
      "id": "049441134dae92ff0cd8dc633108dfd7"
    },
    {
      "type": "code",
      "text": " public double squareRootOf(int value) {\n   Assert.isTrue(value >= 0);\n   ''...square root algorithm...''\n }",
      "id": "e77ba3ebbf0ba86043678c1e898b3720"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "f0f640194600dff9ae2eca0d6c722d05"
    },
    {
      "type": "html",
      "text": "Here, we could replace comment with type.",
      "id": "29177b9554dbb383acc594a22503fc11"
    },
    {
      "type": "code",
      "text": " public double squareRootOf(unsigned int value) {\n   ''...square root algorithm...''\n }",
      "id": "311d16d271a0bd8b482afbbc9fd1e04f"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "f0f640194600dff9ae2eca0d6c722d05"
    },
    {
      "type": "html",
      "text": "That probably isn't what you want. It allows code like",
      "id": "34683ba7270ea4e6996cafeb2583c24d"
    },
    {
      "type": "code",
      "text": "  double root = squareRootOf(-1);",
      "id": "39a17b5e2eaeae67cf56e18965e831c8"
    },
    {
      "type": "html",
      "text": "\nto compile and run quietly. The -1 is quietly cast to unsigned int, and then the square root is taken:",
      "id": "3c521fab066a0840fad0dd527c314fd7"
    },
    {
      "type": "code",
      "text": "  double root = squareRootOf((unsigned int) -1); // square root of 0xFFFFFFFE",
      "id": "60b0cd7587ee95bdaf29ee537bed4751"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "f0f640194600dff9ae2eca0d6c722d05"
    },
    {
      "type": "html",
      "text": "I'm going to argue that [[Replace Comment With Assertion]] is not necessarily a universal [[Good Thing]], and in fact is not my interpretation of [[Martin Fowler]]'s idea - there is a significant difference between the words \"introduce\" and \"replace\".",
      "id": "e95b2e2c04d86fe6ff9c529c4205e3ce"
    },
    {
      "type": "html",
      "text": "\nSometimes, it can be difficult to assert a specific condition. The example given above seems to be a [[Straw Man]] because it is obvious that an assertion better serves the purpose in such a trivial example. For a counter-example, consider an algorithm that sorts over a list: should we [[Replace Comment With Assertion]] here, and instead of writing: /* foo is sorted */ ? Or should we attempt to write an assert to check that each element of foo is less than the previous element, and that all the elements from the original list are preserved in the sorted list etc.?",
      "id": "34ec75ee2a004f7a4de4a800e1b07420"
    },
    {
      "type": "html",
      "text": "\nMy point is that comments and assertions are tools for achieving understanding of code. Assertions have the advantage they are enforced as code and form programmable safeguards, but then also have all the disadvantages of code: expression of abstraction can be verbose and non-trivial. In the above counter-example, our assertion may even end up being more complex than the sorting code itself. Comments allow for a higher level of abstraction in attempting to convey understanding to the reader (natural language, and all the pitfalls of it) but are not in any way \"enforceable\" as code or by the system.",
      "id": "46c4c5ed93f6f951038c5cc617315e60"
    },
    {
      "type": "html",
      "text": "\nComments have their place and so do assertions: they are not mutually exclusive concepts. Comments are not intrinsically bad. Use the right tools for the job. Sometimes, yes, it does make sense to [[Replace Comment With Assertion]]. Other times, it doesn't. I object to this page because it implies [[One Size Fits All]], which in this case is evidently not the case.",
      "id": "ff1b38dc332676cce00ac3b6a14657a2"
    },
    {
      "type": "html",
      "text": "-- [[Alex Judge]]",
      "id": "d097686c60d9b98383a514b0faf13893"
    },
    {
      "type": "html",
      "text": "\nI think your example is problematic. If I understand correctly, you're using the example of  /* foo is sorted */ in a sort function. Why would you ever do that? Presumably in a sort function, when the function returns, the collection is sorted. As for whether we should write an assertion that checks that it is in fact sorted, of course we should, but we shouldn't put it where the comment was: we should make it a unit test. In other words, the assertion that replaces a comment may not be in the same spot as the comment was. ",
      "id": "304fd70e1131bee07157ec4a55def77d"
    },
    {
      "type": "html",
      "text": "\nOr are you suggesting /* foo is sorted */ as a comment in a function that acts on a sorted list? In that case, I'd still remove it, I think; I'd replace it with either a guard assertion or (better, if language permits) type-checking, such that List.sort returns a [[Sorted List]]. In general, if something is important enough to need a comment, it's probably important enough to find a way of making the comment executable. ",
      "id": "ca50e74a95aba65824d83d86a8dc29c3"
    },
    {
      "type": "html",
      "text": "--[[Marnen Laibow Koser]], 17 Dec 2014 ",
      "id": "5341df8732c88fb0bf77ab61ec54a67f"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "f0f640194600dff9ae2eca0d6c722d05"
    },
    {
      "type": "html",
      "text": "See [[Assertions As Comments]]",
      "id": "3a16e50998473454c0636a55df4b9b8a"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "f0f640194600dff9ae2eca0d6c722d05"
    },
    {
      "type": "html",
      "text": "[[Category Refactoring]] [[Category Assertions]]",
      "id": "92c90d1ad1f8237958bbad22d8863c05"
    },
    {
      "type": "html",
      "text": "See original on  [http://c2.com/cgi/wiki?ReplaceCommentWithAssertion c2.com]",
      "id": "c50c163d525325a7a0f20e519308f4e9"
    }
  ],
  "journal": [
    {
      "date": 1418872601000,
      "id": "1c5baf303147a40404fbc0b14e2c12a6",
      "type": "create",
      "item": {
        "title": "Replace Comment With Assertion",
        "story": [
          {
            "type": "html",
            "text": "A refactoring in which you change a comment into an assertion. Described as [[Introduce Assertion]] in [[Martin Fowler]]'s excellent book, [[Refactoring Improving The Design Of Existing Code]]. See [http://www.refactoring.com/catalog/introduceAssertion.html www.refactoring.com] for his example.",
            "id": "bad5716ab17da77954667447525d8256"
          },
          {
            "type": "html",
            "text": "\n[[Martin Fowler]]'s use of [[Introduce Assertion]] is better than [[Replace Comment With Assertion]], because it applies even when there is no comment (but there should have been).",
            "id": "8383713c66836b385a10afff8c5b51f6"
          },
          {
            "type": "html",
            "text": "<b>Example:</b>",
            "id": "ee01f4ad3bd3091bf0c7ebb46b5e2deb"
          },
          {
            "type": "html",
            "text": "\nBefore:",
            "id": "cb164125202cd5cf97146527b70bb01d"
          },
          {
            "type": "code",
            "text": " // value must not be negative\n public double squareRootOf(int value) {\n   ''...square root algorithm...''\n }",
            "id": "bef334c7d9ed6b4974b6983495963dfe"
          },
          {
            "type": "html",
            "text": "After:",
            "id": "049441134dae92ff0cd8dc633108dfd7"
          },
          {
            "type": "code",
            "text": " public double squareRootOf(int value) {\n   Assert.isTrue(value >= 0);\n   ''...square root algorithm...''\n }",
            "id": "e77ba3ebbf0ba86043678c1e898b3720"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "f0f640194600dff9ae2eca0d6c722d05"
          },
          {
            "type": "html",
            "text": "Here, we could replace comment with type.",
            "id": "29177b9554dbb383acc594a22503fc11"
          },
          {
            "type": "code",
            "text": " public double squareRootOf(unsigned int value) {\n   ''...square root algorithm...''\n }",
            "id": "311d16d271a0bd8b482afbbc9fd1e04f"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "f0f640194600dff9ae2eca0d6c722d05"
          },
          {
            "type": "html",
            "text": "That probably isn't what you want. It allows code like",
            "id": "34683ba7270ea4e6996cafeb2583c24d"
          },
          {
            "type": "code",
            "text": "  double root = squareRootOf(-1);",
            "id": "39a17b5e2eaeae67cf56e18965e831c8"
          },
          {
            "type": "html",
            "text": "\nto compile and run quietly. The -1 is quietly cast to unsigned int, and then the square root is taken:",
            "id": "3c521fab066a0840fad0dd527c314fd7"
          },
          {
            "type": "code",
            "text": "  double root = squareRootOf((unsigned int) -1); // square root of 0xFFFFFFFE",
            "id": "60b0cd7587ee95bdaf29ee537bed4751"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "f0f640194600dff9ae2eca0d6c722d05"
          },
          {
            "type": "html",
            "text": "I'm going to argue that [[Replace Comment With Assertion]] is not necessarily a universal [[Good Thing]], and in fact is not my interpretation of [[Martin Fowler]]'s idea - there is a significant difference between the words \"introduce\" and \"replace\".",
            "id": "e95b2e2c04d86fe6ff9c529c4205e3ce"
          },
          {
            "type": "html",
            "text": "\nSometimes, it can be difficult to assert a specific condition. The example given above seems to be a [[Straw Man]] because it is obvious that an assertion better serves the purpose in such a trivial example. For a counter-example, consider an algorithm that sorts over a list: should we [[Replace Comment With Assertion]] here, and instead of writing: /* foo is sorted */ ? Or should we attempt to write an assert to check that each element of foo is less than the previous element, and that all the elements from the original list are preserved in the sorted list etc.?",
            "id": "34ec75ee2a004f7a4de4a800e1b07420"
          },
          {
            "type": "html",
            "text": "\nMy point is that comments and assertions are tools for achieving understanding of code. Assertions have the advantage they are enforced as code and form programmable safeguards, but then also have all the disadvantages of code: expression of abstraction can be verbose and non-trivial. In the above counter-example, our assertion may even end up being more complex than the sorting code itself. Comments allow for a higher level of abstraction in attempting to convey understanding to the reader (natural language, and all the pitfalls of it) but are not in any way \"enforceable\" as code or by the system.",
            "id": "46c4c5ed93f6f951038c5cc617315e60"
          },
          {
            "type": "html",
            "text": "\nComments have their place and so do assertions: they are not mutually exclusive concepts. Comments are not intrinsically bad. Use the right tools for the job. Sometimes, yes, it does make sense to [[Replace Comment With Assertion]]. Other times, it doesn't. I object to this page because it implies [[One Size Fits All]], which in this case is evidently not the case.",
            "id": "ff1b38dc332676cce00ac3b6a14657a2"
          },
          {
            "type": "html",
            "text": "-- [[Alex Judge]]",
            "id": "d097686c60d9b98383a514b0faf13893"
          },
          {
            "type": "html",
            "text": "\nI think your example is problematic. If I understand correctly, you're using the example of  /* foo is sorted */ in a sort function. Why would you ever do that? Presumably in a sort function, when the function returns, the collection is sorted. As for whether we should write an assertion that checks that it is in fact sorted, of course we should, but we shouldn't put it where the comment was: we should make it a unit test. In other words, the assertion that replaces a comment may not be in the same spot as the comment was. ",
            "id": "304fd70e1131bee07157ec4a55def77d"
          },
          {
            "type": "html",
            "text": "\nOr are you suggesting /* foo is sorted */ as a comment in a function that acts on a sorted list? In that case, I'd still remove it, I think; I'd replace it with either a guard assertion or (better, if language permits) type-checking, such that List.sort returns a [[Sorted List]]. In general, if something is important enough to need a comment, it's probably important enough to find a way of making the comment executable. ",
            "id": "ca50e74a95aba65824d83d86a8dc29c3"
          },
          {
            "type": "html",
            "text": "--[[Marnen Laibow Koser]], 17 Dec 2014 ",
            "id": "5341df8732c88fb0bf77ab61ec54a67f"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "f0f640194600dff9ae2eca0d6c722d05"
          },
          {
            "type": "html",
            "text": "See [[Assertions As Comments]]",
            "id": "3a16e50998473454c0636a55df4b9b8a"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "f0f640194600dff9ae2eca0d6c722d05"
          },
          {
            "type": "html",
            "text": "[[Category Refactoring]] [[Category Assertions]]",
            "id": "92c90d1ad1f8237958bbad22d8863c05"
          },
          {
            "type": "html",
            "text": "See original on  [http://c2.com/cgi/wiki?ReplaceCommentWithAssertion c2.com]",
            "id": "c50c163d525325a7a0f20e519308f4e9"
          }
        ]
      }
    },
    {
      "type": "fork",
      "site": "sfw.c2.com",
      "date": 1654238589994
    }
  ]
}