{
  "title": "dreyeck.ch",
  "story": [
    {
      "type": "paragraph",
      "id": "5f1a83d16836f20f",
      "text": "is the name of a wiki farm that was created as a clone of the [[wiki.ralfbarkow.ch]] server."
    },
    {
      "type": "roster",
      "id": "6ff9fe6a8f8bd841",
      "text": "dreyeck.ch\nwiki.ralfbarkow.ch"
    },
    {
      "type": "markdown",
      "id": "87b00cb35e7e86be",
      "text": "`configuration.nix` @dreyeck.ch was adjusted:"
    },
    {
      "type": "code",
      "id": "fff56cdaa70e81ce",
      "text": "  networking.hostName = \"dreyeck\"; # Define your hostname.\n"
    },
    {
      "type": "paragraph",
      "id": "b69e6b5f51a52354",
      "text": "Then we generated a [[Wildcard Certificate]] for *.dreyeck.ch based on the documentation in the [https://nixos.org/manual/nixos/stable/index.html#module-security-acme-config-dns nixos.org/manual] and the lego [https://go-acme.github.io/lego/dns/hetzner/ docs]."
    },
    {
      "type": "code",
      "id": "253619a426ad9895",
      "text": "  security.acme = {\n    acceptTerms = true;\n    certs.\"dreyeck.ch\" = {\n      domain = \"*.dreyeck.ch\";\n      dnsProvider = \"hetzner\";\n      credentialsFile = \"[…]/hetzner-api-key.[…]\";\n    };\n    defaults = {\n      email = \"[…]\";\n    };\n  }; \n\n[…]\n"
    },
    {
      "type": "paragraph",
      "id": "e0c5502996a0dc32",
      "text": "For this purpose, a corresponding zone was set up in the HETZNER DNS Console, the name server entries at the domain name registrar and in the Microsoft 365 admin center were adjusted accordingly and the settings required for the mail connection etc. were transferred to the zone file. (Manual BIND zone file editing)"
    },
    {
      "type": "paragraph",
      "id": "a3bd0e835b52b0ae",
      "text": "Finally, the nginx configuration had to be adjusted:"
    },
    {
      "type": "code",
      "id": "73a274d8aa11b7df",
      "text": "  users.users.nginx.extraGroups = [ \"acme\" ];\n\n  services.nginx = {\n    enable = true;\n    recommendedProxySettings = true;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"dreyeck.ch\" = {\n        forceSSL = true;\n        useACMEHost = \"dreyeck.ch\";\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true; # needed if you need to use WebSocket\n        };\n      };\n"
    },
    {
      "type": "paragraph",
      "id": "5834baa6a7187af6",
      "text": "⇒ [[Weeds in the Farm]]"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "dreyeck.ch",
        "story": []
      },
      "date": 1672933003155
    },
    {
      "id": "5f1a83d16836f20f",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "5f1a83d16836f20f",
        "text": "is the name of a wiki farm that was created as a clone of the wiki.ralfbarkow.ch server."
      },
      "date": 1672933028225
    },
    {
      "id": "87b00cb35e7e86be",
      "type": "add",
      "item": {
        "type": "markdown",
        "id": "87b00cb35e7e86be",
        "text": "`configuration.nix` @dreyeck.ch was adjusted:"
      },
      "after": "5f1a83d16836f20f",
      "date": 1672933030504
    },
    {
      "id": "fff56cdaa70e81ce",
      "type": "add",
      "item": {
        "type": "code",
        "id": "fff56cdaa70e81ce",
        "text": "  networking.hostName = \"dreyeck\"; # Define your hostname.\n"
      },
      "after": "87b00cb35e7e86be",
      "date": 1672933032738
    },
    {
      "id": "b69e6b5f51a52354",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "b69e6b5f51a52354",
        "text": "Then we [[generate]]d a [[Wildcard Certificate]] for *.dreyeck.ch based on the documentation in the [https://nixos.org/manual/nixos/stable/index.html#module-security-acme-config-dns nixos.org/manual] and the lego [https://go-acme.github.io/lego/dns/hetzner/ docs]."
      },
      "after": "fff56cdaa70e81ce",
      "date": 1672933036112
    },
    {
      "id": "253619a426ad9895",
      "type": "add",
      "item": {
        "type": "code",
        "id": "253619a426ad9895",
        "text": "  security.acme = {\n    acceptTerms = true;\n    certs.\"dreyeck.ch\" = {\n      domain = \"*.dreyeck.ch\";\n      dnsProvider = \"hetzner\";\n      credentialsFile = \"[…]/hetzner-api-key.[…]\";\n    };\n    defaults = {\n      email = \"[…]\";\n    };\n  }; \n\n[…]\n"
      },
      "after": "b69e6b5f51a52354",
      "date": 1672933037860
    },
    {
      "id": "e0c5502996a0dc32",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "e0c5502996a0dc32",
        "text": "For this purpose, a corresponding zone was set up in the HETZNER DNS Console, the name server entries at the domain name registrar and in the Microsoft 365 admin center were adjusted accordingly and the settings required for the mail connection were transferred to the zone file. (Manual BIND zone file editing)"
      },
      "after": "253619a426ad9895",
      "date": 1672933039661
    },
    {
      "item": {
        "type": "factory",
        "id": "a3bd0e835b52b0ae"
      },
      "id": "a3bd0e835b52b0ae",
      "type": "add",
      "after": "e0c5502996a0dc32",
      "date": 1672933775749
    },
    {
      "item": {
        "type": "factory",
        "id": "73a274d8aa11b7df"
      },
      "id": "73a274d8aa11b7df",
      "type": "add",
      "after": "a3bd0e835b52b0ae",
      "date": 1672933781870
    },
    {
      "type": "edit",
      "id": "a3bd0e835b52b0ae",
      "item": {
        "type": "paragraph",
        "id": "a3bd0e835b52b0ae",
        "text": "nginx"
      },
      "date": 1672933783423
    },
    {
      "type": "edit",
      "id": "73a274d8aa11b7df",
      "item": {
        "type": "code",
        "id": "73a274d8aa11b7df",
        "text": "  users.users.nginx.extraGroups = [ \"acme\" ];\n\n  services.nginx = {\n    enable = true;\n    recommendedProxySettings = true;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"dreyeck.ch\" = {\n        forceSSL = true;\n        useACMEHost = \"dreyeck.ch\";\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true; # needed if you need to use WebSocket\n        };\n      };\n"
      },
      "date": 1672933787103
    },
    {
      "type": "edit",
      "id": "a3bd0e835b52b0ae",
      "item": {
        "type": "paragraph",
        "id": "a3bd0e835b52b0ae",
        "text": "Finally, the nginx configuration had to be adjusted:"
      },
      "date": 1672933908675
    },
    {
      "item": {
        "type": "factory",
        "id": "6ff9fe6a8f8bd841"
      },
      "id": "6ff9fe6a8f8bd841",
      "type": "add",
      "after": "73a274d8aa11b7df",
      "date": 1672933977247
    },
    {
      "id": "6ff9fe6a8f8bd841",
      "type": "move",
      "order": [
        "5f1a83d16836f20f",
        "6ff9fe6a8f8bd841",
        "87b00cb35e7e86be",
        "fff56cdaa70e81ce",
        "b69e6b5f51a52354",
        "253619a426ad9895",
        "e0c5502996a0dc32",
        "a3bd0e835b52b0ae",
        "73a274d8aa11b7df"
      ],
      "date": 1672933983411
    },
    {
      "type": "edit",
      "id": "6ff9fe6a8f8bd841",
      "item": {
        "type": "roster",
        "id": "6ff9fe6a8f8bd841",
        "text": "dreyeck.ch"
      },
      "date": 1672933990540
    },
    {
      "type": "fork",
      "date": 1672934026102
    },
    {
      "type": "edit",
      "id": "6ff9fe6a8f8bd841",
      "item": {
        "type": "roster",
        "id": "6ff9fe6a8f8bd841",
        "text": "dreyeck.ch\nwiki.ralfbarkow.ch"
      },
      "date": 1672934045094
    },
    {
      "type": "edit",
      "id": "e0c5502996a0dc32",
      "item": {
        "type": "paragraph",
        "id": "e0c5502996a0dc32",
        "text": "For this purpose, a corresponding zone was set up in the HETZNER DNS Console, the name server entries at the domain name registrar and in the Microsoft 365 admin center were adjusted accordingly and the settings required for the mail connection etc. were transferred to the zone file. (Manual BIND zone file editing)"
      },
      "date": 1672934065205
    },
    {
      "item": {
        "type": "factory",
        "id": "5834baa6a7187af6"
      },
      "id": "5834baa6a7187af6",
      "type": "add",
      "after": "73a274d8aa11b7df",
      "date": 1672934222142
    },
    {
      "type": "edit",
      "id": "5834baa6a7187af6",
      "item": {
        "type": "paragraph",
        "id": "5834baa6a7187af6",
        "text": "⇒ [[[[Weeds in the Farm]]]]"
      },
      "date": 1672934234463
    },
    {
      "type": "edit",
      "id": "5834baa6a7187af6",
      "item": {
        "type": "paragraph",
        "id": "5834baa6a7187af6",
        "text": "⇒ [[Weeds in the Farm]]"
      },
      "date": 1672934241973
    },
    {
      "type": "edit",
      "id": "5f1a83d16836f20f",
      "item": {
        "type": "paragraph",
        "id": "5f1a83d16836f20f",
        "text": "is the name of a wiki farm that was created as a clone of the [[wiki.ralfbarkow.ch]] server."
      },
      "date": 1692772915862
    },
    {
      "type": "edit",
      "id": "b69e6b5f51a52354",
      "item": {
        "type": "paragraph",
        "id": "b69e6b5f51a52354",
        "text": "Then we generated a [[Wildcard Certificate]] for *.dreyeck.ch based on the documentation in the [https://nixos.org/manual/nixos/stable/index.html#module-security-acme-config-dns nixos.org/manual] and the lego [https://go-acme.github.io/lego/dns/hetzner/ docs]."
      },
      "date": 1692776882786
    }
  ]
}