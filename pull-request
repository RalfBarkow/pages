{
  "title": "Pull Request",
  "story": [
    {
      "type": "paragraph",
      "id": "2048fb9e2c52a17c",
      "text": "Pull Request is a feature of GitHub that programmers use to suggest improvements to other projects. This page is about a specific pull request which introduced SVG support into Wiki's HTML Plugin. [https://github.com/fedwiki/wiki-plugin-html/pull/21 github]"
    },
    {
      "type": "paragraph",
      "id": "6be46a82b3119c94",
      "text": "See [[About HTML Plugin]]"
    },
    {
      "type": "paragraph",
      "id": "2553023d63849fa3",
      "text": "See [[Test Sequence Diagram]] "
    },
    {
      "type": "paragraph",
      "id": "8af2a13aa69044d0",
      "text": "I've been interested in SVG for decades."
    },
    {
      "type": "reference",
      "id": "59ed4ed44487b374",
      "text": "In 2003 I re-created an animation of a vanishing point in javascript and SVG.",
      "site": "wiki.dbbs.co",
      "slug": "vanishing-point",
      "title": "Vanishing Point"
    },
    {
      "type": "paragraph",
      "id": "d22c5bcea9a49d8b",
      "text": "Because my own SVG journey started with an application of javascript, I have been acutely aware of the security risk of naively adding SVG support to wiki. The default mode must sanitize SVG to prevent abusive javascript from harming the work of wiki authors. This stalled my enthusiasm for many years."
    },
    {
      "type": "paragraph",
      "id": "2535e290484e5288",
      "text": "In September 2020, I finally set aside time to look closely at DOMPurify."
    },
    {
      "type": "paragraph",
      "id": "5f209cb6935bc13a",
      "text": "My original interest in DOMPurify was for its support for SVG sanitization. I had bookmarked that with a view to creating an SVG plugin. But it occurred to me that this might work perfectly well inside the HTML plugin."
    },
    {
      "type": "paragraph",
      "id": "0d99e6bf5f1bedad",
      "text": "My first attempt broke the form behavior of [[Create New Page]]."
    },
    {
      "type": "paragraph",
      "id": "34e24173cf576499",
      "text": "It also showed a strange feature of SVGs where the Scaleable part of the name seemed not to work, by default. The test image I chose was too wide for wiki pages and did not scale down to fit."
    },
    {
      "type": "paragraph",
      "id": "b81be3cd31a3464d",
      "text": "It took some time to discover what we now recommend: specify the width and viewBox attributes and omit the height attribute to get the images to fit in our narrow pages: <svg width=\"100%\" viewBox=\"...\""
    },
    {
      "type": "paragraph",
      "id": "88253d65c3e5b2b2",
      "text": "The next obstacle was internal links."
    },
    {
      "type": "paragraph",
      "id": "961ae69896a1bd1b",
      "text": "Authors were already able to add SVG as plain images to wiki by using <img src=\"data:image/xml+svg,...\"> conventions. Giving authors ways to embed internal links within SVG images would make them more interesting."
    },
    {
      "type": "paragraph",
      "id": "d1a50743ba57f983",
      "text": "It didn't take much to support our [[]] and [] notations. The HTML plugin already knows how to expand those. But there was a peculiar conflict in our external links and SVG syntax that we had to work out. See [https://github.com/fedwiki/wiki-plugin-html/pull/21/commits/33d2621b9fa1f0386cbd7a152866528afaf9ef4f commit] and [https://github.com/fedwiki/wiki-plugin-html/pull/21/commits/ffb39385da64774f5be3643d9496ae31ce6ea482 commit]"
    },
    {
      "type": "paragraph",
      "id": "b61749e85ce0b18c",
      "text": "I got stuck at this point."
    },
    {
      "type": "paragraph",
      "id": "8f24b4b5e2fe9185",
      "text": "In my work on the graphviz plugin I added javascript instrumentation which handles clicks when the reader clicks on the graph. This allows the graph to act as a navigation tool."
    },
    {
      "type": "paragraph",
      "id": "565fa62217ba9bde",
      "text": "How to support SVGs that are not generated by graphviz?"
    },
    {
      "type": "paragraph",
      "id": "692970adce63da18",
      "text": "I was fixated on solutions of wrapping the SVG with custom elements that would add the click behavior. But they felt too complicated."
    },
    {
      "type": "paragraph",
      "id": "0b34998c57015beb",
      "text": "I had other ideas about modifying the SVG, but the workflows to do so felt entirely too complicated."
    },
    {
      "type": "paragraph",
      "id": "e260c18703566650",
      "text": "The PR and my mind stalled for over a year."
    },
    {
      "type": "paragraph",
      "id": "e32f1c9cdae5c775",
      "text": "The part of me that makes a living as a professional programmer is fundamentally surprised by that fact. So worth saying it out loud again."
    },
    {
      "type": "paragraph",
      "id": "da0a69ecfbf6eadd",
      "text": "The PR stalled for a year."
    },
    {
      "type": "paragraph",
      "id": "1bbc89260111cd27",
      "text": "This is a deep luxury of open source software development. Because this is volunteer work I didn't have to meet any production deadline. I could wait patiently for a solution that felt right."
    },
    {
      "type": "paragraph",
      "id": "d00c311ad65b2a6b",
      "text": "In October of 2020 I started adding features to the frame plugin. First to allow HTML scripts to create ghost pages or open existing pages. [https://github.com/fedwiki/wiki-plugin-frame/commit/ad85eb0cd5633200df838420b37237900c3af0da commit]"
    },
    {
      "type": "paragraph",
      "id": "7cf2495daf4b0082",
      "text": "This wasn't a plan. This was me following a different thread of exploratory development. I was stuck on the SVG problems but saw some Frame improvements within reach."
    },
    {
      "type": "paragraph",
      "id": "8cc6583fa327f38f",
      "text": "In the past couple months Ward and Thompson have asked Paul and me to reflect with them on the workflows that have emerged from the addition of these new features of the frame plugin."
    },
    {
      "type": "paragraph",
      "id": "06bcf38ee4a9c53d",
      "text": "We're excited by the ways that these new affordances allow us to write small bits of glue code—not so dissimilar from shell scripts in their scope—that despite small size or shocking simplicity show surprising reach."
    },
    {
      "type": "paragraph",
      "id": "45cc705c90ce8265",
      "text": "The reflection, along with a timely conversation with Ward and Paul, reframed the SVG problem."
    },
    {
      "type": "paragraph",
      "id": "32806ff8c9079c96",
      "text": "Build an intermediate form for SVG diagrams that the HTML plugin could understand, that might be lightweight to add for folks familiar with HTML or SVG."
    },
    {
      "type": "paragraph",
      "id": "ae629526300e1e24",
      "text": "Delegate to scripts running inside Frames this problem of transforming specific SVG formats into the intermediate form."
    },
    {
      "type": "paragraph",
      "id": "a29acc8d4029d9ec",
      "text": "That insight and a few days work and we finally have SVG support in wiki."
    },
    {
      "type": "paragraph",
      "id": "6f035c021d52fa16",
      "text": "\n"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "Pull Request",
        "story": []
      },
      "date": 1637727331866
    },
    {
      "item": {
        "type": "factory",
        "id": "2048fb9e2c52a17c"
      },
      "id": "2048fb9e2c52a17c",
      "type": "add",
      "date": 1637727337736
    },
    {
      "type": "edit",
      "id": "2048fb9e2c52a17c",
      "item": {
        "type": "paragraph",
        "id": "2048fb9e2c52a17c",
        "text": "Pull Request is a feature of GitHub that programmers use to suggest improvements to other projects. This page is about a specific pull request which introduced SVG support into Wiki's HTML Plugin. [[About HTML Plugin]] [ github]"
      },
      "date": 1637727423883
    },
    {
      "type": "edit",
      "id": "2048fb9e2c52a17c",
      "item": {
        "type": "paragraph",
        "id": "2048fb9e2c52a17c",
        "text": "Pull Request is a feature of GitHub that programmers use to suggest improvements to other projects. This page is about a specific pull request which introduced SVG support into Wiki's HTML Plugin. [[About HTML Plugin]] [https://github.com/fedwiki/wiki-plugin-html/pull/21 github]"
      },
      "date": 1637727460200
    },
    {
      "type": "edit",
      "id": "2048fb9e2c52a17c",
      "item": {
        "type": "paragraph",
        "id": "2048fb9e2c52a17c",
        "text": "Pull Request is a feature of GitHub that programmers use to suggest improvements to other projects. This page is about a specific pull request which introduced SVG support into Wiki's HTML Plugin. [[About HTML Plugin]] [[Test Sequence Diagram]][https://github.com/fedwiki/wiki-plugin-html/pull/21 github]"
      },
      "date": 1637727507478
    },
    {
      "type": "edit",
      "id": "2048fb9e2c52a17c",
      "item": {
        "type": "paragraph",
        "id": "2048fb9e2c52a17c",
        "text": "Pull Request is a feature of GitHub that programmers use to suggest improvements to other projects. This page is about a specific pull request which introduced SVG support into Wiki's HTML Plugin. [[About HTML Plugin]] [[Test Sequence Diagram]] [https://github.com/fedwiki/wiki-plugin-html/pull/21 github]"
      },
      "date": 1637727513022
    },
    {
      "type": "edit",
      "id": "2048fb9e2c52a17c",
      "item": {
        "type": "paragraph",
        "id": "2048fb9e2c52a17c",
        "text": "Pull Request is a feature of GitHub that programmers use to suggest improvements to other projects. This page is about a specific pull request which introduced SVG support into Wiki's HTML Plugin. [https://github.com/fedwiki/wiki-plugin-html/pull/21 github]"
      },
      "date": 1637727525959
    },
    {
      "type": "add",
      "id": "6be46a82b3119c94",
      "item": {
        "type": "paragraph",
        "id": "6be46a82b3119c94",
        "text": "See [[About HTML Plugin]]"
      },
      "after": "2048fb9e2c52a17c",
      "date": 1637727533898
    },
    {
      "type": "add",
      "id": "2553023d63849fa3",
      "item": {
        "type": "paragraph",
        "id": "2553023d63849fa3",
        "text": "See [[Test Sequence Diagram]] "
      },
      "after": "6be46a82b3119c94",
      "date": 1637727536614
    },
    {
      "type": "add",
      "id": "8af2a13aa69044d0",
      "item": {
        "type": "paragraph",
        "id": "8af2a13aa69044d0",
        "text": "My original interest in DOMPurify was for its support for SVG sanitization. I had bookmarked that with a view to creating an SVG plugin. But it occurred to me that this might work perfectly well inside the HTML plugin."
      },
      "after": "2553023d63849fa3",
      "date": 1637727634020
    },
    {
      "type": "edit",
      "id": "8af2a13aa69044d0",
      "item": {
        "type": "paragraph",
        "id": "8af2a13aa69044d0",
        "text": "I've been interested in SVG for decades."
      },
      "date": 1637727776608
    },
    {
      "type": "add",
      "id": "5f209cb6935bc13a",
      "item": {
        "type": "paragraph",
        "id": "5f209cb6935bc13a",
        "text": "My original interest in DOMPurify was for its support for SVG sanitization. I had bookmarked that with a view to creating an SVG plugin. But it occurred to me that this might work perfectly well inside the HTML plugin."
      },
      "after": "8af2a13aa69044d0",
      "date": 1637727781364
    },
    {
      "type": "add",
      "id": "59ed4ed44487b374",
      "item": {
        "type": "factory",
        "id": "59ed4ed44487b374",
        "text": "See [[Vanishing Point]]"
      },
      "after": "8af2a13aa69044d0",
      "date": 1637727842115
    },
    {
      "type": "edit",
      "id": "59ed4ed44487b374",
      "item": {
        "type": "reference",
        "id": "59ed4ed44487b374",
        "text": "In 2003 I re-created an animation of a vanishing point in javascript and SVG.  The original animation was built with AutoCAD 10 and custom AUTOLISP scripts I created in the fall of 1990.  Happily amazed that 15 years later this code runs unchanged in modern browsers. [http://dobbse.net/thinair/2003/12/vanishing-point.html blog]",
        "site": "wiki.dbbs.co",
        "slug": "vanishing-point",
        "title": "Vanishing Point"
      },
      "date": 1637727845569
    },
    {
      "type": "add",
      "id": "d22c5bcea9a49d8b",
      "item": {
        "type": "paragraph",
        "id": "d22c5bcea9a49d8b",
        "text": "Because my own SVG journey started with an application of javascript, I have been acutely aware of the security risk of a nieve "
      },
      "after": "59ed4ed44487b374",
      "date": 1637727893025
    },
    {
      "type": "edit",
      "id": "d22c5bcea9a49d8b",
      "item": {
        "type": "paragraph",
        "id": "d22c5bcea9a49d8b",
        "text": "Because my own SVG journey started with an application of javascript, I have been acutely aware of the security risk of a naieve "
      },
      "date": 1637727908356
    },
    {
      "type": "edit",
      "id": "d22c5bcea9a49d8b",
      "item": {
        "type": "paragraph",
        "id": "d22c5bcea9a49d8b",
        "text": "Because my own SVG journey started with an application of javascript, I have been acutely aware of the security risk of naively adding SVG support to wiki. The default mode must sanitize SVG to prevent abusive javascript from harming the work of wiki authors. This stalled my enthusiasm for many years."
      },
      "date": 1637728019312
    },
    {
      "type": "add",
      "id": "2535e290484e5288",
      "item": {
        "type": "paragraph",
        "id": "2535e290484e5288",
        "text": "In September 2020, I finally set aside time to look closely at DOMPurify."
      },
      "after": "d22c5bcea9a49d8b",
      "date": 1637728114414
    },
    {
      "type": "edit",
      "id": "59ed4ed44487b374",
      "item": {
        "type": "reference",
        "id": "59ed4ed44487b374",
        "text": "In 2003 I re-created an animation of a vanishing point in javascript and SVG.",
        "site": "wiki.dbbs.co",
        "slug": "vanishing-point",
        "title": "Vanishing Point"
      },
      "date": 1637728176945
    },
    {
      "type": "add",
      "id": "0d99e6bf5f1bedad",
      "item": {
        "type": "paragraph",
        "id": "0d99e6bf5f1bedad",
        "text": "My first attempt broke the form behavior of [[Create New Page]]."
      },
      "after": "5f209cb6935bc13a",
      "date": 1637728241133
    },
    {
      "type": "add",
      "id": "34e24173cf576499",
      "item": {
        "type": "paragraph",
        "id": "34e24173cf576499",
        "text": "It also showed a strange feature of SVGs where the Scaleable part of the name seemed not to work, by default. The test image I chose was too wide for wiki pages and did not scale down to fit."
      },
      "after": "0d99e6bf5f1bedad",
      "date": 1637728375028
    },
    {
      "type": "add",
      "id": "b81be3cd31a3464d",
      "item": {
        "type": "paragraph",
        "id": "b81be3cd31a3464d",
        "text": "It took some time to discover what we now recommend: specify the width and viewBox attributes and omit the height attribute to get the images to fit in our narrow pages: <svg width=\"100%\" viewBox=\"...\""
      },
      "after": "34e24173cf576499",
      "date": 1637728417188
    },
    {
      "type": "add",
      "id": "6f035c021d52fa16",
      "item": {
        "type": "paragraph",
        "id": "6f035c021d52fa16",
        "text": "\n"
      },
      "after": "b81be3cd31a3464d",
      "date": 1637728420481
    },
    {
      "type": "add",
      "id": "88253d65c3e5b2b2",
      "item": {
        "type": "paragraph",
        "id": "88253d65c3e5b2b2",
        "text": "The next obstacle was internal links."
      },
      "after": "b81be3cd31a3464d",
      "date": 1637728556096
    },
    {
      "type": "add",
      "id": "961ae69896a1bd1b",
      "item": {
        "type": "paragraph",
        "id": "961ae69896a1bd1b",
        "text": "Authors were already able to add SVG as plain images to wiki by using <img src=\"data:image/xml+svg,...\"> conventions. Giving authors ways to embed internal links within SVG images would make them more interesting."
      },
      "after": "88253d65c3e5b2b2",
      "date": 1637728661289
    },
    {
      "type": "add",
      "id": "d1a50743ba57f983",
      "item": {
        "type": "paragraph",
        "id": "d1a50743ba57f983",
        "text": "It didn't take much to support our [[]] and [] notations. The HTML plugin already knows how to expand those. But there was a peculiar conflict in our external links that we had to work out. See [ commit]"
      },
      "after": "961ae69896a1bd1b",
      "date": 1637728741326
    },
    {
      "type": "edit",
      "id": "d1a50743ba57f983",
      "item": {
        "type": "paragraph",
        "id": "d1a50743ba57f983",
        "text": "It didn't take much to support our [[]] and [] notations. The HTML plugin already knows how to expand those. But there was a peculiar conflict in our external links that we had to work out. See [https://github.com/fedwiki/wiki-plugin-html/pull/21/commits/33d2621b9fa1f0386cbd7a152866528afaf9ef4f commit]"
      },
      "date": 1637728757609
    },
    {
      "type": "edit",
      "id": "d1a50743ba57f983",
      "item": {
        "type": "paragraph",
        "id": "d1a50743ba57f983",
        "text": "It didn't take much to support our [[]] and [] notations. The HTML plugin already knows how to expand those. But there was a peculiar conflict in our external links and SVG syntax that we had to work out. See [https://github.com/fedwiki/wiki-plugin-html/pull/21/commits/33d2621b9fa1f0386cbd7a152866528afaf9ef4f commit]"
      },
      "date": 1637730831104
    },
    {
      "type": "edit",
      "id": "d1a50743ba57f983",
      "item": {
        "type": "paragraph",
        "id": "d1a50743ba57f983",
        "text": "It didn't take much to support our [[]] and [] notations. The HTML plugin already knows how to expand those. But there was a peculiar conflict in our external links and SVG syntax that we had to work out. See [https://github.com/fedwiki/wiki-plugin-html/pull/21/commits/33d2621b9fa1f0386cbd7a152866528afaf9ef4f commit] and [https://github.com/fedwiki/wiki-plugin-html/pull/21/commits/ffb39385da64774f5be3643d9496ae31ce6ea482 commit]"
      },
      "date": 1637732752374
    },
    {
      "type": "add",
      "id": "b61749e85ce0b18c",
      "item": {
        "type": "paragraph",
        "id": "b61749e85ce0b18c",
        "text": "I got stuck at this point."
      },
      "after": "d1a50743ba57f983",
      "date": 1637732839334
    },
    {
      "type": "add",
      "id": "8f24b4b5e2fe9185",
      "item": {
        "type": "paragraph",
        "id": "8f24b4b5e2fe9185",
        "text": "In my work on the graphviz plugin I added javascript instrumentation which handles clicks when the reader clicks on the graph. This allows the graph to act as a navigation tool."
      },
      "after": "b61749e85ce0b18c",
      "date": 1637732896088
    },
    {
      "type": "add",
      "id": "565fa62217ba9bde",
      "item": {
        "type": "paragraph",
        "id": "565fa62217ba9bde",
        "text": "How to support SVGs that are not generated by graphviz?"
      },
      "after": "8f24b4b5e2fe9185",
      "date": 1637732937211
    },
    {
      "type": "add",
      "id": "692970adce63da18",
      "item": {
        "type": "paragraph",
        "id": "692970adce63da18",
        "text": "I was fixated on solutions of wrapping the SVG with custom elements that would add the click behavior. But they felt too complicated."
      },
      "after": "565fa62217ba9bde",
      "date": 1637732989487
    },
    {
      "type": "add",
      "id": "0b34998c57015beb",
      "item": {
        "type": "paragraph",
        "id": "0b34998c57015beb",
        "text": "I had other ideas about modifying the SVG, but the workflows to do so felt entirely too complicated."
      },
      "after": "692970adce63da18",
      "date": 1637733019965
    },
    {
      "type": "add",
      "id": "e260c18703566650",
      "item": {
        "type": "paragraph",
        "id": "e260c18703566650",
        "text": "The PR and my mind stalled for over a year."
      },
      "after": "0b34998c57015beb",
      "date": 1637733036596
    },
    {
      "type": "add",
      "id": "e32f1c9cdae5c775",
      "item": {
        "type": "paragraph",
        "id": "e32f1c9cdae5c775",
        "text": "The part of me that makes a living as a professional programmer is fundamentally surprised by that fact. So worth saying it out loud again."
      },
      "after": "e260c18703566650",
      "date": 1637733089676
    },
    {
      "type": "add",
      "id": "da0a69ecfbf6eadd",
      "item": {
        "type": "paragraph",
        "id": "da0a69ecfbf6eadd",
        "text": "The PR stalled for a year."
      },
      "after": "e32f1c9cdae5c775",
      "date": 1637733105951
    },
    {
      "type": "add",
      "id": "1bbc89260111cd27",
      "item": {
        "type": "paragraph",
        "id": "1bbc89260111cd27",
        "text": "This is a deep luxury of open source software development. Because this is volunteer work I didn't have to meet any production deadline. I could wait patiently for a solution that felt right."
      },
      "after": "da0a69ecfbf6eadd",
      "date": 1637733218445
    },
    {
      "type": "add",
      "id": "d00c311ad65b2a6b",
      "item": {
        "type": "paragraph",
        "id": "d00c311ad65b2a6b",
        "text": "In October of 2020 I started adding features to the frame plugin. First to allow HTML scripts to create ghost pages or open existing pages. [https://github.com/fedwiki/wiki-plugin-frame/commit/ad85eb0cd5633200df838420b37237900c3af0da commit]"
      },
      "after": "1bbc89260111cd27",
      "date": 1637733474035
    },
    {
      "type": "add",
      "id": "7cf2495daf4b0082",
      "item": {
        "type": "paragraph",
        "id": "7cf2495daf4b0082",
        "text": "This wasn't a plan. This was me following a different thread of exploratory development. I was stuck on the SVG problems but saw some Frame improvements within reach."
      },
      "after": "d00c311ad65b2a6b",
      "date": 1637733573089
    },
    {
      "type": "add",
      "id": "8cc6583fa327f38f",
      "item": {
        "type": "paragraph",
        "id": "8cc6583fa327f38f",
        "text": "In the past couple months Ward and Thompson have asked Paul and me to reflect with them on the workflows that have emerged from the addition of these new features of the frame plugin."
      },
      "after": "7cf2495daf4b0082",
      "date": 1637733763159
    },
    {
      "type": "add",
      "id": "06bcf38ee4a9c53d",
      "item": {
        "type": "paragraph",
        "id": "06bcf38ee4a9c53d",
        "text": "We're excited by the ways that these new affordances allow us to write small bits of glue code—not so dissimilar from shell scripts in their scope—that despite small size or shocking simplicity show surprising reach."
      },
      "after": "8cc6583fa327f38f",
      "date": 1637733869035
    },
    {
      "type": "add",
      "id": "45cc705c90ce8265",
      "item": {
        "type": "paragraph",
        "id": "45cc705c90ce8265",
        "text": "The reflection, along with a timely conversation with Ward and Paul, reframed the SVG problem. Build an intermediate form for SVG diagrams that the HTML plugin could understand, that might be lightweight to add for folks familiar with HTML or SVG. Delegate to scripts running inside Frames this problem of transforming specific SVG formats into the intermediate form."
      },
      "after": "06bcf38ee4a9c53d",
      "date": 1637734087746
    },
    {
      "type": "edit",
      "id": "45cc705c90ce8265",
      "item": {
        "type": "paragraph",
        "id": "45cc705c90ce8265",
        "text": "The reflection, along with a timely conversation with Ward and Paul, reframed the SVG problem."
      },
      "date": 1637734100372
    },
    {
      "type": "add",
      "id": "32806ff8c9079c96",
      "item": {
        "type": "paragraph",
        "id": "32806ff8c9079c96",
        "text": "Build an intermediate form for SVG diagrams that the HTML plugin could understand, that might be lightweight to add for folks familiar with HTML or SVG."
      },
      "after": "45cc705c90ce8265",
      "date": 1637734104633
    },
    {
      "type": "add",
      "id": "ae629526300e1e24",
      "item": {
        "type": "paragraph",
        "id": "ae629526300e1e24",
        "text": "Delegate to scripts running inside Frames this problem of transforming specific SVG formats into the intermediate form."
      },
      "after": "32806ff8c9079c96",
      "date": 1637734105676
    },
    {
      "type": "add",
      "id": "a29acc8d4029d9ec",
      "item": {
        "type": "paragraph",
        "id": "a29acc8d4029d9ec",
        "text": "That insight and a few days work and we finally have SVG support in wiki."
      },
      "after": "ae629526300e1e24",
      "date": 1637734180845
    },
    {
      "type": "fork",
      "site": "eric.dojo.fed.wiki",
      "date": 1637750320491
    }
  ]
}