{
  "title": "Private Interface",
  "story": [
    {
      "type": "html",
      "text": "[[Category Pattern]]:\nA [[Structural Pattern]] that \"provides a mechanism allowing specific classes to use a non-public subset of a class interface without inadvertently increasing the visibility of any hidden member variables or member functions\".\nIn other words, how to give another class access to some of your \"private\" functions, without making them a \"friend\".",
      "id": "bf40b885de462ca4c07ec5b6205fa7c2"
    },
    {
      "type": "html",
      "text": "\nBy [[James Newkirk]].\nSubmitted to PLoP97 ([[Pattern Languages Of Program Design]]), but not included in the volume three book.",
      "id": "d8eebc21e565fa80a929e91db4ba5af9"
    },
    {
      "type": "html",
      "text": "\nAvailable at [http://www.objectmentor.com www.objectmentor.com] in the publications section",
      "id": "96f09dc1825e65c0dbd479cc2bc65cc6"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "74b777653dc673be5841843ff5f32435"
    },
    {
      "type": "html",
      "text": "\nIn the guise of [[Partial Revelation]], this was one of the interesting features of [[Modula Three]]. In M3, a type definition could be divided up into a set of interfaces which are eventually combined to make up the type. How much of the type you can see depends on which interfaces you have imported into your compilation unit. It's really neat for providing controlled access to a library, for example: to distinguish between those parts of an implementation which are [[Garbage Collected]] and those parts that aren't and have to be looked after.",
      "id": "43979ccb7503f6a3bc4af2e6aaa9204a"
    },
    {
      "type": "html",
      "text": "\nSee [http://www.research.digital.com/SRC/modula-3/html/partial-rev/index.html www.research.digital.com]",
      "id": "77618217ee9ce7ab066fac7eb569af82"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "74b777653dc673be5841843ff5f32435"
    },
    {
      "type": "html",
      "text": "\nThe implementation of this in C++ is beautiful. I've used this when I want to make a C++ class an observer, but I don't want other users of the class to have access to the callbacks. It goes like this (from memory):",
      "id": "d2c2cd1aa399a6172df1276c59404ee1"
    },
    {
      "type": "code",
      "text": "  class Observer \n    {\n    public:\n      void callback (...) = 0;\n    }",
      "id": "e65dd59d5fd31b0089de05a9f1e221f5"
    },
    {
      "type": "code",
      "text": "  class Observable  \n    {\n    public:\n      void registerObserver (Observer * o);\n    }\n    \n  class My_Observer : private Observer  \n    {\n    public:\n      My_Observer (Observable & observable) \n        {\n        observable.registerObserver (this);\n        }\n    private:\n      void callback (...);\n    }",
      "id": "e65bfc1d8d52f98649bf2c409db1106f"
    },
    {
      "type": "html",
      "text": "At first glance, it seems odd that the language will let you pass <i>this</i> to a function expecting a class from which this is privately derived. After all, private derivation means \"is not a\". But it turns out that the language explicitly allows this: <i>Members and friends of a class X can implicitly convert an X* to a pointer to a private immediate base class of X.</i> (ARM 11.2)",
      "id": "e7cb3f26a04ab7269d343ff7f5088356"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "74b777653dc673be5841843ff5f32435"
    },
    {
      "type": "html",
      "text": "\nThe Java equivalent is to implement private interfaces as an (anonymous) inner classes, because Java only allows public interface inheritance.",
      "id": "2ad43b8e64dcdc771c0577c674bf3c5e"
    },
    {
      "type": "html",
      "text": "\nE.g.",
      "id": "320c80ccc94acc84c8f60b077252e41a"
    },
    {
      "type": "code",
      "text": "  interface Observer {\n     void callback( ... );\n  }",
      "id": "4c29332b1a8981cff49fa889cb980b29"
    },
    {
      "type": "code",
      "text": "  interface Observable {\n      void registerObserver( Observer o );\n  }\n  \n  class My_Observer {\n      public My_Observer( final Observable observable ) {\n          observable.registerObserver( new Observer() {\n              public callback( ... ) {\n                  observableCallback( ... );\n              }\n          } );\n      }\n      \n      private void observableCallback( ... ) {\n          ... \n      }\n  }",
      "id": "78c6142a47980c2fc5e6d50dc1bcd8f5"
    },
    {
      "type": "html",
      "text": "-- [[Nat Pryce]]",
      "id": "db441268d3d07b635cced08a65a7ec48"
    },
    {
      "type": "html",
      "text": "See original on  [http://c2.com/cgi/wiki?PrivateInterface c2.com]",
      "id": "99d6e506daaf508d7b5c1e855f2ee8ae"
    }
  ],
  "journal": [
    {
      "date": 1389401866000,
      "id": "0e6cb66d70d0243ee06bfa11097d003e",
      "type": "create",
      "item": {
        "title": "Private Interface",
        "story": [
          {
            "type": "html",
            "text": "[[Category Pattern]]:\nA [[Structural Pattern]] that \"provides a mechanism allowing specific classes to use a non-public subset of a class interface without inadvertently increasing the visibility of any hidden member variables or member functions\".\nIn other words, how to give another class access to some of your \"private\" functions, without making them a \"friend\".",
            "id": "bf40b885de462ca4c07ec5b6205fa7c2"
          },
          {
            "type": "html",
            "text": "\nBy [[James Newkirk]].\nSubmitted to PLoP97 ([[Pattern Languages Of Program Design]]), but not included in the volume three book.",
            "id": "d8eebc21e565fa80a929e91db4ba5af9"
          },
          {
            "type": "html",
            "text": "\nAvailable at [http://www.objectmentor.com www.objectmentor.com] in the publications section",
            "id": "96f09dc1825e65c0dbd479cc2bc65cc6"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "74b777653dc673be5841843ff5f32435"
          },
          {
            "type": "html",
            "text": "\nIn the guise of [[Partial Revelation]], this was one of the interesting features of [[Modula Three]]. In M3, a type definition could be divided up into a set of interfaces which are eventually combined to make up the type. How much of the type you can see depends on which interfaces you have imported into your compilation unit. It's really neat for providing controlled access to a library, for example: to distinguish between those parts of an implementation which are [[Garbage Collected]] and those parts that aren't and have to be looked after.",
            "id": "43979ccb7503f6a3bc4af2e6aaa9204a"
          },
          {
            "type": "html",
            "text": "\nSee [http://www.research.digital.com/SRC/modula-3/html/partial-rev/index.html www.research.digital.com]",
            "id": "77618217ee9ce7ab066fac7eb569af82"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "74b777653dc673be5841843ff5f32435"
          },
          {
            "type": "html",
            "text": "\nThe implementation of this in C++ is beautiful. I've used this when I want to make a C++ class an observer, but I don't want other users of the class to have access to the callbacks. It goes like this (from memory):",
            "id": "d2c2cd1aa399a6172df1276c59404ee1"
          },
          {
            "type": "code",
            "text": "  class Observer \n    {\n    public:\n      void callback (...) = 0;\n    }",
            "id": "e65dd59d5fd31b0089de05a9f1e221f5"
          },
          {
            "type": "code",
            "text": "  class Observable  \n    {\n    public:\n      void registerObserver (Observer * o);\n    }\n    \n  class My_Observer : private Observer  \n    {\n    public:\n      My_Observer (Observable & observable) \n        {\n        observable.registerObserver (this);\n        }\n    private:\n      void callback (...);\n    }",
            "id": "e65bfc1d8d52f98649bf2c409db1106f"
          },
          {
            "type": "html",
            "text": "At first glance, it seems odd that the language will let you pass <i>this</i> to a function expecting a class from which this is privately derived. After all, private derivation means \"is not a\". But it turns out that the language explicitly allows this: <i>Members and friends of a class X can implicitly convert an X* to a pointer to a private immediate base class of X.</i> (ARM 11.2)",
            "id": "e7cb3f26a04ab7269d343ff7f5088356"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "74b777653dc673be5841843ff5f32435"
          },
          {
            "type": "html",
            "text": "\nThe Java equivalent is to implement private interfaces as an (anonymous) inner classes, because Java only allows public interface inheritance.",
            "id": "2ad43b8e64dcdc771c0577c674bf3c5e"
          },
          {
            "type": "html",
            "text": "\nE.g.",
            "id": "320c80ccc94acc84c8f60b077252e41a"
          },
          {
            "type": "code",
            "text": "  interface Observer {\n     void callback( ... );\n  }",
            "id": "4c29332b1a8981cff49fa889cb980b29"
          },
          {
            "type": "code",
            "text": "  interface Observable {\n      void registerObserver( Observer o );\n  }\n  \n  class My_Observer {\n      public My_Observer( final Observable observable ) {\n          observable.registerObserver( new Observer() {\n              public callback( ... ) {\n                  observableCallback( ... );\n              }\n          } );\n      }\n      \n      private void observableCallback( ... ) {\n          ... \n      }\n  }",
            "id": "78c6142a47980c2fc5e6d50dc1bcd8f5"
          },
          {
            "type": "html",
            "text": "-- [[Nat Pryce]]",
            "id": "db441268d3d07b635cced08a65a7ec48"
          },
          {
            "type": "html",
            "text": "See original on  [http://c2.com/cgi/wiki?PrivateInterface c2.com]",
            "id": "99d6e506daaf508d7b5c1e855f2ee8ae"
          }
        ]
      }
    },
    {
      "type": "fork",
      "site": "sfw.c2.com",
      "date": 1628112046525
    }
  ]
}