{
  "title": "services.nginx",
  "story": [
    {
      "type": "paragraph",
      "id": "5f21e39444857879",
      "text": "Support both HTTP and HTTPS in a single virtualHost #25533 [https://github.com/NixOS/nixpkgs/issues/25533 github]"
    },
    {
      "type": "code",
      "id": "6dff3e57c205af44",
      "text": "  services.nginx = {\n    enable = true;\n    recommendedProxySettings = false;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"wiki.ralfbarkow.ch\" = {\n        enableACME = true;\n        enableSSL = true;\n        extraConfig = ''\n          listen 80;\n        '';\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true;\n        };\n      };\n"
    },
    {
      "type": "code",
      "id": "43d23f34602d0ced",
      "text": "[…] trace: warning: config.services.nginx.virtualHosts.<name>.enableSSL is deprecated,\nuse config.services.nginx.virtualHosts.<name>.onlySSL instead."
    },
    {
      "type": "paragraph",
      "id": "e5f732785c78b8d3",
      "text": "Note: We need to check recommendedProxySettings."
    },
    {
      "type": "markdown",
      "id": "630ce6b955c6e48f",
      "text": "# nginx-wiki.nix @dreyeck.ch"
    },
    {
      "type": "paragraph",
      "id": "a550d1f59bbade7f",
      "text": "The new virtualHosts entry [http://blog.dreyeck.ch blog.dreyeck.ch] only affects HTTP. HTTPS is covered by the *.dreyeck.ch entry."
    },
    {
      "type": "code",
      "id": "a1e35151d68b7a77",
      "text": "services.nginx = {\n    enable = true;\n    recommendedProxySettings = true;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"blog.dreyeck.ch\" = {\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:4040\";\n          proxyWebsockets = true; \n        };\n      };\n      \"rgb.dreyeck.ch\" = {\n        forceSSL = true;\n        useACMEHost = \"dreyeck.ch\";\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:8080\"; # see fossil.nix\n          proxyWebsockets = true; \n        };\n      };\n      \"*.dreyeck.ch\" = {\n        useACMEHost = \"dreyeck.ch\";\n        enableSSL = true;\n        extraConfig = ''\n          listen 80;\n        '';\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true; \n        };\n      };\n    };\n  }"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "services.nginx",
        "story": []
      },
      "date": 1684735708494
    },
    {
      "id": "5f21e39444857879",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "5f21e39444857879",
        "text": "⇒ [[services.nginx]]: Support both HTTP and HTTPS in a single virtualHost #25533 [https://github.com/NixOS/nixpkgs/issues/25533 github]"
      },
      "attribution": {
        "page": "2023-05-22"
      },
      "date": 1684735713262
    },
    {
      "type": "edit",
      "id": "5f21e39444857879",
      "item": {
        "type": "paragraph",
        "id": "5f21e39444857879",
        "text": "Support both HTTP and HTTPS in a single virtualHost #25533 [https://github.com/NixOS/nixpkgs/issues/25533 github]"
      },
      "date": 1684735716828
    },
    {
      "id": "6dff3e57c205af44",
      "type": "add",
      "item": {
        "type": "code",
        "id": "6dff3e57c205af44",
        "text": "  services.nginx = {\n    enable = true;\n    recommendedProxySettings = false;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"wiki.ralfbarkow.ch\" = {\n        enableACME = true;\n        enableSSL = true;\n        extraConfig = ''\n          listen 80;\n        '';\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true; # needed if you need to use WebSocket\n        };\n      };\n"
      },
      "after": "5f21e39444857879",
      "attribution": {
        "page": "2023-05-22"
      },
      "date": 1684735719566
    },
    {
      "item": {
        "type": "factory",
        "id": "e5f732785c78b8d3"
      },
      "id": "e5f732785c78b8d3",
      "type": "add",
      "after": "6dff3e57c205af44",
      "date": 1684735740481
    },
    {
      "type": "edit",
      "id": "e5f732785c78b8d3",
      "item": {
        "type": "paragraph",
        "id": "e5f732785c78b8d3",
        "text": "Note: recommendedProxySettings"
      },
      "date": 1684735748416
    },
    {
      "type": "edit",
      "id": "e5f732785c78b8d3",
      "item": {
        "type": "paragraph",
        "id": "e5f732785c78b8d3",
        "text": "Note: We need to check recommendedProxySettings."
      },
      "date": 1684735786863
    },
    {
      "item": {
        "type": "factory",
        "id": "43d23f34602d0ced"
      },
      "id": "43d23f34602d0ced",
      "type": "add",
      "after": "e5f732785c78b8d3",
      "date": 1684735934133
    },
    {
      "id": "43d23f34602d0ced",
      "type": "move",
      "order": [
        "5f21e39444857879",
        "6dff3e57c205af44",
        "43d23f34602d0ced",
        "e5f732785c78b8d3"
      ],
      "date": 1684735936795
    },
    {
      "type": "edit",
      "id": "43d23f34602d0ced",
      "item": {
        "type": "code",
        "id": "43d23f34602d0ced",
        "text": "[…] trace: warning: config.services.nginx.virtualHosts.<name>.enableSSL is deprecated,\nuse config.services.nginx.virtualHosts.<name>.onlySSL instead."
      },
      "date": 1684735942886
    },
    {
      "type": "edit",
      "id": "6dff3e57c205af44",
      "item": {
        "type": "code",
        "id": "6dff3e57c205af44",
        "text": "  services.nginx = {\n    enable = true;\n    recommendedProxySettings = false;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"wiki.ralfbarkow.ch\" = {\n        enableACME = true;\n        enableSSL = true;\n        extraConfig = ''\n          listen 80;\n        '';\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true;\n        };\n      };\n"
      },
      "date": 1684736006253
    },
    {
      "item": {
        "type": "factory",
        "id": "a1e35151d68b7a77"
      },
      "id": "a1e35151d68b7a77",
      "type": "add",
      "after": "e5f732785c78b8d3",
      "date": 1692114297304
    },
    {
      "type": "edit",
      "id": "a1e35151d68b7a77",
      "item": {
        "type": "code",
        "id": "a1e35151d68b7a77",
        "text": "services.nginx = {\n    enable = true;\n    recommendedProxySettings = true;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"blog.dreyeck.ch\" = {\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:4040\";\n          proxyWebsockets = true; # needed if you need to use WebSocket\n        };\n      };\n      \"rgb.dreyeck.ch\" = {\n        forceSSL = true;\n        useACMEHost = \"dreyeck.ch\";\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:8080\"; # see fossil.nix\n          proxyWebsockets = true; # needed if you need to use WebSocket\n        };\n      };\n      \"*.dreyeck.ch\" = {\n        useACMEHost = \"dreyeck.ch\";\n        enableSSL = true;\n        extraConfig = ''\n          listen 80;\n        '';\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true; # needed if you need to use WebSocket\n        };\n      };\n    };\n  }"
      },
      "date": 1692114299199
    },
    {
      "id": "630ce6b955c6e48f",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "630ce6b955c6e48f",
        "text": "//TODO Document the changes to [[services.nginx]] (nginx-wiki.nix @dreyeck.ch) related to blog.dreyeck.ch and port 4040."
      },
      "after": "e5f732785c78b8d3",
      "attribution": {
        "page": "2023-08-15"
      },
      "date": 1692114319591
    },
    {
      "type": "edit",
      "id": "630ce6b955c6e48f",
      "item": {
        "type": "paragraph",
        "id": "630ce6b955c6e48f",
        "text": "nginx-wiki.nix @dreyeck.ch"
      },
      "date": 1692114329588
    },
    {
      "id": "a550d1f59bbade7f",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "a550d1f59bbade7f",
        "text": "I was surprised by the [[services.nginx]] configuration.  The new virtualHosts entry blog.dreyeck.ch only affects HTTP.\nHTTPS is covered by the *.dreyeck.ch entry."
      },
      "after": "630ce6b955c6e48f",
      "attribution": {
        "page": "2023-08-15"
      },
      "date": 1692114390200
    },
    {
      "type": "edit",
      "id": "a550d1f59bbade7f",
      "item": {
        "type": "paragraph",
        "id": "a550d1f59bbade7f",
        "text": "The new virtualHosts entry blog.dreyeck.ch only affects HTTP.\nHTTPS is covered by the *.dreyeck.ch entry."
      },
      "date": 1692114396077
    },
    {
      "type": "edit",
      "id": "a550d1f59bbade7f",
      "item": {
        "type": "paragraph",
        "id": "a550d1f59bbade7f",
        "text": "The new virtualHosts entry blog.dreyeck.ch only affects HTTP. HTTPS is covered by the *.dreyeck.ch entry."
      },
      "date": 1692114400813
    },
    {
      "type": "edit",
      "id": "630ce6b955c6e48f",
      "item": {
        "type": "paragraph",
        "id": "630ce6b955c6e48f",
        "text": "# nginx-wiki.nix @dreyeck.ch"
      },
      "date": 1692114406910
    },
    {
      "type": "edit",
      "id": "630ce6b955c6e48f",
      "item": {
        "type": "markdown",
        "id": "630ce6b955c6e48f",
        "text": "# nginx-wiki.nix @dreyeck.ch"
      },
      "date": 1692114408278
    },
    {
      "type": "edit",
      "id": "a1e35151d68b7a77",
      "item": {
        "type": "code",
        "id": "a1e35151d68b7a77",
        "text": "services.nginx = {\n    enable = true;\n    recommendedProxySettings = true;\n    recommendedTlsSettings = true;\n    virtualHosts = {\n      \"blog.dreyeck.ch\" = {\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:4040\";\n          proxyWebsockets = true; \n        };\n      };\n      \"rgb.dreyeck.ch\" = {\n        forceSSL = true;\n        useACMEHost = \"dreyeck.ch\";\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:8080\"; # see fossil.nix\n          proxyWebsockets = true; \n        };\n      };\n      \"*.dreyeck.ch\" = {\n        useACMEHost = \"dreyeck.ch\";\n        enableSSL = true;\n        extraConfig = ''\n          listen 80;\n        '';\n        locations.\"/\" = {\n          proxyPass = \"http://127.0.0.1:3000\";\n          proxyWebsockets = true; \n        };\n      };\n    };\n  }"
      },
      "date": 1692114449957
    },
    {
      "type": "edit",
      "id": "a550d1f59bbade7f",
      "item": {
        "type": "paragraph",
        "id": "a550d1f59bbade7f",
        "text": "The new virtualHosts entry [http://blog.dreyeck.ch blog.dreyeck.ch] only affects HTTP. HTTPS is covered by the *.dreyeck.ch entry."
      },
      "date": 1692114532116
    }
  ]
}