{
  "title": "HTML Entities in SVG Data URLs",
  "story": [
    {
      "type": "paragraph",
      "id": "484e092159df2d01",
      "text": "HTML entities like &nbsp; and &amp; are tolerated in SVG when embedded directly in an HTML page. The same entities fail to render under the more strict constraints of a data URL. We demonstrate the problem and a workaround using a carefully constructed DOCTYPE declaration."
    },
    {
      "type": "paragraph",
      "id": "caa626ac93aa7d4c",
      "text": "In the frame below we can view the results. The first example is the SVG embedded in HTML. Second example shows a broken image with the same SVG in a data URL. Third example shows a working image using our SVG, prefixed with the doctype and base64 encoded."
    },
    {
      "type": "frame",
      "id": "6cf52409eec3988c",
      "text": "//wiki.dbbs.co/assets/pages/js-snippet-template/importjs.html\nHEIGHT 500"
    },
    {
      "type": "pagefold",
      "id": "8e8a4b6a186d79d9",
      "text": "."
    },
    {
      "type": "paragraph",
      "id": "3364f512c7b6d95e",
      "text": "We begin with a simple SVG document with a <text> element containing HTML entities."
    },
    {
      "type": "code",
      "id": "5eb6b67568179aa3",
      "text": "let svg = `<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"  viewBox=\"0 0 200 100\">\n<text x=\"0\" y=\"75\" transform=\"rotate(-20)\">This&nbsp;&amp;&nbsp;That</text>\n<circle fill=\"lightblue\" cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\nlet result = document.createElement(\"div\")\nresult.innerHTML = svg"
    },
    {
      "type": "paragraph",
      "id": "7d9a157aa4169769",
      "text": "The &nbsp; and &amp; expressions work fine when the SVG document is embedded within an HTML document. But they break when we try to create a Data URL."
    },
    {
      "type": "code",
      "id": "56ab836918caacd5",
      "text": "let broken = document.createElement(\"img\")\nbroken.setAttribute(\"width\", \"100%\")\nbroken.setAttribute(\"height\", \"70px\")\nbroken.setAttribute(\"src\",`data:image/svg+xml,${svg}`)\nresult.appendChild(broken)"
    },
    {
      "type": "paragraph",
      "id": "af3e3d4545c90a52",
      "text": "Declaring the entities in a DOCTYPE and encoding with base64 does what we want."
    },
    {
      "type": "code",
      "id": "a72542aced246591",
      "text": "let entities = `<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">`\nlet doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [${entities}]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+svg)}`)\nresult.appendChild(fixed)"
    },
    {
      "type": "paragraph",
      "id": "52684acb9b3f8820",
      "text": "We export the markup for the interpreter in the frame."
    },
    {
      "type": "code",
      "id": "234caafb7ca32b22",
      "text": "export default result.innerHTML"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "HTML Entities in SVG Data URLs",
        "story": []
      },
      "date": 1623185599470
    },
    {
      "item": {
        "type": "factory",
        "id": "005aa5ebe49c3f7f"
      },
      "id": "005aa5ebe49c3f7f",
      "type": "add",
      "date": 1623185600920
    },
    {
      "type": "remove",
      "id": "005aa5ebe49c3f7f",
      "date": 1623185652927
    },
    {
      "id": "484e092159df2d01",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "484e092159df2d01",
        "text": "Explain what this does."
      },
      "date": 1623185657649
    },
    {
      "id": "5eb6b67568179aa3",
      "type": "add",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "// Code that does it.\n\n2 + 3\n\n"
      },
      "after": "484e092159df2d01",
      "date": 1623185661665
    },
    {
      "id": "caa626ac93aa7d4c",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "caa626ac93aa7d4c",
        "text": "In the frame below we can view the results."
      },
      "after": "5eb6b67568179aa3",
      "date": 1623185665270
    },
    {
      "id": "6cf52409eec3988c",
      "type": "add",
      "item": {
        "type": "frame",
        "id": "6cf52409eec3988c",
        "text": "//wiki.dbbs.co/assets/pages/js-snippet-template/basicjs.html\nHEIGHT 400"
      },
      "after": "caa626ac93aa7d4c",
      "date": 1623185668530
    },
    {
      "type": "edit",
      "id": "6cf52409eec3988c",
      "item": {
        "type": "frame",
        "id": "6cf52409eec3988c",
        "text": "//wiki.dbbs.co/assets/pages/js-snippet-template/importjs.html\nHEIGHT 400"
      },
      "date": 1623185683843
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg viewBox=\"0 0 200 100\">\n<text x=\"50\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"output\").innerHTML = svg"
      },
      "date": 1623185905592
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg viewBox=\"0 0 200 100\">\n<text x=\"50\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"#output\").innerHTML = svg"
      },
      "date": 1623185914197
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle cx=\"175\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"#output\").innerHTML = svg"
      },
      "date": 1623185941590
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle cx=\"170\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"#output\").innerHTML = svg"
      },
      "date": 1623185949012
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"#output\").innerHTML = svg"
      },
      "date": 1623185954628
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle fill=\"lightblue\" cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"#output\").innerHTML = svg"
      },
      "date": 1623185992589
    },
    {
      "type": "add",
      "id": "7d9a157aa4169769",
      "item": {
        "type": "paragraph",
        "id": "7d9a157aa4169769",
        "text": "The &nbsp; and &amp; expressions work fine when the SVG document is embedded within an HTML document. But they break when we try to create a Data URL."
      },
      "after": "5eb6b67568179aa3",
      "date": 1623186116462
    },
    {
      "type": "add",
      "id": "56ab836918caacd5",
      "item": {
        "type": "factory",
        "id": "56ab836918caacd5",
        "text": "let clone = document.querySelector(\"svg\").outterHTML"
      },
      "after": "7d9a157aa4169769",
      "date": 1623186161569
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let clone = document.querySelector(\"svg\").outterHTML\nlet url = `data:image/svg+xml,${clone}`\nlet img = document.createElement(\"img\")\nimg.setAttribute(\"width\", \"100%\")\nimg.setAttribute(\"src\", url)\ndocument.querySelector(\"#output\").appendChild(img)"
      },
      "date": 1623186310198
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let clone = document.querySelector(\"svg\").outterHTML\nlet url = `data:image/svg+xml,${clone}`\nlet img = document.createElement(\"img\")\nimg.setAttribute(\"width\", \"100%\")\nimg.setAttribute(\"height\", \"30px\")\nimg.setAttribute(\"src\", url)\ndocument.querySelector(\"#output\").appendChild(img)"
      },
      "date": 1623186351912
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let clone = document.querySelector(\"svg\").outterHTML\nlet url = `data:image/svg+xml,${clone}`\nlet img = document.createElement(\"img\")\nimg.setAttribute(\"width\", \"100%\")\nimg.setAttribute(\"height\", \"70px\")\nimg.setAttribute(\"src\", url)\ndocument.querySelector(\"#output\").appendChild(img)"
      },
      "date": 1623186359657
    },
    {
      "type": "add",
      "id": "af3e3d4545c90a52",
      "item": {
        "type": "paragraph",
        "id": "af3e3d4545c90a52",
        "text": "Declaring the entities in a DOCTYPE does what we want."
      },
      "after": "56ab836918caacd5",
      "date": 1623186417438
    },
    {
      "type": "add",
      "id": "a72542aced246591",
      "item": {
        "type": "factory",
        "id": "a72542aced246591",
        "text": "let fixed = document.createElement(\"img\")"
      },
      "after": "af3e3d4545c90a52",
      "date": 1623186444633
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml,${doctype}${clone}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623186624512
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml,${doctype}${clone}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623186679628
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+clone)}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623186720928
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+svg)}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623186767260
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let img = document.createElement(\"img\")\nimg.setAttribute(\"width\", \"100%\")\nimg.setAttribute(\"height\", \"70px\")\nimg.setAttribute(\"src\", `data:image/svg+xml,${svg}`)\ndocument.querySelector(\"#output\").appendChild(img)"
      },
      "date": 1623186843299
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml,${doctype+svg}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623187239231
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\"height\", \"70px\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml,${doctype+svg}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623187734873
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\"height\", \"70px\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+svg)}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623187766406
    },
    {
      "type": "add",
      "id": "ecf7ded47a3cef27",
      "item": {
        "type": "paragraph",
        "id": "ecf7ded47a3cef27",
        "text": "One more try using regexp."
      },
      "after": "a72542aced246591",
      "date": 1623187827136
    },
    {
      "type": "add",
      "id": "2e1d2e48365072e8",
      "item": {
        "type": "paragraph",
        "id": "2e1d2e48365072e8",
        "text": "let three = document.createElement(\"img\")"
      },
      "after": "ecf7ded47a3cef27",
      "date": 1623187855262
    },
    {
      "type": "edit",
      "id": "2e1d2e48365072e8",
      "item": {
        "type": "code",
        "id": "2e1d2e48365072e8",
        "text": "let it = svg\n  .replace(/&npbs;/g, \"&#160;\")\n  .replace(/&amp;/g, \"&#38;\")\nlet three = document.createElement(\"img\")\nthree.setAttribute(\"width\", \"100%\")\nthree.setAttribute(\"height\", \"120px\")\nthree.setAttribute(\"src\",`data:image/svg+xml,${it}`)\ndocument.querySelector(\"#output\").appendChild(three)"
      },
      "date": 1623188057075
    },
    {
      "type": "edit",
      "id": "2e1d2e48365072e8",
      "item": {
        "type": "code",
        "id": "2e1d2e48365072e8",
        "text": "let it = svg\n  .replaceAll(\"&npbs;\", \"&#160;\")\n  .replaceAll(\"&amp;\", \"&#38;\")\nlet three = document.createElement(\"img\")\nthree.setAttribute(\"width\", \"100%\")\nthree.setAttribute(\"height\", \"120px\")\nthree.setAttribute(\"src\",`data:image/svg+xml,${it}`)\ndocument.querySelector(\"#output\").appendChild(three)"
      },
      "date": 1623188171232
    },
    {
      "type": "edit",
      "id": "2e1d2e48365072e8",
      "item": {
        "type": "code",
        "id": "2e1d2e48365072e8",
        "text": "let it = svg\n  .replaceAll(\"&nbsp;\", \"&#160;\")\n  .replaceAll(\"&amp;\", \"&#38;\")\nlet three = document.createElement(\"img\")\nthree.setAttribute(\"width\", \"100%\")\nthree.setAttribute(\"height\", \"120px\")\nthree.setAttribute(\"src\",`data:image/svg+xml,${it}`)\ndocument.querySelector(\"#output\").appendChild(three)"
      },
      "date": 1623188210259
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"  viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle fill=\"lightblue\" cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\ndocument.querySelector(\"#output\").innerHTML = svg"
      },
      "date": 1623188318714
    },
    {
      "type": "remove",
      "id": "2e1d2e48365072e8",
      "date": 1623188335059
    },
    {
      "type": "remove",
      "id": "ecf7ded47a3cef27",
      "date": 1623188337709
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+svg)}`)\ndocument.querySelector(\"#output\").appendChild(fixed)"
      },
      "date": 1623188345625
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"  viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\">This&nbsp;&amp;&nbsp;That</text>\n<circle fill=\"lightblue\" cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\nlet result = document.createElement(\"div\")\nresult.innerHTML = svg"
      },
      "date": 1623188436856
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let img = document.createElement(\"img\")\nimg.setAttribute(\"width\", \"100%\")\nimg.setAttribute(\"height\", \"70px\")\nimg.setAttribute(\"src\", `data:image/svg+xml,${svg}`)\nresult.appendChild(img)"
      },
      "date": 1623188443457
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+svg)}`)\nresult.appendChild(fixed)"
      },
      "date": 1623188455603
    },
    {
      "type": "add",
      "id": "52684acb9b3f8820",
      "item": {
        "type": "paragraph",
        "id": "52684acb9b3f8820",
        "text": "We export the result."
      },
      "after": "a72542aced246591",
      "date": 1623188478239
    },
    {
      "type": "add",
      "id": "234caafb7ca32b22",
      "item": {
        "type": "factory",
        "id": "234caafb7ca32b22",
        "text": "export default result"
      },
      "after": "52684acb9b3f8820",
      "date": 1623188492708
    },
    {
      "type": "edit",
      "id": "234caafb7ca32b22",
      "item": {
        "type": "code",
        "id": "234caafb7ca32b22",
        "text": "export default result "
      },
      "date": 1623188497696
    },
    {
      "type": "edit",
      "id": "234caafb7ca32b22",
      "item": {
        "type": "code",
        "id": "234caafb7ca32b22",
        "text": "export default result.innerHTML"
      },
      "date": 1623188523050
    },
    {
      "type": "edit",
      "id": "6cf52409eec3988c",
      "item": {
        "type": "frame",
        "id": "6cf52409eec3988c",
        "text": "//wiki.dbbs.co/assets/pages/js-snippet-template/importjs.html\nHEIGHT 550"
      },
      "date": 1623188556924
    },
    {
      "type": "edit",
      "id": "6cf52409eec3988c",
      "item": {
        "type": "frame",
        "id": "6cf52409eec3988c",
        "text": "//wiki.dbbs.co/assets/pages/js-snippet-template/importjs.html\nHEIGHT 500"
      },
      "date": 1623188564303
    },
    {
      "type": "edit",
      "id": "52684acb9b3f8820",
      "item": {
        "type": "paragraph",
        "id": "52684acb9b3f8820",
        "text": "We export the markup for the interpreter in the frame."
      },
      "date": 1623188662114
    },
    {
      "type": "edit",
      "id": "484e092159df2d01",
      "item": {
        "type": "paragraph",
        "id": "484e092159df2d01",
        "text": "HTML entities like &nbsp; and &amp; are tolerated in SVG when embedded directly in an HTML page. The same entities fail to render under the more strict constraints of a data URL. We demonstrate the problem and a workaround using a carefully constructed DOCTYPE declaration."
      },
      "date": 1623189058296
    },
    {
      "type": "edit",
      "id": "a72542aced246591",
      "item": {
        "type": "code",
        "id": "a72542aced246591",
        "text": "let entities = `<!ENTITY amp \"&#38;\"> <!ENTITY nbsp \"&#160;\">`\nlet doctype = `<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [${entities}]>`\nlet fixed = document.createElement(\"img\")\nfixed.setAttribute(\"width\", \"100%\")\nfixed.setAttribute(\n  \"src\",\n  `data:image/svg+xml;base64,${btoa(doctype+svg)}`)\nresult.appendChild(fixed)"
      },
      "date": 1623189140022
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let broken = document.createElement(\"img\")\nbroken.setAttribute(\"width\", \"100%\")\nbroken.setAttribute(\"height\", \"70px\")\nbroken.setAttribute(\"src\", `data:image/svg+xml,${svg}`)\nresult.appendChild(img)"
      },
      "date": 1623189158261
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let broken = document.createElement(\"img\")\nbroken.setAttribute(\"width\", \"100%\")\nbroken.setAttribute(\"height\", \"70px\")\nbroken.setAttribute(\"src\",`data:image/svg+xml,${svg}`)\nresult.appendChild(img)"
      },
      "date": 1623189169871
    },
    {
      "type": "edit",
      "id": "af3e3d4545c90a52",
      "item": {
        "type": "paragraph",
        "id": "af3e3d4545c90a52",
        "text": "Declaring the entities in a DOCTYPE and encoding with base64 does what we want."
      },
      "date": 1623189218693
    },
    {
      "type": "edit",
      "id": "56ab836918caacd5",
      "item": {
        "type": "code",
        "id": "56ab836918caacd5",
        "text": "let broken = document.createElement(\"img\")\nbroken.setAttribute(\"width\", \"100%\")\nbroken.setAttribute(\"height\", \"70px\")\nbroken.setAttribute(\"src\",`data:image/svg+xml,${svg}`)\nresult.appendChild(broken)"
      },
      "date": 1623189226984
    },
    {
      "type": "edit",
      "id": "caa626ac93aa7d4c",
      "item": {
        "type": "paragraph",
        "id": "caa626ac93aa7d4c",
        "text": "In the frame below we can view the results. The first example is the SVG embedded in HTML. Second example shows a broken image with the same SVG in a data URL. Third example shows a working image using our SVG, prefixed with the doctype and base64 encoded."
      },
      "date": 1623189519599
    },
    {
      "type": "add",
      "id": "3364f512c7b6d95e",
      "item": {
        "type": "paragraph",
        "id": "3364f512c7b6d95e",
        "text": "We begin with a simple SVG document with a <text> element containing HTML entities."
      },
      "after": "484e092159df2d01",
      "date": 1623190126541
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"  viewBox=\"0 0 200 100\">\n<text x=\"25\" y=\"50\" transform=\"rotate(20deg)\">This&nbsp;&amp;&nbsp;That</text>\n<circle fill=\"lightblue\" cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\nlet result = document.createElement(\"div\")\nresult.innerHTML = svg"
      },
      "date": 1623190185714
    },
    {
      "type": "edit",
      "id": "5eb6b67568179aa3",
      "item": {
        "type": "code",
        "id": "5eb6b67568179aa3",
        "text": "let svg = `<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"  viewBox=\"0 0 200 100\">\n<text x=\"0\" y=\"75\" transform=\"rotate(-20)\">This&nbsp;&amp;&nbsp;That</text>\n<circle fill=\"lightblue\" cx=\"150\" cy=\"50\" r=\"30\" />\n</svg>`\n\nlet result = document.createElement(\"div\")\nresult.innerHTML = svg"
      },
      "date": 1623190294038
    },
    {
      "id": "caa626ac93aa7d4c",
      "type": "move",
      "order": [
        "484e092159df2d01",
        "caa626ac93aa7d4c",
        "3364f512c7b6d95e",
        "5eb6b67568179aa3",
        "7d9a157aa4169769",
        "56ab836918caacd5",
        "af3e3d4545c90a52",
        "a72542aced246591",
        "52684acb9b3f8820",
        "234caafb7ca32b22",
        "6cf52409eec3988c"
      ],
      "date": 1623190378878
    },
    {
      "id": "6cf52409eec3988c",
      "type": "move",
      "order": [
        "484e092159df2d01",
        "6cf52409eec3988c",
        "caa626ac93aa7d4c",
        "3364f512c7b6d95e",
        "5eb6b67568179aa3",
        "7d9a157aa4169769",
        "56ab836918caacd5",
        "af3e3d4545c90a52",
        "a72542aced246591",
        "52684acb9b3f8820",
        "234caafb7ca32b22"
      ],
      "date": 1623190406576
    },
    {
      "id": "caa626ac93aa7d4c",
      "type": "move",
      "order": [
        "484e092159df2d01",
        "caa626ac93aa7d4c",
        "6cf52409eec3988c",
        "3364f512c7b6d95e",
        "5eb6b67568179aa3",
        "7d9a157aa4169769",
        "56ab836918caacd5",
        "af3e3d4545c90a52",
        "a72542aced246591",
        "52684acb9b3f8820",
        "234caafb7ca32b22"
      ],
      "date": 1623190413379
    },
    {
      "type": "add",
      "id": "8e8a4b6a186d79d9",
      "item": {
        "type": "factory",
        "id": "8e8a4b6a186d79d9",
        "text": "..."
      },
      "after": "6cf52409eec3988c",
      "date": 1623190460022
    },
    {
      "type": "edit",
      "id": "8e8a4b6a186d79d9",
      "item": {
        "type": "pagefold",
        "id": "8e8a4b6a186d79d9",
        "text": "."
      },
      "date": 1623190466159
    },
    {
      "type": "fork",
      "site": "wiki.dbbs.co",
      "date": 1701932038034
    },
    {
      "type": "fork",
      "site": "localhost:3000",
      "date": 1701932184448
    }
  ]
}