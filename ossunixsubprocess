{
  "title": "OSSUnixSubprocess",
  "story": [
    {
      "type": "markdown",
      "id": "ebf87682320f2e0f",
      "text": "OSSUnixSubprocess is the main interface for spwaning subprocesses in a Unix OS. \n\nA process consist at minimun of a program/command to be executed (a Unix binary..could be cat , ls, cp,  custom shell scripts, etc etc.  ) and an optional list of arguments that will be passed to that program.\n\nThis class also allows you to define streams  (either StandardFileStream or OSSPipe) that will be mapped to the underlying standard streams stdout/stderr/stdin. This way it provides an API for reading and writing from those. In addition, it takes care of opening, closing, cleaning and all the rest of streams operations. \n\nIt also provides code for checking the status or waiting the exit of the OS process. Different strategies are supported (SIGCHLD based or delay polling). See the different methods in the protocol 'running'.' In addition, once the subprocess was started, the subprocess instance is registered in OSSVMProcess which takes care of handling the child death via the childWatcher. \n\nSome additional features involved env variable settings (environmentAt:put:) for the child, defining a working directory (#workingDirectory: ), facilities for shell commands, etc.\n\nTo achieve it's goals, this class relies on OSSUnixSystemAccessor for accessing Unix system calls. \n\nAs for  implementation details to spwan processes this class relies on the posix_spwan() family of functions which we call via FFI. \n\nThe following is ONE example of ONE possible usage. We define and set settings which are actually the default, so they wouldn't make sense..but just for showing the most of the API:\n\nOSSUnixSubprocess new\t\n\tcommand: 'ls';\n\targuments: (Array with: Smalltalk image imagePath);\n\tdefaultWriteStreamCreationBlock: [ OSSVMProcess vmProcess systemAccessor makeNonBlockingPipe ];\n\tredirectStdout; \"automatic default stream creation...above closure.\"\n\tredirectStderrTo: '/tmp/stderrFile.txt' asFileReference writeStream; \"custom stream creation\"\n\tcreateMissingStandardStreams: false; \"therefore won't create stdin stream\"\n\tworkingDirectory: '/home'; \"set working directory for child\"\n\tenvironmentAt: 'HOME' put: '/tmp/home';\n\taddAllEnvVariablesFromParentWithoutOverride; \"we will inherit then all but $HOME\"\n\trunAndWaitOnExitDo: [ :command :outString :errString |\n\t\tself assert: (outString includesSubstring: Smalltalk image imagePath).\t\n\t\tself assert: command isSuccess.\n\t\tself assert: errString isEmpty. \n\t]\n\t \n\n\n\n"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "OSSUnixSubprocess",
        "story": []
      },
      "date": 1662019233210
    },
    {
      "item": {
        "type": "factory",
        "id": "ebf87682320f2e0f"
      },
      "id": "ebf87682320f2e0f",
      "type": "add",
      "date": 1662019237191
    },
    {
      "type": "edit",
      "id": "ebf87682320f2e0f",
      "item": {
        "type": "markdown",
        "id": "ebf87682320f2e0f",
        "text": "OSSUnixSubprocess is the main interface for spwaning subprocesses in a Unix OS. \n\nA process consist at minimun of a program/command to be executed (a Unix binary..could be cat , ls, cp,  custom shell scripts, etc etc.  ) and an optional list of arguments that will be passed to that program.\n\nThis class also allows you to define streams  (either StandardFileStream or OSSPipe) that will be mapped to the underlying standard streams stdout/stderr/stdin. This way it provides an API for reading and writing from those. In addition, it takes care of opening, closing, cleaning and all the rest of streams operations. \n\nIt also provides code for checking the status or waiting the exit of the OS process. Different strategies are supported (SIGCHLD based or delay polling). See the different methods in the protocol 'running'.' In addition, once the subprocess was started, the subprocess instance is registered in OSSVMProcess which takes care of handling the child death via the childWatcher. \n\nSome additional features involved env variable settings (environmentAt:put:) for the child, defining a working directory (#workingDirectory: ), facilities for shell commands, etc.\n\nTo achieve it's goals, this class relies on OSSUnixSystemAccessor for accessing Unix system calls. \n\nAs for  implementation details to spwan processes this class relies on the posix_spwan() family of functions which we call via FFI. \n\nThe following is ONE example of ONE possible usage. We define and set settings which are actually the default, so they wouldn't make sense..but just for showing the most of the API:\n\nOSSUnixSubprocess new\t\n\tcommand: 'ls';\n\targuments: (Array with: Smalltalk image imagePath);\n\tdefaultWriteStreamCreationBlock: [ OSSVMProcess vmProcess systemAccessor makeNonBlockingPipe ];\n\tredirectStdout; \"automatic default stream creation...above closure.\"\n\tredirectStderrTo: '/tmp/stderrFile.txt' asFileReference writeStream; \"custom stream creation\"\n\tcreateMissingStandardStreams: false; \"therefore won't create stdin stream\"\n\tworkingDirectory: '/home'; \"set working directory for child\"\n\tenvironmentAt: 'HOME' put: '/tmp/home';\n\taddAllEnvVariablesFromParentWithoutOverride; \"we will inherit then all but $HOME\"\n\trunAndWaitOnExitDo: [ :command :outString :errString |\n\t\tself assert: (outString includesSubstring: Smalltalk image imagePath).\t\n\t\tself assert: command isSuccess.\n\t\tself assert: errString isEmpty. \n\t]\n\t \n\n\n\n"
      },
      "date": 1662019239391
    }
  ]
}