{
  "title": "Tally Server Log Events",
  "story": [
    {
      "type": "paragraph",
      "id": "0b4f2bbbc1471da5",
      "text": "The server writes logs that are too big to read without the aid of ad-hoc computer tools. But pretty neat analysis can be done on a single command line."
    },
    {
      "type": "paragraph",
      "id": "444be92623fccc48",
      "text": "I often notice that the server is struggling when I can't send email. I'll check and find it running at a load average of 50 or above. I'll shut down apache to regain control, deny further access to the offender, then try to figure out what they were doing."
    },
    {
      "type": "paragraph",
      "id": "417948b8e2e78aa4",
      "text": "I noticed that one user was running cgi/test 10 or 20 times a second. What's with this? The tiny cgi just reports query parameters that don't change much from call to call?"
    },
    {
      "type": "paragraph",
      "id": "3a0045bf093fbcc6",
      "text": "I wondered, how long and how hard has this user been pounding my machine?"
    },
    {
      "type": "paragraph",
      "id": "026c04c8b5e4c16f",
      "text": "I grep lines logging the script; extract the time; count the times; and format the counts as a graph."
    },
    {
      "type": "code",
      "id": "cf75f9412d5101bd",
      "text": "grep cgi/test /var/log/httpd/access_log |\nperl -ne '/2012:(\\d\\d:\\d)/; print \"${1}0\\n\"' |\nsort | uniq -c | \nperl -pe '/\\d+/;$x=\"|\"x($&/1000);s/$/\\t$x/'\n"
    },
    {
      "type": "paragraph",
      "id": "2174fffec9c51bd4",
      "text": "Here I've chosen to look and ten minute buckets by matching hh:m. I scale the graph accordingly."
    },
    {
      "type": "html",
      "id": "e1d0c0f5828a3659",
      "text": "<pre>      4 04:30\t\n      1 04:40\t\n   7835 04:50\t|||||||\n  12191 05:00\t||||||||||||\n  12460 05:10\t||||||||||||\n  13059 05:20\t|||||||||||||\n  13130 05:30\t|||||||||||||\n  12932 05:40\t||||||||||||\n  13410 05:50\t|||||||||||||\n  13491 06:00\t|||||||||||||\n   9374 06:10\t|||||||||\n  27600 06:20\t|||||||||||||||||||||||||||\n  35685 06:30\t|||||||||||||||||||||||||||||||||||\n  35639 06:40\t|||||||||||||||||||||||||||||||||||\n  19043 06:50\t|||||||||||||||||||\n"
    },
    {
      "type": "paragraph",
      "id": "ad951d5008913f5c",
      "text": "The traffic stopped at 06:55 when I denied access to the server. The server still recorded denied accesses so I could watch the request rate drop off second by second over three minutes."
    },
    {
      "type": "paragraph",
      "id": "70b1d4604379405a",
      "text": "Running variations of this program I could see that the request rate dropped off linearly. Could the user have spawned a mass of jobs that kept fetching cgi/test in a loop? Could I have been watching these jobs die one by one? "
    },
    {
      "type": "paragraph",
      "id": "82f46391e97b53dd",
      "text": "The launch at 04:50 looked human. The escalation at 6:20 looked human. But the controlled relief at 6:55 definitely looked like a computer's response."
    }
  ],
  "journal": [
    {
      "type": "create",
      "id": "16ccbe6782cb1dd5",
      "item": {
        "title": "Tally Server Log Events"
      },
      "date": 1344954775979
    },
    {
      "item": {
        "type": "factory",
        "id": "0b4f2bbbc1471da5"
      },
      "id": "0b4f2bbbc1471da5",
      "type": "add",
      "date": 1344954778306
    },
    {
      "type": "edit",
      "id": "0b4f2bbbc1471da5",
      "item": {
        "type": "paragraph",
        "id": "0b4f2bbbc1471da5",
        "text": "The server writes logs too big to read without the aid of ad-hoc computer tools. But pretty neat analysis can be done on a single command line."
      },
      "date": 1344954912730
    },
    {
      "item": {
        "type": "paragraph",
        "id": "444be92623fccc48",
        "text": ""
      },
      "id": "444be92623fccc48",
      "type": "add",
      "after": "0b4f2bbbc1471da5",
      "date": 1344954913235
    },
    {
      "type": "edit",
      "id": "444be92623fccc48",
      "item": {
        "type": "paragraph",
        "id": "444be92623fccc48",
        "text": "I often notice that the server is struggling when I can't send email. I'll check and find it running at a load average of 50 or above. I'll shut down apache to regain control, deny further access to the offender, then try to figure out what they were doing."
      },
      "date": 1344955060733
    },
    {
      "item": {
        "type": "paragraph",
        "id": "417948b8e2e78aa4",
        "text": ""
      },
      "id": "417948b8e2e78aa4",
      "type": "add",
      "after": "444be92623fccc48",
      "date": 1344955061238
    },
    {
      "type": "edit",
      "id": "417948b8e2e78aa4",
      "item": {
        "type": "paragraph",
        "id": "417948b8e2e78aa4",
        "text": "I noticed that one user was running cgi/test 10 or 20 times a second. What's with this? The tiny cgi just reports query parameters that don't change much from call to call?"
      },
      "date": 1344955148003
    },
    {
      "item": {
        "type": "paragraph",
        "id": "b093c0b73e591189",
        "text": ""
      },
      "id": "b093c0b73e591189",
      "type": "add",
      "after": "417948b8e2e78aa4",
      "date": 1344955148507
    },
    {
      "type": "remove",
      "id": "b093c0b73e591189",
      "date": 1344955158178
    },
    {
      "item": {
        "type": "factory",
        "id": "cf75f9412d5101bd"
      },
      "id": "cf75f9412d5101bd",
      "type": "add",
      "after": "417948b8e2e78aa4",
      "date": 1344955163241
    },
    {
      "type": "edit",
      "id": "cf75f9412d5101bd",
      "item": {
        "type": "code",
        "id": "cf75f9412d5101bd",
        "text": "mumble"
      },
      "date": 1344955172700
    },
    {
      "type": "edit",
      "id": "cf75f9412d5101bd",
      "item": {
        "type": "code",
        "id": "cf75f9412d5101bd",
        "text": "grep cgi/test /var/log/httpd/access_log |\nperl -ne '/2012:(\\d\\d:\\d)/; print \"${1}0\\n\"' |\nsort | uniq -c | \nperl -pe '/\\d+/;$x=\"|\"x($&/1000);s/$/\\t$x/'\n"
      },
      "date": 1344955218231
    },
    {
      "item": {
        "type": "factory",
        "id": "e1d0c0f5828a3659"
      },
      "id": "e1d0c0f5828a3659",
      "type": "add",
      "after": "cf75f9412d5101bd",
      "date": 1344955259849
    },
    {
      "type": "edit",
      "id": "e1d0c0f5828a3659",
      "item": {
        "type": "paragraph",
        "id": "e1d0c0f5828a3659",
        "text": "<pre>      4 04:30\t\n      1 04:40\t\n   7835 04:50\t|||||||\n  12191 05:00\t||||||||||||\n  12460 05:10\t||||||||||||\n  13059 05:20\t|||||||||||||\n  13130 05:30\t|||||||||||||\n  12932 05:40\t||||||||||||\n  13410 05:50\t|||||||||||||\n  13491 06:00\t|||||||||||||\n   9374 06:10\t|||||||||\n  27600 06:20\t|||||||||||||||||||||||||||\n  35685 06:30\t|||||||||||||||||||||||||||||||||||\n  35639 06:40\t|||||||||||||||||||||||||||||||||||\n  19043 06:50\t|||||||||||||||||||\n"
      },
      "date": 1344955268728
    },
    {
      "type": "edit",
      "id": "0b4f2bbbc1471da5",
      "item": {
        "type": "paragraph",
        "id": "0b4f2bbbc1471da5",
        "text": "The server writes logs that are too big to read without the aid of ad-hoc computer tools. But pretty neat analysis can be done on a single command line."
      },
      "date": 1344955297623
    },
    {
      "item": {
        "type": "paragraph",
        "id": "3a0045bf093fbcc6",
        "text": ""
      },
      "id": "3a0045bf093fbcc6",
      "type": "add",
      "after": "417948b8e2e78aa4",
      "date": 1344955329526
    },
    {
      "type": "edit",
      "id": "3a0045bf093fbcc6",
      "item": {
        "type": "paragraph",
        "id": "3a0045bf093fbcc6",
        "text": "I wondered, how long and how hard has this user been pounding my machine. "
      },
      "date": 1344955372149
    },
    {
      "item": {
        "type": "paragraph",
        "id": "026c04c8b5e4c16f",
        "text": ""
      },
      "id": "026c04c8b5e4c16f",
      "type": "add",
      "after": "3a0045bf093fbcc6",
      "date": 1344955372654
    },
    {
      "type": "edit",
      "id": "026c04c8b5e4c16f",
      "item": {
        "type": "paragraph",
        "id": "026c04c8b5e4c16f",
        "text": "I grep lines that run the script; extract the time; count lines for each time; and format it as a graph."
      },
      "date": 1344955552368
    },
    {
      "item": {
        "type": "paragraph",
        "id": "2174fffec9c51bd4",
        "text": ""
      },
      "id": "2174fffec9c51bd4",
      "type": "add",
      "after": "026c04c8b5e4c16f",
      "date": 1344955572335
    },
    {
      "type": "edit",
      "id": "2174fffec9c51bd4",
      "item": {
        "type": "paragraph",
        "id": "2174fffec9c51bd4",
        "text": "Here I've chosen to look and ten minute buckets by matching hh:m. I scale the graph accordingly."
      },
      "date": 1344955642286
    },
    {
      "type": "move",
      "order": [
        "0b4f2bbbc1471da5",
        "444be92623fccc48",
        "417948b8e2e78aa4",
        "3a0045bf093fbcc6",
        "026c04c8b5e4c16f",
        "cf75f9412d5101bd",
        "2174fffec9c51bd4",
        "e1d0c0f5828a3659"
      ],
      "id": "2174fffec9c51bd4",
      "date": 1344955647478
    },
    {
      "item": {
        "type": "paragraph",
        "id": "ad951d5008913f5c",
        "text": ""
      },
      "id": "ad951d5008913f5c",
      "type": "add",
      "after": "e1d0c0f5828a3659",
      "date": 1344955799908
    },
    {
      "type": "edit",
      "id": "ad951d5008913f5c",
      "item": {
        "type": "paragraph",
        "id": "ad951d5008913f5c",
        "text": "The traffic stopped at 06:55 when I denied access to the server. The server still recorded denied accesses so I could watch the request rate drop off second by second."
      },
      "date": 1344955914213
    },
    {
      "type": "edit",
      "id": "ad951d5008913f5c",
      "item": {
        "type": "paragraph",
        "id": "ad951d5008913f5c",
        "text": "The traffic stopped at 06:55 when I denied access to the server. The server still recorded denied accesses so I could watch the request rate drop off second by second over three minutes."
      },
      "date": 1344956136138
    },
    {
      "item": {
        "type": "paragraph",
        "id": "70b1d4604379405a",
        "text": ""
      },
      "id": "70b1d4604379405a",
      "type": "add",
      "after": "ad951d5008913f5c",
      "date": 1344956136644
    },
    {
      "type": "edit",
      "id": "70b1d4604379405a",
      "item": {
        "type": "paragraph",
        "id": "70b1d4604379405a",
        "text": "Running variations of this program I could see that the request rate dropped off linearly. Could the user have spawned a mass of jobs that kept fetching cgi/test in a loop? Could I have been watching these jobs die one by one? "
      },
      "date": 1344956293589
    },
    {
      "item": {
        "type": "paragraph",
        "id": "82f46391e97b53dd",
        "text": ""
      },
      "id": "82f46391e97b53dd",
      "type": "add",
      "after": "70b1d4604379405a",
      "date": 1344956371531
    },
    {
      "type": "edit",
      "id": "82f46391e97b53dd",
      "item": {
        "type": "paragraph",
        "id": "82f46391e97b53dd",
        "text": "The launch at 04:50 looked human. The escalation at 6:20 looked human. But the controlled relief at 6:55 definitely looked like a computer's response."
      },
      "date": 1344956493864
    },
    {
      "type": "edit",
      "id": "3a0045bf093fbcc6",
      "item": {
        "type": "paragraph",
        "id": "3a0045bf093fbcc6",
        "text": "I wondered, how long and how hard has this user been pounding my machine?"
      },
      "date": 1344956568310
    },
    {
      "type": "edit",
      "id": "026c04c8b5e4c16f",
      "item": {
        "type": "paragraph",
        "id": "026c04c8b5e4c16f",
        "text": "I grep lines logging the script; extract the time; count the times; and format it as a graph."
      },
      "date": 1344956633420
    },
    {
      "type": "edit",
      "id": "026c04c8b5e4c16f",
      "item": {
        "type": "paragraph",
        "id": "026c04c8b5e4c16f",
        "text": "I grep lines logging the script; extract the time; count the times; and format the counts as a graph."
      },
      "date": 1344956648690
    },
    {
      "type": "edit",
      "id": "e1d0c0f5828a3659",
      "item": {
        "type": "html",
        "id": "e1d0c0f5828a3659",
        "text": "<pre>      4 04:30\t\n      1 04:40\t\n   7835 04:50\t|||||||\n  12191 05:00\t||||||||||||\n  12460 05:10\t||||||||||||\n  13059 05:20\t|||||||||||||\n  13130 05:30\t|||||||||||||\n  12932 05:40\t||||||||||||\n  13410 05:50\t|||||||||||||\n  13491 06:00\t|||||||||||||\n   9374 06:10\t|||||||||\n  27600 06:20\t|||||||||||||||||||||||||||\n  35685 06:30\t|||||||||||||||||||||||||||||||||||\n  35639 06:40\t|||||||||||||||||||||||||||||||||||\n  19043 06:50\t|||||||||||||||||||\n"
      },
      "date": 1421017102159
    },
    {
      "type": "fork",
      "site": "code.fed.wiki.org",
      "date": 1627474260393
    }
  ]
}