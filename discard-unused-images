{
  "title": "Discard Unused Images",
  "story": [
    {
      "type": "paragraph",
      "id": "03e828512d46f412",
      "text": "I've hesitated to make minor adjustments to images uploaded by the new Image plugin for fear of polluting the shared image cache with unused content. Here we explore how we might clean up after such changes."
    },
    {
      "type": "paragraph",
      "id": "72ea5d71c8264fb1",
      "text": "We configure the Assets plugin to view this site's image cache. Click the link to view an image."
    },
    {
      "type": "assets",
      "id": "d00889c6d1cc86b9",
      "text": "plugins/image"
    },
    {
      "type": "paragraph",
      "id": "cf43e3c4bade4ae2",
      "text": "We can discover unused images by updating the [[Image Caption Survey]] then running a diff comparing the above list with that found by survey."
    },
    {
      "type": "code",
      "id": "f282ad3aa589109b",
      "text": "diff <(curl -s 'http://photos.ward.dojo.fed.wiki/plugin/assets/list?assets=plugins%2Fimage' | jq -r '.files[]' | sort) <(curl -s 'http://photos.ward.dojo.fed.wiki/image-caption-survey.json' | jq -r '.story[3].survey[].images[].url' | sort | uniq | while read i; do basename $i; done)"
    },
    {
      "type": "paragraph",
      "id": "7c820dd61f57761a",
      "text": "This reports discrepancies. A left pointing arrow (<) indicates an unused image in the cache."
    },
    {
      "type": "code",
      "id": "28efe61e8c177ea0",
      "text": "35d34\n< ff8951b7c8f56c253f15618c2d716fd8.jpg"
    },
    {
      "type": "paragraph",
      "id": "f1846d707ee2eb38",
      "text": "We can locate, preview and then delete the unwanted image from the Assets plugin above."
    },
    {
      "type": "markdown",
      "id": "11b71c89bed22599",
      "text": "# History"
    },
    {
      "type": "paragraph",
      "id": "adfad05b155f250e",
      "text": "Consider that the Journal retains Image items in the edit history that won't be noticed by the survey. When we delete images from the cache, they can't be recalled."
    },
    {
      "type": "paragraph",
      "id": "b12b58264ee66554",
      "text": "We may choose to revert to earlier history so as to avoid this inconsistency. Realize that [[Recycled Pages]] will similarly retain now inconsistent image cache references that are probably best discarded."
    },
    {
      "type": "markdown",
      "id": "26b471ee195e337f",
      "text": "# Orphans"
    },
    {
      "type": "paragraph",
      "id": "ff99ba434e5f3f02",
      "text": "The new Image plugin maintains a server wide replica of site specific image caches. A server administrator can locate when this cache holds images that are no longer used based on the hard link use count."
    },
    {
      "type": "code",
      "id": "2e93a66c6f129269",
      "text": "find .wiki/commons -type f -links -2"
    },
    {
      "type": "paragraph",
      "id": "aee0e0287498b7eb",
      "text": "A confident admin can remove these."
    },
    {
      "type": "code",
      "id": "09a7b2f4501a317e",
      "text": "find .wiki/commons -type f -links -2 |\\\n  while read i; do rm $i; done"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "Discard Unused Images",
        "story": []
      },
      "date": 1675042849387
    },
    {
      "item": {
        "type": "factory",
        "id": "03e828512d46f412"
      },
      "id": "03e828512d46f412",
      "type": "add",
      "date": 1675042900582
    },
    {
      "type": "edit",
      "id": "03e828512d46f412",
      "item": {
        "type": "paragraph",
        "id": "03e828512d46f412",
        "text": "I've hesitated to make minor adjustments to images uploaded by the new Image plugin for fear of polluting the shared image cache with unused content. Here we explore how we might clean up after such changes."
      },
      "date": 1675043074593
    },
    {
      "item": {
        "type": "factory",
        "id": "72ea5d71c8264fb1"
      },
      "id": "72ea5d71c8264fb1",
      "type": "add",
      "after": "03e828512d46f412",
      "date": 1675043084786
    },
    {
      "type": "edit",
      "id": "72ea5d71c8264fb1",
      "item": {
        "type": "paragraph",
        "id": "72ea5d71c8264fb1",
        "text": "We configure the Assets plugin to view this site's image cache. Click to view images."
      },
      "date": 1675043149487
    },
    {
      "item": {
        "type": "factory",
        "id": "d00889c6d1cc86b9"
      },
      "id": "d00889c6d1cc86b9",
      "type": "add",
      "after": "72ea5d71c8264fb1",
      "date": 1675043154386
    },
    {
      "type": "edit",
      "id": "d00889c6d1cc86b9",
      "item": {
        "type": "assets",
        "id": "d00889c6d1cc86b9",
        "text": "plugins/image"
      },
      "date": 1675043162655
    },
    {
      "item": {
        "type": "factory",
        "id": "cf43e3c4bade4ae2"
      },
      "id": "cf43e3c4bade4ae2",
      "type": "add",
      "after": "d00889c6d1cc86b9",
      "date": 1675043205008
    },
    {
      "type": "edit",
      "id": "cf43e3c4bade4ae2",
      "item": {
        "type": "paragraph",
        "id": "cf43e3c4bade4ae2",
        "text": "We can discover unused images by updating the "
      },
      "date": 1675043229319
    },
    {
      "type": "edit",
      "id": "cf43e3c4bade4ae2",
      "item": {
        "type": "paragraph",
        "id": "cf43e3c4bade4ae2",
        "text": "We can discover unused images by updating the [[Image Caption Survey]] then running a diff comparing the above list with that found by survey."
      },
      "date": 1675043294090
    },
    {
      "item": {
        "type": "factory",
        "id": "f282ad3aa589109b"
      },
      "id": "f282ad3aa589109b",
      "type": "add",
      "after": "cf43e3c4bade4ae2",
      "date": 1675043311643
    },
    {
      "type": "edit",
      "id": "f282ad3aa589109b",
      "item": {
        "type": "code",
        "id": "f282ad3aa589109b",
        "text": "diff <(curl -s 'http://photos.ward.dojo.fed.wiki/plugin/assets/list?assets=plugins%2Fimage' | jq -r '.files[]' | sort) <(curl -s 'http://photos.ward.dojo.fed.wiki/image-caption-survey.json' | jq -r '.story[3].survey[].images[].url' | sort | uniq | while read i; do basename $i; done)"
      },
      "date": 1675043315530
    },
    {
      "item": {
        "type": "factory",
        "id": "7c820dd61f57761a"
      },
      "id": "7c820dd61f57761a",
      "type": "add",
      "after": "f282ad3aa589109b",
      "date": 1675043374821
    },
    {
      "type": "edit",
      "id": "7c820dd61f57761a",
      "item": {
        "type": "paragraph",
        "id": "7c820dd61f57761a",
        "text": "This reports discrepancies. A left pointing arrow (<) indicates an unused image in the cache."
      },
      "date": 1675043481277
    },
    {
      "item": {
        "type": "factory",
        "id": "28efe61e8c177ea0"
      },
      "id": "28efe61e8c177ea0",
      "type": "add",
      "after": "7c820dd61f57761a",
      "date": 1675043487684
    },
    {
      "type": "edit",
      "id": "28efe61e8c177ea0",
      "item": {
        "type": "code",
        "id": "28efe61e8c177ea0",
        "text": "35d34\n< ff8951b7c8f56c253f15618c2d716fd8.jpg"
      },
      "date": 1675043491927
    },
    {
      "item": {
        "type": "factory",
        "id": "f1846d707ee2eb38"
      },
      "id": "f1846d707ee2eb38",
      "type": "add",
      "after": "28efe61e8c177ea0",
      "date": 1675043635296
    },
    {
      "type": "edit",
      "id": "f1846d707ee2eb38",
      "item": {
        "type": "paragraph",
        "id": "f1846d707ee2eb38",
        "text": "We can locate, preview and then delete the unwanted image from the Assets plugin above."
      },
      "date": 1675043730455
    },
    {
      "item": {
        "type": "factory",
        "id": "11b71c89bed22599"
      },
      "id": "11b71c89bed22599",
      "type": "add",
      "after": "f1846d707ee2eb38",
      "date": 1675043904335
    },
    {
      "type": "edit",
      "id": "11b71c89bed22599",
      "item": {
        "type": "markdown",
        "id": "11b71c89bed22599",
        "text": "# History"
      },
      "date": 1675043980875
    },
    {
      "item": {
        "type": "factory",
        "id": "adfad05b155f250e"
      },
      "id": "adfad05b155f250e",
      "type": "add",
      "after": "11b71c89bed22599",
      "date": 1675043985150
    },
    {
      "type": "edit",
      "id": "adfad05b155f250e",
      "item": {
        "type": "paragraph",
        "id": "adfad05b155f250e",
        "text": "Consider that the Journal retains Image items in the edit history that won't be noticed by the survey. When we delete images from the cache, they can't be recalled."
      },
      "date": 1675044123066
    },
    {
      "type": "add",
      "id": "b12b58264ee66554",
      "item": {
        "type": "paragraph",
        "id": "b12b58264ee66554",
        "text": "We may choose to revert to earlier history so as to avoid this inconsistency. Realize that [[Recycled Pages]] will similarly retain now inconsistent image cache references that are probably best discarded."
      },
      "after": "adfad05b155f250e",
      "date": 1675044373641
    },
    {
      "item": {
        "type": "factory",
        "id": "26b471ee195e337f"
      },
      "id": "26b471ee195e337f",
      "type": "add",
      "after": "b12b58264ee66554",
      "date": 1675045350206
    },
    {
      "type": "edit",
      "id": "26b471ee195e337f",
      "item": {
        "type": "markdown",
        "id": "26b471ee195e337f",
        "text": "# Orphans"
      },
      "date": 1675045363919
    },
    {
      "item": {
        "type": "factory",
        "id": "ff99ba434e5f3f02"
      },
      "id": "ff99ba434e5f3f02",
      "type": "add",
      "after": "26b471ee195e337f",
      "date": 1675045366444
    },
    {
      "type": "edit",
      "id": "ff99ba434e5f3f02",
      "item": {
        "type": "paragraph",
        "id": "ff99ba434e5f3f02",
        "text": "The new Image plugin maintains a server wide replica of site specific image caches. A server administrator can locate when this cache holds images that are no longer used."
      },
      "date": 1675045576358
    },
    {
      "item": {
        "type": "factory",
        "id": "2e93a66c6f129269"
      },
      "id": "2e93a66c6f129269",
      "type": "add",
      "after": "ff99ba434e5f3f02",
      "date": 1675045590200
    },
    {
      "type": "edit",
      "id": "2e93a66c6f129269",
      "item": {
        "type": "code",
        "id": "2e93a66c6f129269",
        "text": "find .wiki/commons -type f -links -2"
      },
      "date": 1675045605839
    },
    {
      "item": {
        "type": "factory",
        "id": "09a7b2f4501a317e"
      },
      "id": "09a7b2f4501a317e",
      "type": "add",
      "after": "2e93a66c6f129269",
      "date": 1675045807264
    },
    {
      "type": "edit",
      "id": "09a7b2f4501a317e",
      "item": {
        "type": "code",
        "id": "09a7b2f4501a317e",
        "text": "find .wiki/commons -type f -links -2 |\\  while read i; do rm $i; done"
      },
      "date": 1675045824354
    },
    {
      "type": "edit",
      "id": "09a7b2f4501a317e",
      "item": {
        "type": "code",
        "id": "09a7b2f4501a317e",
        "text": "find .wiki/commons -type f -links -2 |\\\n  while read i; do rm $i; done"
      },
      "date": 1675045838179
    },
    {
      "type": "add",
      "id": "aee0e0287498b7eb",
      "item": {
        "type": "paragraph",
        "id": "aee0e0287498b7eb",
        "text": "A confident admin can remove orphans with one command."
      },
      "after": "ff99ba434e5f3f02",
      "date": 1675045988335
    },
    {
      "type": "edit",
      "id": "aee0e0287498b7eb",
      "item": {
        "type": "paragraph",
        "id": "aee0e0287498b7eb",
        "text": "A confident admin can remove these."
      },
      "date": 1675046007264
    },
    {
      "id": "aee0e0287498b7eb",
      "type": "move",
      "order": [
        "03e828512d46f412",
        "72ea5d71c8264fb1",
        "d00889c6d1cc86b9",
        "cf43e3c4bade4ae2",
        "f282ad3aa589109b",
        "7c820dd61f57761a",
        "28efe61e8c177ea0",
        "f1846d707ee2eb38",
        "11b71c89bed22599",
        "adfad05b155f250e",
        "b12b58264ee66554",
        "26b471ee195e337f",
        "ff99ba434e5f3f02",
        "2e93a66c6f129269",
        "aee0e0287498b7eb",
        "09a7b2f4501a317e"
      ],
      "date": 1675046010182
    },
    {
      "type": "edit",
      "id": "ff99ba434e5f3f02",
      "item": {
        "type": "paragraph",
        "id": "ff99ba434e5f3f02",
        "text": "The new Image plugin maintains a server wide replica of site specific image caches. A server administrator can locate when this cache holds images that are no longer used based on the hard link use count."
      },
      "date": 1675046051346
    },
    {
      "type": "edit",
      "id": "72ea5d71c8264fb1",
      "item": {
        "type": "paragraph",
        "id": "72ea5d71c8264fb1",
        "text": "We configure the Assets plugin to view this site's image cache. Click the link to view an image."
      },
      "date": 1675047658174
    },
    {
      "type": "fork",
      "site": "photos.ward.dojo.fed.wiki",
      "date": 1675333651480
    }
  ]
}