{
  "title": "Generalised Free Energy and Active Inference",
  "story": [
    {
      "type": "markdown",
      "id": "7502fa94ebf7aad8",
      "text": "T. Parr and K. J. Friston, “Generalised free energy and active inference,” Biol Cybern, vol. 113, no. 5, pp. 495–513, Dec. 2019, doi: 10.1007/s00422-019-00805-w.\n"
    },
    {
      "type": "markdown",
      "id": "e855e6952cd4b473",
      "text": "> **Abstract**. Active inference is an approach to understanding behaviour that rests upon the idea that the brain uses an internal generative model to predict incoming sensory data. The fit between this model and data may be improved in two ways. The brain could optimise probabilistic beliefs about the variables in the generative model (i.e. perceptual inference). Alternatively, by acting on the world, it could change the sensory data, such that they are more consistent with the model. This implies a common objective function (variational free energy) for action and perception that scores the fit between an internal model and the world. We compare two free energy functionals for active inference in the framework of Markov decision processes. One of these is a functional of beliefs (i.e. probability distributions) about states and policies, but a function of observations, while the second is a functional of beliefs about all three. In the former (expected free energy), prior beliefs about outcomes are not part of the generative model (because they are absorbed into the prior over policies). Conversely, in the second (generalised free energy), priors over outcomes become an explicit component of the generative model. When using the free energy function, which is blind to future observations, we equip the generative model with a prior over policies that ensure preferred (i.e. priors over) outcomes are realised. In other words, if we expect to encounter a particular kind of outcome, this lends plausibility to those policies for which this outcome is a consequence. In addition, this formulation ensures that selected policies minimise uncertainty about future outcomes by minimising the free energy expected in the future. When using the free energy functional—that effectively treats future observations as hidden states—we show that policies are inferred or selected that realise prior preferences by minimising the free energy of future expectations. Interestingly, the form of posterior beliefs about policies (and associated belief updating) turns out to be identical under both formulations, but the quantities used to compute them are not.\n"
    },
    {
      "type": "markdown",
      "id": "96ce7acc443d8478",
      "text": "# Introduction\nOver the past years, we have tried to establish active inference (a corollary of the free energy principle) as a relatively straightforward and principled explanation for action, perception and cognition. Active inference can be summarised as self-evidencing (Hohwy 2016), in the sense that action and perception can be cast as maximising Bayesian model evidence, under generative models of the world. When this maximisation uses approximate Bayesian inference, this is equivalent to minimising variational free energy (Friston et al. 2006)—a form of bounded rational behaviour that minimises a variational bound on model evidence. Recently, we have migrated the basic idea from models that generate continuous sensations (like velocity and luminance contrast) (Brown and Friston 2012) to discrete state-space models, specifically Markov decision processes (Friston et al. 2017a). These models represent the world in terms of discrete states, like I am on this page and reading this word (Friston et al. 2017d). Discrete state-space models can be inferred using belief propagation (Yedidia et al. 2005) or variational message passing (Dauwels 2007; Winn 2004) schemes that have a degree of neuronal plausibility (Friston et al. 2017c). The resulting planning as inference scheme (Attias 2003; Baker et al. 2009; Botvinick and Toussaint 2012; Verma and Rao 2006) has a pleasingly broad explanatory scope, accounting for a range of phenomena in cognitive neuroscience, active vision and motor control (see Table 1). In this paper, we revisit the role of (expected) free energy in active inference and offer an alternative, simpler and more general formulation. This formulation does not substantially change the message passing or belief updating; however, it provides an interesting perspective on planning as inference and the way that we may perceive the future.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "cd09b764b05c15ae",
      "text": "Table 1 Applications of active inference for Markov decision processes\nFull size table\nIn current descriptions of active inference, the basic argument goes as follows: active inference is based upon the maximisation of model evidence or minimisation of variational free energy in two complementary ways. First, one can update one’s beliefs about latent or hidden states of the world to make them consistent with observed evidence—or one can actively sample the world to make observations consistent with beliefs about states of the world. The important thing here is that both action and perception are in game of minimising the same quantity, namely variational free energy. A key aspect of this formulation is that action (i.e. behaviour) is absorbed into inference, which means that agents have beliefs about what they are doing—and will do. This calls for prior beliefs about action or policies (i.e. sequences of actions). So where did these prior beliefs come from?\n\n\n"
    },
    {
      "type": "markdown",
      "id": "c150d55fbc8a26da",
      "text": "The answer obtains from a reductio ad absurdum argument: if action realises prior beliefs and minimises free energy, then the only tenable prior beliefs are that action will minimise free energy. If this were not the case, we reach the following absurd conclusion. If a free energy minimising creature did not have the prior belief that it selects policies that minimise (expected) free energy, it would infer (and therefore pursue) policies that were not free energy minimising. As such, it would not be a free energy minimising creature, which is a contradiction. This leads to the prior belief that I will select policies that minimise the free energy expected under that policy. The endpoint of this argument is that action or policy selection becomes a form of Bayesian model selection, where the evidence for a particular policy becomes the free energy expected in the future. This expected free energy is a slightly unusual objective function because it scores the evidence for plausible policies based on outcomes that have yet to be observed. This means that the expected free energy becomes the variational free energy expected under (posterior predictive) beliefs about outcomes. These priors are usually informed by prior beliefs about outcomes that play the role of prior preferences or utility functions in reinforcement learning and economics.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "32b837ccb1f4102a",
      "text": "In summary, beliefs about states of the world and policies are continuously updated to minimise variational free energy, where posterior beliefs about policies (that prescribe action) are based upon expected free energy (that may or may not include prior preferences over future outcomes). This is the current story and leads to interesting issues that rest on the fact that expected free energy can be decomposed into epistemic and pragmatic parts (Friston et al. 2015). This decomposition provides a principled explanation for the epistemics of planning and inference that underwrite the exploitation and exploration dilemma, novelty, salience and so on. However, there is another way of telling this story that leads to a conceptually different sort of interpretation.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "f98ae91698dd69ab",
      "text": "In what follows, we show that the same Bayesian policy (model) selection obtains from minimising variational free energy when future outcomes are treated as hidden or latent states of the world. In other words, we can regard active inference as minimising a generalised free energy under generative models that entertain the consequences of (policy-dependent) hidden states of the world in the future. This simple generalisation induces posterior beliefs over future outcomes that now play the role of latent or hidden states. In this setting, the future is treated in exactly the same way as the hidden or unobservable states of the world generating observations in the past. On this view, one gets the expected free energy for free, because the variational free energy involves an expectation under posterior beliefs over future outcomes. In turn, this means that beliefs about states and policies can be simply and uniformly treated as minimising the same (generalised) free energy, without having to invoke any free energy minimising priors over policies.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "2e9f9307840cebb5",
      "text": "Technically, this leads to the same form of belief updating and (Bayesian) policy selection but provides a different perspective on the free energy principle per se. This perspective says that self-evidencing and active inference both have one underlying imperative, namely to minimise generalised free energy or uncertainty. When this uncertainty is evaluated under models that generate outcomes in the future, future outcomes become hidden states that are only revealed by the passage of time. In this context, outcomes in the past become observations in standard variational inference, while outcomes in the future become posterior beliefs about latent observations that have yet to disclose themselves. In this way, the generalised free energy can be seen as comprising variational free energy contributions from the past and future.\n\nThe current paper provides the formal basis for the above arguments. In brief, we will see that both the expected and generalised free energy formulations lead to the same update equations. However, there is a subtle difference. In the expected free energy formalism, prior preferences or beliefs about outcomes are used to specify the prior over policies. In the generalised formulation, prior beliefs about outcomes in the future inform posterior beliefs about the hidden states that cause them. Because of the implicit forward and backward message passing in the belief propagation scheme obtained at the free energy minimum (Yedidia et al. 2005), these prior beliefs or preferences act to distort expected trajectories (into the future) towards preferences in an optimistic way (Sharot et al. 2012). Intuitively, the expected free energy contribution to generalised free energy evaluates the (complexity) cost of this distortion, thereby favouring policies that lead naturally to preferred outcomes—without violating beliefs about state transitions and the (likelihood) mapping between states and outcomes. The implicit coupling between beliefs about the future and current actions means that, in one sense, the future can cause the past.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "9fd630fb7bf645eb",
      "text": "Framing probabilistic reasoning in terms of inferential message passing formalises several prominent concepts in the study of human decision making. The idea that prior beliefs distort beliefs about future and that this optimism about the future propagates backwards in time to influence behaviour in an adaptive way (McKay and Dennett 2010; Sharot 2011), is highly consistent with an influence of beliefs about the future over beliefs about the present. Simplistically, the idea behind these accounts is that adaptive behaviour relies upon the (possibly false) belief that future events will accord with our preferences. It is only by believing that we will realise these goals that we act in a manner consistent with their realisation. Intuitively, without the belief that we will end up eating dinner, there would be no reason to shop for ingredients. The passing of messages from past to future resonates with the notion that working memory is vital for predicting the future and planning actions accordingly (Gilhooly 2005; Hikosaka et al. 2000), and underwrites research on episodic future thinking and counterfactual reasoning (Schacter et al. 2015). Appealing to bidirectional inferential message passing has enabled us to reproduce a range of behavioural and electrophysiological phenomena through simulation (summarised in Table 1).\n\n\n"
    },
    {
      "type": "markdown",
      "id": "e71bd0039aea4fc0",
      "text": "This paper comprises three sections. In the first, we outline the approach we have used to date (i.e. minimising the variational free energy under prior beliefs that policies with a low expected free energy are more probable). In the second, we introduce a generalisation of the variational free energy that incorporates beliefs about future outcomes. The third section compares these two approaches conceptually and through illustrative simulations.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "ed028bcbfafd6df9",
      "text": "Active inference and variational free energy\n"
    },
    {
      "type": "markdown",
      "id": "598af739b3625934",
      "text": "The free energy principle is motivated by the defining characteristic of living creatures, namely that they persist in the face of a changing world. In other words, their states occupy a small proportion of all possible states with a high probability. From the perspective of statistical physics, this means that they show a form of self-organised, non-equilibrium steady-state that maintains a low entropy probability distribution over their states. In information theory, self-information or surprise (a.k.a. negative log model evidence) averaged over time is [[entropy]]. More generally, entropy is defined in terms of an ensemble average. However, under that assumption that a system has achieved its (non-equilibrium) steady state, the ensemble and time average are equivalent (under mild weakly mixing assumptions). This means, at any given time, all biological systems are compelled to minimise their surprise. While this may seem like a very bold statement, we do not intend to trivialise the many constraints that dictate behaviour. The point here is that when all these constraints are written into a generative model as prior beliefs, they all contribute to the same cost function: surprise. This reframes the problem of expressing the constraints biological systems must satisfy as a problem of specifying the right set of priors. Although the computation of surprise is often intractable, an approximation is simple to calculate. This is variational free energy (Beal 2003; Dayan et al. 1995; Friston 2003) which depends upon specifying a generative model of how data are caused. This generative model comprises a series of conditional probability distributions. For a Markov decision process, it assumes a series of states (s) that evolve through time. At each time step, the probability of transitioning from one state to the next depends upon a policy (π). Neither states nor policies are directly accessible to the creature in question. However, each state probabilistically generates an observable outcome (o). As Jensen’s inequality demonstrates, free energy is an upper bound on surprise.\n"
    },
    {
      "type": "markdown",
      "id": "1c2dcb9ffa6f2d72",
      "text": "\n𝐹⏟Freeenergy=−𝐸𝑄(𝑠̃,𝜋)[ln𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]≥−ln𝐸𝑄(𝑠̃,𝜋)[𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]Jensen′sinequality=−ln𝑃(𝑜̃)Surprise\nF\n⏟\nFree\nenergy\n=\n−\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nln\n⁡\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n≥\n−\nln\n⁡\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n⏟\nJensen\n′\ns\ninequality\n=\n−\nln\n⁡\nP\n(\no\n~\n)\n⏟\n\n"
    },
    {
      "type": "markdown",
      "id": "77d3395122dc0e6a",
      "text": "Surprise\nIn the equation above,  indicates a probability distribution over outcomes 𝑜̃=(𝑜1,𝑜2,…,𝑜𝑇)\no\n~\n=\n(\no\n1\n,\no\n2\n,\n…\n,\no\nT\n)\n that are generated by hidden states of the world 𝑠̃=(𝑠1,𝑠2,…,𝑠𝑇)\ns\n~\n=\n(\ns\n1\n,\ns\n2\n,\n…\n,\ns\nT\n)\n \n"
    },
    {
      "type": "markdown",
      "id": "bb9d19da533d61c7",
      "text": "and policies, which define the generative model. The generative model is thus expressed as a joint probability distribution over outcomes (i.e. consequences) and their causes (i.e. hidden states of the world and policies available to the agent). Marginalising (i.e. summing or integrating) over the states and policies gives the evidence (a.k.a., marginal likelihood). The log of this marginal likelihood is negative surprise.  is a probability distribution over unobservable (hidden) states and policies—that becomes an approximate posterior distribution as free energy is minimised. The minimisation of free energy over time ensures entropy does not increase, thereby enabling biological systems to resist the second law of thermodynamics and their implicit dissipation or decay.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "d2c264a7db61d407",
      "text": "Note that the generative model is not a model of the biological system itself, but an implicit model of how the environment generates its sensory data. The dynamics of inference and behaviour that we are interested in here emerge from minimising free energy under an appropriate choice of generative model. For readers with a physics background, and analogy would be that the free energy plays the role of a Lagrangian whose ‘potential energy’ component is given by the generative model. Just as a Lagrangian is used to recover the equations of motion for a physical system, we use the free energy to recover the belief updates that determine a biological system’s behaviour.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "c3da15f55be05fa0",
      "text": "In the following, we begin by describing the form of the generative model we have used to date. We will then address the form of the approximate posterior distribution. To make inference tractable, this generally involves a mean-field approximation that factorises the approximate posterior distribution into independent factors or marginal distributions.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "03d60d686c9a2e6b",
      "text": "The generative models used in this paper are subtly different for each free energy functional, but the variables themselves are the same. These are policies (𝜋\nπ\n) and state trajectories (𝑠̃\ns\n~\n), all of which are latent (unknown random) variables that have to be inferred. States evolve as a discrete Markov chain, where the transition probabilities are functions of the policy. Likelihood distributions probabilistically map hidden states to observations (𝑜̃\no\n~\n). Figure  (left) shows these dependencies as a graphical Bayesian network. This type of generative model has been used extensively in simulations of active inference (FitzGerald et al. , ; Friston et al. , , , ; Schwartenbeck et al. ), see Table .\n\n\n"
    },
    {
      "type": "markdown",
      "id": "627fb909b9146d09",
      "text": "Fig. 1\nfigure1\nMarkov decision process. This shows the basic structure of the discrete state-space generative model used in this paper, assuming the current time is t = τ. The factor graph on the left is the generative model we have used in previous work. Importantly, the prior belief about observations only enters this graph through the expected free energy, 𝐺\nG\n (see main text), which enters the prior over policies. Policies index alternative trajectories, or sequences, of actions. In this sense, they are not time dependent, as each policy determines a sequence of actions for all time-points. Conversely, the actions (u) are time dependent. U is an array that specifies an action for each time step (rows) and each policy (columns). The selected action therefore depends upon the most likely policy and the action that policy implies for that time step. Action selection is technically not part of the generative model, as it relies upon the posterior distribution Q (please see main text for details), obtained by inverting the model. This is an important, aspect of active inference, as it underwrites the way in which the system performing inference may change the process generating its observed data. The grey region of this graph indicates that the observation at the next time step is not yet available, so cannot yet be incorporated into the graph. The right factor graph is the new version of the generative model considered in this paper. This generative model does not require an expected free energy, and the prior over outcomes enters the model directly as a constraint on outcomes. This also shows a time dependence, as future outcomes are treated as unobserved latent variables (indicated by an unfilled circle). Observed variables are shown as filled circles in both graphs and unobserved variables as unfilled circles. Factors of the generative model (i.e. conditional probability distributions and prior probabilities) are shown as squares. These squares are connected to those circles containing variables that participate in the same factor. Please refer to the main text and Table 2 for a description of the variables. In the panel on the right, the definitions are given for each of the factors in blue squares. Here, Cat refers to the categorical distribution (color figure online)\n\n"
    },
    {
      "type": "markdown",
      "id": "10bfb4c4838863e1",
      "text": "Full size image\n\n"
    },
    {
      "type": "markdown",
      "id": "82ef4608454a729c",
      "text": "The role of the generative model is simply to define the free energy functional which, as we will see in Sects. –, gives rise to the belief update rules that we will employ for our simulations. However, it is helpful to imagine how we might generate data from such a model. We outline this process with the model on the left of Fig.  in mind. We could start at the first time step and sample a state from the categorical prior over initial states. The parameters of this prior () are simply a vector of probabilities for each alternative state. From this, we can now sample from the likelihood. This is formulated as a matrix (), whose columns correspond to a state and whose rows are the alternative outcomes that may be generated. To generate an outcome, we would select the column of this matrix corresponding to the state we sampled and sample an outcome from this column-vector of probabilities. It is this outcome that would be available to a synthetic creature.\n"
    },
    {
      "type": "markdown",
      "id": "98c45f5a21630bff",
      "text": "\nTaking a discrete time step into the future, we can sample a new state from the column of a transition matrix () associated with the state at the previous time. Crucially, the transition probabilities are conditioned upon the selected action. This means we have a separate -matrix for each action. Action selection depends upon the policy, with each policy and time point associated with an action. For the model on the left of Fig. , this means we calculate the expected free energy () for each policy, which depends upon a vector of prior probabilities for outcomes under these policies (). Combining these with a prior bias term ()—as set out in more detail in Sect. —we can construct a prior over policies. Sampling from this and selecting the action that corresponds to this policy, at this time, specify the -matrix from which to sample the state for the current time step. We could then sample the outcome for this time from the relevant column of the -matrix. This process can be repeated for a series of discrete time steps, generating a new outcome for each time. A similar approach could be taken to generate data from the model on the right of Fig. . However, note that the likelihood here comprises both  and , and the policy prior only includes  (i.e. the expected free energy does not explicitly feature in this model). The procedure outlined above provides an intuition into the beliefs a creature has about how its sensory data are generated by acting on hidden states in the environment.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "907cc2b9de05b71b",
      "text": "It is worth noting that the free energy is a  of the distributions in the generative model and of the approximate posterior beliefs, but a  of observations. Continuing with this free energy, we now consider the mean-field approximation in current implementations of active inference, and its consequences for the variational free energy. In the next few sections, we unpack the variational free energy, and its role in active inference based on Markov decision processes. The argument that follows is a little involved, but we summarise the key steps here, such that the agenda of each of the following sections is clear. In Sect. , we specify the form of the variational distribution we employ, and the free energy that results from this. In Sect. , we unpack the terms in the free energy as they pertain to the generative model. This depends upon having a prior belief about policies. Section  attempts to identify this prior, through finding the optimal posterior and extrapolating backwards in time. This highlights a shortcoming of this approach that is resolved in Sect. . In addition to providing a more appropriate prior for policy selection, Sect.  sets out the role of free energy in simulating behaviour. In brief, this involves finding the variational distribution over policies that minimises free energy. As free energy is a function of sensory observations, this means we need to update these distributions following each new observation. Section  follows the same approach to find the free energy minima for beliefs about states, giving the fixed points to which these distributions must be updated following each new observation.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "52862b5905754e0a",
      "text": "Definition of the mean-field variational free energy\nTo define the variational free energy for the above generative model, we first need to specify the form of the approximate posterior distribution, 𝑄\nQ\n. We do this via a mean-field approximation that treats the (policy dependent) state at each time step as approximately independent of the state at any other time step. We treat the distribution over the policy as a separate factor, which implies a set of (policy) models, 𝜋\nπ\n, over hidden variables 𝑠𝜏\ns\nτ\n:\n\n𝑄(𝑠̃,𝜋)=𝑄(𝜋)∏𝜏𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\n~\n,\nπ\n)\n=\nQ\n(\nπ\n)\n∏\nτ\nQ\n(\ns\nτ\n|\nπ\n)\n\n"
    },
    {
      "type": "markdown",
      "id": "22219767640fc90c",
      "text": "Mean-field approximations originated in statistical physics, where they can be used to approximate Helmholtz free energy through appealing to an average with respect to a ‘reference’ Hamiltonian. This reference can be simply defined for a system with non-interacting components (or degrees of freedom). In virtue of the assumption that the system’s degrees of freedom do not interact, their Hamiltonian (scaled negative log probability) may be expressed as a sum of contributions from each component. Exponentiating this sum, the probability density can be expressed as a product of marginal probabilities for each degree of freedom. The same idea has been employed extensively in statistical inference and machine learning, where a mean-field approximation refers to the use of a variational distribution comprising a product of marginals (Winn and Bishop ; Yedidia et al. ). The ‘mean field’ is the expected value of each (log) factor of the generative model (), which include the interactions, under the fully factorised distribution (). The advantage to using a mean-field approximation is the computational tractability that comes from being able to separately optimise each marginal distribution. We can now substitute this factorised distribution into our definition for the variational free energy above:\n\n\n"
    },
    {
      "type": "markdown",
      "id": "2708a6a22f254bdb",
      "text": "𝐹=𝐸𝑄(𝜋)[𝐹𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝐹𝜋=−𝐸𝑄(𝑠̃|𝜋)[ln𝑃(𝑜̃,𝑠̃|𝜋)−∑𝜏ln𝑄(𝑠𝜏|𝜋)]\nF=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=−\nE\nQ\n(\ns\n~\n|\nπ\n)\n[ln⁡P(\no\n~\n,\ns\n~\n|\nπ)−\n∑\nτ\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n] \n\n"
    },
    {
      "type": "markdown",
      "id": "6445f86ed8ef1b23",
      "text": "In this form, the variational free energy is expressed in terms of policy-dependent terms (second equality) that bound the (negative log) evidence for each policy and a complexity cost or KL divergenceFootnote 1 () that scores the departure of the posterior beliefs over policies from the corresponding prior beliefs.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "456da10290e506be",
      "text": "Past and future\n\n"
    },
    {
      "type": "markdown",
      "id": "802de4abd7cdf2dc",
      "text": "There is an important difference in how past and future outcomes are treated by the variational free energy. Note that—as a function of outcomes—the components of the free energy that depend on outcomes can only be evaluated for the past and present. Hidden states, on the other hand, enter the expression as  about states. In other words, the free energy is a functional of distributions over states, rather than a function, as in the case of outcomes. This means that free energy evaluation takes account of future states. We can express this explicitly by writing the variational free energy, at time , as a sum over all time steps, factorising the generative distribution according to the conditional independencies expressed in Fig. :\n"
    },
    {
      "type": "markdown",
      "id": "f210cc63390352df",
      "text": "\n𝐹𝜋=∑𝜏𝐹𝜋𝜏𝐹𝜋𝜏=−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[[𝜏≤𝑡]⋅ln𝑃(𝑜𝜏|𝑠𝜏)+ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)−ln𝑄(𝑠𝜏|𝜋)]\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\n[\nτ\n≤\nt\n]\n⋅\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n+\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n]\n \n\n"
    },
    {
      "type": "markdown",
      "id": "19dc9bdb60f290b2",
      "text": "In the above, the Iverson (square) brackets return 1 if the expression is true, and 0 otherwise. It is this condition that differentiates contributions from the past from the future. This equation is obtained in a straightforward way by factorising the generative model (joint distribution) in the second line of Eq. , in line with the generative model depicted in Fig. . Because the generative model does not include future observations as random variables (given that these data have yet to be collected), there are no accompanying likelihood factors. This reflects the fact that the only data that contribute to the free energy are those we currently have access to. Given the dependence of the right-hand side on the current time () the free energy should, strictly speaking, be written as a function of  and . As we are interested here in online inference, we will assume an implicit conditioning upon  for all free energies throughout this paper. The Iverson brackets above allow us to decompose the sum into past and future components:\n\n\n"
    },
    {
      "type": "markdown",
      "id": "b0b0338102c8a832",
      "text": "𝐹𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷KL[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nKL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\n\n"
    },
    {
      "type": "markdown",
      "id": "ab62a73c5a358c5b",
      "text": "Complexity\n(5)\nIn this decomposition, the contribution of beliefs about future states reduces to a complexity cost. This is the KL divergence between approximate posterior beliefs about states in the future and prior beliefs. The latter are based upon the (policy-specific) transition probabilities in the generative model.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "6df0cf52eb73a28e",
      "text": "Policy posteriors and priors\n\n"
    },
    {
      "type": "markdown",
      "id": "c7a03df60343a857",
      "text": "Using the full variational free energy (over all policies) from Eq. 3, we can evaluate posterior beliefs about policies. The variational derivative of the free energy with respect to these beliefs is (where we omit constants, and where 𝜎(⋅)\nσ\n(\n⋅\n)\n is a softmax function—i.e. a normalised exponential function):\n\n𝛿𝐹𝛿𝑄(𝜋)=𝐹𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(6)\n\n"
    },
    {
      "type": "markdown",
      "id": "ee782f82ba593e82",
      "text": "The second line derives from the first through rearranging, exponentiating both sides of the equation, and normalising to ensure the approximate posterior sums to one. This, together with Eq. 5, implies the belief prior to any observations (i.e. at 𝑡=0\nt\n=\n0\n), which is given by:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−∑𝜏𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]])\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\n∑\nτ\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n)\n(7)\n\n"
    },
    {
      "type": "markdown",
      "id": "002213d99d9ee4c9",
      "text": "This is an unsatisfying result, in which it fails to accommodate our prior knowledge that outcomes will become available in the future. In other words, the posterior at each time step is calculated under a different model (see Fig. 2).\n\nFig. 2\nfigure2\nTemporal progression of Markov decision process. The upper graphs shows the structure of the generative model implied using the variational free energy, equipped with a prior that the expected free energy will be minimised by policy selection. Observations are added to the model as they occur. The lower graphs show the structure of the generative model that explicitly represents future outcomes, and minimises a generalised free energy through policy selection. As observations are made, the outcome variables collapse to delta functions. These graphics are intended to highlight two alternative conceptions of a generative model employed in an online setting. The key problem here is how to deal with missing (future) outcomes. These could be omitted until such a time as they become available. Alternatively, they could be treated as hidden variables about which we can hold beliefs. Please note that this graphic illustrates different ways of formulating the generative model used to calculate belief updates. It does not show belief updates, behaviour or any other free energy minimising process. These will be detailed in subsequent sections and figures. However, the reason for making this distinction is important for how we formulate the free energy. The key distinction between the free energies compared in this paper is which of the two perspectives on future outcomes we choose to adopt\n\n"
    },
    {
      "type": "markdown",
      "id": "80e513b184b73f88",
      "text": "Full size image\n\n"
    },
    {
      "type": "markdown",
      "id": "0209de90b95947e9",
      "text": "Expected free energy\n\n"
    },
    {
      "type": "markdown",
      "id": "73f93561e9983ac9",
      "text": "To finesse this shortcoming, we can assume agents select the policy that they expect will lead to the lowest free energy (summed over time). This is motivated by the reductio ad absurdum in the introduction and is expressed mathematically as:\n\n𝑄𝑜(𝜋)≜𝜎(ln𝑃(𝜋)−𝐺𝜋)\nQ\no\n(\nπ\n)\n≜\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\nπ\n)\n(8)\nThis replaces the expression for 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n given in Sect. 2.3. (We retain the notation Qo(π) for the prior here to distinguish this from the fixed form prior P(π), which does not depend on the beliefs about states.) Gπ is the expected free energy, conditioned on a policy. It is defined as:\n\n𝐺𝜋=∑𝜏>𝑡𝐺𝜋𝜏𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏)−ln𝑄(𝑠𝜏|𝜋)]\nG\nπ\n=\n∑\nτ\n>\nt\nG\nπ\nτ\nG\nπ\nτ\n=−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n,\ns\nτ\n)−ln⁡Q(\ns\nτ\n|\nπ)] \n(9)\n\n"
    },
    {
      "type": "markdown",
      "id": "521f9c9716859ace",
      "text": "There is an apparent problem with this quantity: The first term within the expectation is a function of outcomes that have yet to be observed. To take this into account, we have defined an (approximate) joint distribution over states and outcomes: 𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)=𝑃(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nP\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, and take the expectation with respect to this. This means that we can express a (posterior predictive) belief about the observations in the future based on (posterior predictive) beliefs about hidden states. One can obtain a useful form of the expected free energy by rearranging the above: if we factorise the generative model, we obtain:\n\n𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑠𝜏|𝑜𝜏)−ln𝑄(𝑠𝜏|𝜋)Epistemicvalue+ln𝑃(𝑜𝜏)⏟Extrinsicvalue]\nG\nπ\nτ\n=\n−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\ns\nτ\n|\no\nτ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEpistemic\nvalue\n+\nln\n⁡\nP\n(\no\nτ\n)\n⏟\nExtrinsic\nvalue\n]\n(10)\n\n"
    },
    {
      "type": "markdown",
      "id": "bb14057a7a2a4013",
      "text": "This form shows that policies that have a low expected free energy are those that resolve uncertainty, and that fulfil prior preferences about outcomes. It is the first of these terms that endorses the [[metaphor of the brain as a scientist]], performing experiments (i.e. actions with sensory consequences) to verify or refute hypotheses about the world (Friston et al. 2012b; Gregory 1980). \n"
    },
    {
      "type": "markdown",
      "id": "8045d5039617fb28",
      "text": "The second term speaks to the notion of a ‘crooked scientist’ (Bruineberg et al. 2016), who designs experiments to confirm prior beliefs, i.e. preferred outcomes. This preference is the same as the evidence (a.k.a., marginal likelihood) associated with a given model. This means policies are selected such that the most probable outcomes under that policy match the most probable outcomes under prior preferences (defined in terms of a marginal likelihood).\n\nTreating 𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\nτ\n|\nπ\n)\n as a prior, and 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n as a posterior, we can directly substitute these into Bayes’ rule, which says that their ratio is equal to the ratio of the corresponding likelihood (𝑄(𝑜𝜏|𝑠𝜏,𝜋)≈𝑃(𝑜𝜏|𝑠𝜏)\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\n≈\nP\n(\no\nτ\n|\ns\nτ\n)\n) and marginal likelihood (𝑄(𝑜𝜏|𝜋)\nQ\n(\no\nτ\n|\nπ\n)\n):\n\n𝑃(𝑠𝜏|𝑜𝜏)𝑄(𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏,𝜋)𝑄(𝑜𝜏|𝜋)\nP\n(\ns\nτ\n|\no\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n(11)\nDue to the symmetry of Bayes’ rule, another perspective on this is that 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n is a likelihood that generates states from observations. This view treats the right-hand side of the above as the ratio between a posterior and a prior. Using this relationship, we can express expected free energy in terms of risk and ambiguity:\n\n𝐺𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[ln𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n\n"
    },
    {
      "type": "markdown",
      "id": "0e5836fa9286609f",
      "text": "Ambiguity\nIn this equation, H is the Shannon entropy (i.e. negative expected log probability). This means that the prior belief about outcomes enters the generative model through the KL divergence between outcomes expected under any policy and prior preferences. This form also illustrates the correspondence between the expected free energy and the quantities ‘risk’ and ‘ambiguity’ from behavioural economics (Ellsberg 1961; Ghirardato and Marinacci 2002). Risk quantifies the expected cost of a policy as a divergence from preferred outcomes and is sometimes referred to as Bayesian risk or regret (Huggins and Tenenbaum 2015), which underlies KL control and related Bayesian control rules (Kappen et al. 2012; Ortega and Braun 2010; Todorov 2008) and special cases that include Thompson sampling (Lloyd and Leslie 2013; Strens 2000). Ambiguous states are those that have an uncertain mapping to observations. The greater these quantities, the less likely it is that the associated policy will be chosen.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "0c0ab125fd97aa95",
      "text": "Having identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \n\n"
    },
    {
      "type": "markdown",
      "id": "5cdf6e90ea6dc2c9",
      "text": "Schwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain [[encode]]s the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\n\n"
    },
    {
      "type": "markdown",
      "id": "af8257d2339238b6",
      "text": "Schwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.10/srep16575\n\n"
    },
    {
      "type": "markdown",
      "id": "9c78057fc62df395",
      "text": "Article\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\n\n"
    },
    {
      "type": "markdown",
      "id": "5e974c66f595b242",
      "text": "Many of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\n"
    },
    {
      "type": "markdown",
      "id": "700202c447cc511c",
      "text": "This says that, to minimise a free energy functional with respect to a probability distribution, we need to find the point at which the partial derivative of the term inside the sum, with respect to this distribution, is zero.\n\nWe hope that this appendix is sufficient for readers not familiar with this style of mathematics to gain some intuition for the variational derivatives used throughout this paper. For interested readers, a more comprehensive introduction to this field can be found in (Moiseiwitsch 2013). For applications in the context of variational inference, please see (Beal 2003).\n\nRights and permissions\nOpen Access This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (http://creativecommons.org/licenses/by/4.0/), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made.\n\nReprints and Permissions\n\nAbout this article\nVerify currency and authenticity via CrossMark\nCite this article\nParr, T., Friston, K.J. Generalised free energy and active inference. Biol Cybern 113, 495–513 (2019). https://doi.org/10.1007/s00422-019-00805-w\n\nDownload citation\n\nReceived\n04 July 2017\n\nAccepted\n13 September 2019\n\nPublished\n27 September 2019\n\nIssue Date\nDecember 2019\n\nDOI\nhttps://doi.org/10.1007/s00422-019-00805-w\n\nShare this article\nAnyone you share the following link with will be able to read this content:\n\nGet shareable link\nProvided by the Springer Nature SharedIt content-sharing initiative\n\nKeywords\nBayesian\nActive inference\nFree energy\nData selection\nEpistemic value\nIntrinsic motivation\nDownload PDF"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "Generalised Free Energy and Active Inference",
        "story": []
      },
      "date": 1629442243515
    },
    {
      "item": {
        "type": "factory",
        "id": "7502fa94ebf7aad8"
      },
      "id": "7502fa94ebf7aad8",
      "type": "add",
      "date": 1629442245306
    },
    {
      "type": "edit",
      "id": "7502fa94ebf7aad8",
      "item": {
        "type": "markdown",
        "id": "7502fa94ebf7aad8",
        "text": "T. Parr and K. J. Friston, “Generalised free energy and active inference,” Biol Cybern, vol. 113, no. 5, pp. 495–513, Dec. 2019, doi: 10.1007/s00422-019-00805-w.\n"
      },
      "date": 1629442253993
    },
    {
      "item": {
        "type": "factory",
        "id": "e855e6952cd4b473"
      },
      "id": "e855e6952cd4b473",
      "type": "add",
      "after": "7502fa94ebf7aad8",
      "date": 1629442534645
    },
    {
      "type": "edit",
      "id": "e855e6952cd4b473",
      "item": {
        "type": "markdown",
        "id": "e855e6952cd4b473",
        "text": "> **Abstract**. Active inference is an approach to understanding behaviour that rests upon the idea that the brain uses an internal generative model to predict incoming sensory data. The fit between this model and data may be improved in two ways. The brain could optimise probabilistic beliefs about the variables in the generative model (i.e. perceptual inference). Alternatively, by acting on the world, it could change the sensory data, such that they are more consistent with the model. This implies a common objective function (variational free energy) for action and perception that scores the fit between an internal model and the world. We compare two free energy functionals for active inference in the framework of Markov decision processes. One of these is a functional of beliefs (i.e. probability distributions) about states and policies, but a function of observations, while the second is a functional of beliefs about all three. In the former (expected free energy), prior beliefs about outcomes are not part of the generative model (because they are absorbed into the prior over policies). Conversely, in the second (generalised free energy), priors over outcomes become an explicit component of the generative model. When using the free energy function, which is blind to future observations, we equip the generative model with a prior over policies that ensure preferred (i.e. priors over) outcomes are realised. In other words, if we expect to encounter a particular kind of outcome, this lends plausibility to those policies for which this outcome is a consequence. In addition, this formulation ensures that selected policies minimise uncertainty about future outcomes by minimising the free energy expected in the future. When using the free energy functional—that effectively treats future observations as hidden states—we show that policies are inferred or selected that realise prior preferences by minimising the free energy of future expectations. Interestingly, the form of posterior beliefs about policies (and associated belief updating) turns out to be identical under both formulations, but the quantities used to compute them are not.\n\nIntroduction\nOver the past years, we have tried to establish active inference (a corollary of the free energy principle) as a relatively straightforward and principled explanation for action, perception and cognition. Active inference can be summarised as self-evidencing (Hohwy 2016), in the sense that action and perception can be cast as maximising Bayesian model evidence, under generative models of the world. When this maximisation uses approximate Bayesian inference, this is equivalent to minimising variational free energy (Friston et al. 2006)—a form of bounded rational behaviour that minimises a variational bound on model evidence. Recently, we have migrated the basic idea from models that generate continuous sensations (like velocity and luminance contrast) (Brown and Friston 2012) to discrete state-space models, specifically Markov decision processes (Friston et al. 2017a). These models represent the world in terms of discrete states, like I am on this page and reading this word (Friston et al. 2017d). Discrete state-space models can be inferred using belief propagation (Yedidia et al. 2005) or variational message passing (Dauwels 2007; Winn 2004) schemes that have a degree of neuronal plausibility (Friston et al. 2017c). The resulting planning as inference scheme (Attias 2003; Baker et al. 2009; Botvinick and Toussaint 2012; Verma and Rao 2006) has a pleasingly broad explanatory scope, accounting for a range of phenomena in cognitive neuroscience, active vision and motor control (see Table 1). In this paper, we revisit the role of (expected) free energy in active inference and offer an alternative, simpler and more general formulation. This formulation does not substantially change the message passing or belief updating; however, it provides an interesting perspective on planning as inference and the way that we may perceive the future.\n\nTable 1 Applications of active inference for Markov decision processes\nFull size table\nIn current descriptions of active inference, the basic argument goes as follows: active inference is based upon the maximisation of model evidence or minimisation of variational free energy in two complementary ways. First, one can update one’s beliefs about latent or hidden states of the world to make them consistent with observed evidence—or one can actively sample the world to make observations consistent with beliefs about states of the world. The important thing here is that both action and perception are in game of minimising the same quantity, namely variational free energy. A key aspect of this formulation is that action (i.e. behaviour) is absorbed into inference, which means that agents have beliefs about what they are doing—and will do. This calls for prior beliefs about action or policies (i.e. sequences of actions). So where did these prior beliefs come from?\n\nThe answer obtains from a reductio ad absurdum argument: if action realises prior beliefs and minimises free energy, then the only tenable prior beliefs are that action will minimise free energy. If this were not the case, we reach the following absurd conclusion. If a free energy minimising creature did not have the prior belief that it selects policies that minimise (expected) free energy, it would infer (and therefore pursue) policies that were not free energy minimising. As such, it would not be a free energy minimising creature, which is a contradiction. This leads to the prior belief that I will select policies that minimise the free energy expected under that policy. The endpoint of this argument is that action or policy selection becomes a form of Bayesian model selection, where the evidence for a particular policy becomes the free energy expected in the future. This expected free energy is a slightly unusual objective function because it scores the evidence for plausible policies based on outcomes that have yet to be observed. This means that the expected free energy becomes the variational free energy expected under (posterior predictive) beliefs about outcomes. These priors are usually informed by prior beliefs about outcomes that play the role of prior preferences or utility functions in reinforcement learning and economics.\n\nIn summary, beliefs about states of the world and policies are continuously updated to minimise variational free energy, where posterior beliefs about policies (that prescribe action) are based upon expected free energy (that may or may not include prior preferences over future outcomes). This is the current story and leads to interesting issues that rest on the fact that expected free energy can be decomposed into epistemic and pragmatic parts (Friston et al. 2015). This decomposition provides a principled explanation for the epistemics of planning and inference that underwrite the exploitation and exploration dilemma, novelty, salience and so on. However, there is another way of telling this story that leads to a conceptually different sort of interpretation.\n\nIn what follows, we show that the same Bayesian policy (model) selection obtains from minimising variational free energy when future outcomes are treated as hidden or latent states of the world. In other words, we can regard active inference as minimising a generalised free energy under generative models that entertain the consequences of (policy-dependent) hidden states of the world in the future. This simple generalisation induces posterior beliefs over future outcomes that now play the role of latent or hidden states. In this setting, the future is treated in exactly the same way as the hidden or unobservable states of the world generating observations in the past. On this view, one gets the expected free energy for free, because the variational free energy involves an expectation under posterior beliefs over future outcomes. In turn, this means that beliefs about states and policies can be simply and uniformly treated as minimising the same (generalised) free energy, without having to invoke any free energy minimising priors over policies.\n\nTechnically, this leads to the same form of belief updating and (Bayesian) policy selection but provides a different perspective on the free energy principle per se. This perspective says that self-evidencing and active inference both have one underlying imperative, namely to minimise generalised free energy or uncertainty. When this uncertainty is evaluated under models that generate outcomes in the future, future outcomes become hidden states that are only revealed by the passage of time. In this context, outcomes in the past become observations in standard variational inference, while outcomes in the future become posterior beliefs about latent observations that have yet to disclose themselves. In this way, the generalised free energy can be seen as comprising variational free energy contributions from the past and future.\n\nThe current paper provides the formal basis for the above arguments. In brief, we will see that both the expected and generalised free energy formulations lead to the same update equations. However, there is a subtle difference. In the expected free energy formalism, prior preferences or beliefs about outcomes are used to specify the prior over policies. In the generalised formulation, prior beliefs about outcomes in the future inform posterior beliefs about the hidden states that cause them. Because of the implicit forward and backward message passing in the belief propagation scheme obtained at the free energy minimum (Yedidia et al. 2005), these prior beliefs or preferences act to distort expected trajectories (into the future) towards preferences in an optimistic way (Sharot et al. 2012). Intuitively, the expected free energy contribution to generalised free energy evaluates the (complexity) cost of this distortion, thereby favouring policies that lead naturally to preferred outcomes—without violating beliefs about state transitions and the (likelihood) mapping between states and outcomes. The implicit coupling between beliefs about the future and current actions means that, in one sense, the future can cause the past.\n\nFraming probabilistic reasoning in terms of inferential message passing formalises several prominent concepts in the study of human decision making. The idea that prior beliefs distort beliefs about future and that this optimism about the future propagates backwards in time to influence behaviour in an adaptive way (McKay and Dennett 2010; Sharot 2011), is highly consistent with an influence of beliefs about the future over beliefs about the present. Simplistically, the idea behind these accounts is that adaptive behaviour relies upon the (possibly false) belief that future events will accord with our preferences. It is only by believing that we will realise these goals that we act in a manner consistent with their realisation. Intuitively, without the belief that we will end up eating dinner, there would be no reason to shop for ingredients. The passing of messages from past to future resonates with the notion that working memory is vital for predicting the future and planning actions accordingly (Gilhooly 2005; Hikosaka et al. 2000), and underwrites research on episodic future thinking and counterfactual reasoning (Schacter et al. 2015). Appealing to bidirectional inferential message passing has enabled us to reproduce a range of behavioural and electrophysiological phenomena through simulation (summarised in Table 1).\n\nThis paper comprises three sections. In the first, we outline the approach we have used to date (i.e. minimising the variational free energy under prior beliefs that policies with a low expected free energy are more probable). In the second, we introduce a generalisation of the variational free energy that incorporates beliefs about future outcomes. The third section compares these two approaches conceptually and through illustrative simulations.\n\nActive inference and variational free energy\nThe free energy principle is motivated by the defining characteristic of living creatures, namely that they persist in the face of a changing world. In other words, their states occupy a small proportion of all possible states with a high probability. From the perspective of statistical physics, this means that they show a form of self-organised, non-equilibrium steady-state that maintains a low entropy probability distribution over their states. In information theory, self-information or surprise (a.k.a. negative log model evidence) averaged over time is entropy. More generally, entropy is defined in terms of an ensemble average. However, under that assumption that a system has achieved its (non-equilibrium) steady state, the ensemble and time average are equivalent (under mild weakly mixing assumptions). This means, at any given time, all biological systems are compelled to minimise their surprise. While this may seem like a very bold statement, we do not intend to trivialise the many constraints that dictate behaviour. The point here is that when all these constraints are written into a generative model as prior beliefs, they all contribute to the same cost function: surprise. This reframes the problem of expressing the constraints biological systems must satisfy as a problem of specifying the right set of priors. Although the computation of surprise is often intractable, an approximation is simple to calculate. This is variational free energy (Beal 2003; Dayan et al. 1995; Friston 2003) which depends upon specifying a generative model of how data are caused. This generative model comprises a series of conditional probability distributions. For a Markov decision process, it assumes a series of states (s) that evolve through time. At each time step, the probability of transitioning from one state to the next depends upon a policy (π). Neither states nor policies are directly accessible to the creature in question. However, each state probabilistically generates an observable outcome (o). As Jensen’s inequality demonstrates, free energy is an upper bound on surprise.\n\n𝐹⏟Freeenergy=−𝐸𝑄(𝑠̃,𝜋)[ln𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]≥−ln𝐸𝑄(𝑠̃,𝜋)[𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]Jensen′sinequality=−ln𝑃(𝑜̃)Surprise\nF\n⏟\nFree\nenergy\n=\n−\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nln\n⁡\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n≥\n−\nln\n⁡\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n⏟\nJensen\n′\ns\ninequality\n=\n−\nln\n⁡\nP\n(\no\n~\n)\n⏟\nSurprise\nIn the equation above,  indicates a probability distribution over outcomes 𝑜̃=(𝑜1,𝑜2,…,𝑜𝑇)\no\n~\n=\n(\no\n1\n,\no\n2\n,\n…\n,\no\nT\n)\n that are generated by hidden states of the world 𝑠̃=(𝑠1,𝑠2,…,𝑠𝑇)\ns\n~\n=\n(\ns\n1\n,\ns\n2\n,\n…\n,\ns\nT\n)\n and policies, which define the generative model. The generative model is thus expressed as a joint probability distribution over outcomes (i.e. consequences) and their causes (i.e. hidden states of the world and policies available to the agent). Marginalising (i.e. summing or integrating) over the states and policies gives the evidence (a.k.a., marginal likelihood). The log of this marginal likelihood is negative surprise.  is a probability distribution over unobservable (hidden) states and policies—that becomes an approximate posterior distribution as free energy is minimised. The minimisation of free energy over time ensures entropy does not increase, thereby enabling biological systems to resist the second law of thermodynamics and their implicit dissipation or decay.\n\nNote that the generative model is not a model of the biological system itself, but an implicit model of how the environment generates its sensory data. The dynamics of inference and behaviour that we are interested in here emerge from minimising free energy under an appropriate choice of generative model. For readers with a physics background, and analogy would be that the free energy plays the role of a Lagrangian whose ‘potential energy’ component is given by the generative model. Just as a Lagrangian is used to recover the equations of motion for a physical system, we use the free energy to recover the belief updates that determine a biological system’s behaviour.\n\nIn the following, we begin by describing the form of the generative model we have used to date. We will then address the form of the approximate posterior distribution. To make inference tractable, this generally involves a mean-field approximation that factorises the approximate posterior distribution into independent factors or marginal distributions.\n\nThe generative models used in this paper are subtly different for each free energy functional, but the variables themselves are the same. These are policies (𝜋\nπ\n) and state trajectories (𝑠̃\ns\n~\n), all of which are latent (unknown random) variables that have to be inferred. States evolve as a discrete Markov chain, where the transition probabilities are functions of the policy. Likelihood distributions probabilistically map hidden states to observations (𝑜̃\no\n~\n). Figure  (left) shows these dependencies as a graphical Bayesian network. This type of generative model has been used extensively in simulations of active inference (FitzGerald et al. , ; Friston et al. , , , ; Schwartenbeck et al. ), see Table .\n\nFig. 1\nfigure1\nMarkov decision process. This shows the basic structure of the discrete state-space generative model used in this paper, assuming the current time is t = τ. The factor graph on the left is the generative model we have used in previous work. Importantly, the prior belief about observations only enters this graph through the expected free energy, 𝐺\nG\n (see main text), which enters the prior over policies. Policies index alternative trajectories, or sequences, of actions. In this sense, they are not time dependent, as each policy determines a sequence of actions for all time-points. Conversely, the actions (u) are time dependent. U is an array that specifies an action for each time step (rows) and each policy (columns). The selected action therefore depends upon the most likely policy and the action that policy implies for that time step. Action selection is technically not part of the generative model, as it relies upon the posterior distribution Q (please see main text for details), obtained by inverting the model. This is an important, aspect of active inference, as it underwrites the way in which the system performing inference may change the process generating its observed data. The grey region of this graph indicates that the observation at the next time step is not yet available, so cannot yet be incorporated into the graph. The right factor graph is the new version of the generative model considered in this paper. This generative model does not require an expected free energy, and the prior over outcomes enters the model directly as a constraint on outcomes. This also shows a time dependence, as future outcomes are treated as unobserved latent variables (indicated by an unfilled circle). Observed variables are shown as filled circles in both graphs and unobserved variables as unfilled circles. Factors of the generative model (i.e. conditional probability distributions and prior probabilities) are shown as squares. These squares are connected to those circles containing variables that participate in the same factor. Please refer to the main text and Table 2 for a description of the variables. In the panel on the right, the definitions are given for each of the factors in blue squares. Here, Cat refers to the categorical distribution (color figure online)\nFull size image\nThe role of the generative model is simply to define the free energy functional which, as we will see in Sects. –, gives rise to the belief update rules that we will employ for our simulations. However, it is helpful to imagine how we might generate data from such a model. We outline this process with the model on the left of Fig.  in mind. We could start at the first time step and sample a state from the categorical prior over initial states. The parameters of this prior () are simply a vector of probabilities for each alternative state. From this, we can now sample from the likelihood. This is formulated as a matrix (), whose columns correspond to a state and whose rows are the alternative outcomes that may be generated. To generate an outcome, we would select the column of this matrix corresponding to the state we sampled and sample an outcome from this column-vector of probabilities. It is this outcome that would be available to a synthetic creature.\n\nTaking a discrete time step into the future, we can sample a new state from the column of a transition matrix () associated with the state at the previous time. Crucially, the transition probabilities are conditioned upon the selected action. This means we have a separate -matrix for each action. Action selection depends upon the policy, with each policy and time point associated with an action. For the model on the left of Fig. , this means we calculate the expected free energy () for each policy, which depends upon a vector of prior probabilities for outcomes under these policies (). Combining these with a prior bias term ()—as set out in more detail in Sect. —we can construct a prior over policies. Sampling from this and selecting the action that corresponds to this policy, at this time, specify the -matrix from which to sample the state for the current time step. We could then sample the outcome for this time from the relevant column of the -matrix. This process can be repeated for a series of discrete time steps, generating a new outcome for each time. A similar approach could be taken to generate data from the model on the right of Fig. . However, note that the likelihood here comprises both  and , and the policy prior only includes  (i.e. the expected free energy does not explicitly feature in this model). The procedure outlined above provides an intuition into the beliefs a creature has about how its sensory data are generated by acting on hidden states in the environment.\n\nIt is worth noting that the free energy is a  of the distributions in the generative model and of the approximate posterior beliefs, but a  of observations. Continuing with this free energy, we now consider the mean-field approximation in current implementations of active inference, and its consequences for the variational free energy. In the next few sections, we unpack the variational free energy, and its role in active inference based on Markov decision processes. The argument that follows is a little involved, but we summarise the key steps here, such that the agenda of each of the following sections is clear. In Sect. , we specify the form of the variational distribution we employ, and the free energy that results from this. In Sect. , we unpack the terms in the free energy as they pertain to the generative model. This depends upon having a prior belief about policies. Section  attempts to identify this prior, through finding the optimal posterior and extrapolating backwards in time. This highlights a shortcoming of this approach that is resolved in Sect. . In addition to providing a more appropriate prior for policy selection, Sect.  sets out the role of free energy in simulating behaviour. In brief, this involves finding the variational distribution over policies that minimises free energy. As free energy is a function of sensory observations, this means we need to update these distributions following each new observation. Section  follows the same approach to find the free energy minima for beliefs about states, giving the fixed points to which these distributions must be updated following each new observation.\n\nDefinition of the mean-field variational free energy\nTo define the variational free energy for the above generative model, we first need to specify the form of the approximate posterior distribution, 𝑄\nQ\n. We do this via a mean-field approximation that treats the (policy dependent) state at each time step as approximately independent of the state at any other time step. We treat the distribution over the policy as a separate factor, which implies a set of (policy) models, 𝜋\nπ\n, over hidden variables 𝑠𝜏\ns\nτ\n:\n\n𝑄(𝑠̃,𝜋)=𝑄(𝜋)∏𝜏𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\n~\n,\nπ\n)\n=\nQ\n(\nπ\n)\n∏\nτ\nQ\n(\ns\nτ\n|\nπ\n)\nMean-field approximations originated in statistical physics, where they can be used to approximate Helmholtz free energy through appealing to an average with respect to a ‘reference’ Hamiltonian. This reference can be simply defined for a system with non-interacting components (or degrees of freedom). In virtue of the assumption that the system’s degrees of freedom do not interact, their Hamiltonian (scaled negative log probability) may be expressed as a sum of contributions from each component. Exponentiating this sum, the probability density can be expressed as a product of marginal probabilities for each degree of freedom. The same idea has been employed extensively in statistical inference and machine learning, where a mean-field approximation refers to the use of a variational distribution comprising a product of marginals (Winn and Bishop ; Yedidia et al. ). The ‘mean field’ is the expected value of each (log) factor of the generative model (), which include the interactions, under the fully factorised distribution (). The advantage to using a mean-field approximation is the computational tractability that comes from being able to separately optimise each marginal distribution. We can now substitute this factorised distribution into our definition for the variational free energy above:\n\n𝐹=𝐸𝑄(𝜋)[𝐹𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝐹𝜋=−𝐸𝑄(𝑠̃|𝜋)[ln𝑃(𝑜̃,𝑠̃|𝜋)−∑𝜏ln𝑄(𝑠𝜏|𝜋)]\nF=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=−\nE\nQ\n(\ns\n~\n|\nπ\n)\n[ln⁡P(\no\n~\n,\ns\n~\n|\nπ)−\n∑\nτ\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n] \nIn this form, the variational free energy is expressed in terms of policy-dependent terms (second equality) that bound the (negative log) evidence for each policy and a complexity cost or KL divergenceFootnote 1 () that scores the departure of the posterior beliefs over policies from the corresponding prior beliefs.\n\nPast and future\nThere is an important difference in how past and future outcomes are treated by the variational free energy. Note that—as a function of outcomes—the components of the free energy that depend on outcomes can only be evaluated for the past and present. Hidden states, on the other hand, enter the expression as  about states. In other words, the free energy is a functional of distributions over states, rather than a function, as in the case of outcomes. This means that free energy evaluation takes account of future states. We can express this explicitly by writing the variational free energy, at time , as a sum over all time steps, factorising the generative distribution according to the conditional independencies expressed in Fig. :\n\n𝐹𝜋=∑𝜏𝐹𝜋𝜏𝐹𝜋𝜏=−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[[𝜏≤𝑡]⋅ln𝑃(𝑜𝜏|𝑠𝜏)+ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)−ln𝑄(𝑠𝜏|𝜋)]\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\n[\nτ\n≤\nt\n]\n⋅\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n+\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n]\n \nIn the above, the Iverson (square) brackets return 1 if the expression is true, and 0 otherwise. It is this condition that differentiates contributions from the past from the future. This equation is obtained in a straightforward way by factorising the generative model (joint distribution) in the second line of Eq. , in line with the generative model depicted in Fig. . Because the generative model does not include future observations as random variables (given that these data have yet to be collected), there are no accompanying likelihood factors. This reflects the fact that the only data that contribute to the free energy are those we currently have access to. Given the dependence of the right-hand side on the current time () the free energy should, strictly speaking, be written as a function of  and . As we are interested here in online inference, we will assume an implicit conditioning upon  for all free energies throughout this paper. The Iverson brackets above allow us to decompose the sum into past and future components:\n\n𝐹𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷KL[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nKL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n(5)\nIn this decomposition, the contribution of beliefs about future states reduces to a complexity cost. This is the KL divergence between approximate posterior beliefs about states in the future and prior beliefs. The latter are based upon the (policy-specific) transition probabilities in the generative model.\n\nPolicy posteriors and priors\nUsing the full variational free energy (over all policies) from Eq. 3, we can evaluate posterior beliefs about policies. The variational derivative of the free energy with respect to these beliefs is (where we omit constants, and where 𝜎(⋅)\nσ\n(\n⋅\n)\n is a softmax function—i.e. a normalised exponential function):\n\n𝛿𝐹𝛿𝑄(𝜋)=𝐹𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(6)\nThe second line derives from the first through rearranging, exponentiating both sides of the equation, and normalising to ensure the approximate posterior sums to one. This, together with Eq. 5, implies the belief prior to any observations (i.e. at 𝑡=0\nt\n=\n0\n), which is given by:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−∑𝜏𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]])\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\n∑\nτ\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n)\n(7)\nThis is an unsatisfying result, in which it fails to accommodate our prior knowledge that outcomes will become available in the future. In other words, the posterior at each time step is calculated under a different model (see Fig. 2).\n\nFig. 2\nfigure2\nTemporal progression of Markov decision process. The upper graphs shows the structure of the generative model implied using the variational free energy, equipped with a prior that the expected free energy will be minimised by policy selection. Observations are added to the model as they occur. The lower graphs show the structure of the generative model that explicitly represents future outcomes, and minimises a generalised free energy through policy selection. As observations are made, the outcome variables collapse to delta functions. These graphics are intended to highlight two alternative conceptions of a generative model employed in an online setting. The key problem here is how to deal with missing (future) outcomes. These could be omitted until such a time as they become available. Alternatively, they could be treated as hidden variables about which we can hold beliefs. Please note that this graphic illustrates different ways of formulating the generative model used to calculate belief updates. It does not show belief updates, behaviour or any other free energy minimising process. These will be detailed in subsequent sections and figures. However, the reason for making this distinction is important for how we formulate the free energy. The key distinction between the free energies compared in this paper is which of the two perspectives on future outcomes we choose to adopt\nFull size image\nExpected free energy\nTo finesse this shortcoming, we can assume agents select the policy that they expect will lead to the lowest free energy (summed over time). This is motivated by the reductio ad absurdum in the introduction and is expressed mathematically as:\n\n𝑄𝑜(𝜋)≜𝜎(ln𝑃(𝜋)−𝐺𝜋)\nQ\no\n(\nπ\n)\n≜\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\nπ\n)\n(8)\nThis replaces the expression for 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n given in Sect. 2.3. (We retain the notation Qo(π) for the prior here to distinguish this from the fixed form prior P(π), which does not depend on the beliefs about states.) Gπ is the expected free energy, conditioned on a policy. It is defined as:\n\n𝐺𝜋=∑𝜏>𝑡𝐺𝜋𝜏𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏)−ln𝑄(𝑠𝜏|𝜋)]\nG\nπ\n=\n∑\nτ\n>\nt\nG\nπ\nτ\nG\nπ\nτ\n=−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n,\ns\nτ\n)−ln⁡Q(\ns\nτ\n|\nπ)] \n(9)\nThere is an apparent problem with this quantity: The first term within the expectation is a function of outcomes that have yet to be observed. To take this into account, we have defined an (approximate) joint distribution over states and outcomes: 𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)=𝑃(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nP\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, and take the expectation with respect to this. This means that we can express a (posterior predictive) belief about the observations in the future based on (posterior predictive) beliefs about hidden states. One can obtain a useful form of the expected free energy by rearranging the above: if we factorise the generative model, we obtain:\n\n𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑠𝜏|𝑜𝜏)−ln𝑄(𝑠𝜏|𝜋)Epistemicvalue+ln𝑃(𝑜𝜏)⏟Extrinsicvalue]\nG\nπ\nτ\n=\n−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\ns\nτ\n|\no\nτ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEpistemic\nvalue\n+\nln\n⁡\nP\n(\no\nτ\n)\n⏟\nExtrinsic\nvalue\n]\n(10)\nThis form shows that policies that have a low expected free energy are those that resolve uncertainty, and that fulfil prior preferences about outcomes. It is the first of these terms that endorses the metaphor of the brain as a scientist, performing experiments (i.e. actions with sensory consequences) to verify or refute hypotheses about the world (Friston et al. 2012b; Gregory 1980). The second term speaks to the notion of a ‘crooked scientist’ (Bruineberg et al. 2016), who designs experiments to confirm prior beliefs, i.e. preferred outcomes. This preference is the same as the evidence (a.k.a., marginal likelihood) associated with a given model. This means policies are selected such that the most probable outcomes under that policy match the most probable outcomes under prior preferences (defined in terms of a marginal likelihood).\n\nTreating 𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\nτ\n|\nπ\n)\n as a prior, and 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n as a posterior, we can directly substitute these into Bayes’ rule, which says that their ratio is equal to the ratio of the corresponding likelihood (𝑄(𝑜𝜏|𝑠𝜏,𝜋)≈𝑃(𝑜𝜏|𝑠𝜏)\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\n≈\nP\n(\no\nτ\n|\ns\nτ\n)\n) and marginal likelihood (𝑄(𝑜𝜏|𝜋)\nQ\n(\no\nτ\n|\nπ\n)\n):\n\n𝑃(𝑠𝜏|𝑜𝜏)𝑄(𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏,𝜋)𝑄(𝑜𝜏|𝜋)\nP\n(\ns\nτ\n|\no\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n(11)\nDue to the symmetry of Bayes’ rule, another perspective on this is that 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n is a likelihood that generates states from observations. This view treats the right-hand side of the above as the ratio between a posterior and a prior. Using this relationship, we can express expected free energy in terms of risk and ambiguity:\n\n𝐺𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[ln𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\nIn this equation, H is the Shannon entropy (i.e. negative expected log probability). This means that the prior belief about outcomes enters the generative model through the KL divergence between outcomes expected under any policy and prior preferences. This form also illustrates the correspondence between the expected free energy and the quantities ‘risk’ and ‘ambiguity’ from behavioural economics (Ellsberg 1961; Ghirardato and Marinacci 2002). Risk quantifies the expected cost of a policy as a divergence from preferred outcomes and is sometimes referred to as Bayesian risk or regret (Huggins and Tenenbaum 2015), which underlies KL control and related Bayesian control rules (Kappen et al. 2012; Ortega and Braun 2010; Todorov 2008) and special cases that include Thompson sampling (Lloyd and Leslie 2013; Strens 2000). Ambiguous states are those that have an uncertain mapping to observations. The greater these quantities, the less likely it is that the associated policy will be chosen.\n\nHaving identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\nMany of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\nL\n(Q(\ns\n~\n|\nπ),\ns\n~\n)=Q(\ns\n~\n|\nπ)(ln⁡Q(\ns\n~\n|\nπ)−ln⁡P(\no\n~\n,\ns\n~\n|\nπ))\t\tS=\nF\nπ\n=\n∑\ns\n~\nL\n(\nQ\n(\ns\n~\n|\nπ\n)\n,\ns\n~\n)\nP(\ns\n~\n|\nπ,\no\n~\n)≈\narg\n⁡\nmin\nQ\n(\ns\n~\n|\nπ\n)\n⁡\nF\nπ\n \nThis says that, to minimise a free energy functional with respect to a probability distribution, we need to find the point at which the partial derivative of the term inside the sum, with respect to this distribution, is zero.\n\nWe hope that this appendix is sufficient for readers not familiar with this style of mathematics to gain some intuition for the variational derivatives used throughout this paper. For interested readers, a more comprehensive introduction to this field can be found in (Moiseiwitsch 2013). For applications in the context of variational inference, please see (Beal 2003).\n\nRights and permissions\nOpen Access This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (http://creativecommons.org/licenses/by/4.0/), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made.\n\nReprints and Permissions\n\nAbout this article\nVerify currency and authenticity via CrossMark\nCite this article\nParr, T., Friston, K.J. Generalised free energy and active inference. Biol Cybern 113, 495–513 (2019). https://doi.org/10.1007/s00422-019-00805-w\n\nDownload citation\n\nReceived\n04 July 2017\n\nAccepted\n13 September 2019\n\nPublished\n27 September 2019\n\nIssue Date\nDecember 2019\n\nDOI\nhttps://doi.org/10.1007/s00422-019-00805-w\n\nShare this article\nAnyone you share the following link with will be able to read this content:\n\nGet shareable link\nProvided by the Springer Nature SharedIt content-sharing initiative\n\nKeywords\nBayesian\nActive inference\nFree energy\nData selection\nEpistemic value\nIntrinsic motivation\nDownload PDF"
      },
      "date": 1629442545917
    },
    {
      "type": "edit",
      "id": "e855e6952cd4b473",
      "item": {
        "type": "markdown",
        "id": "e855e6952cd4b473",
        "text": "> **Abstract**. Active inference is an approach to understanding behaviour that rests upon the idea that the brain uses an internal generative model to predict incoming sensory data. The fit between this model and data may be improved in two ways. The brain could optimise probabilistic beliefs about the variables in the generative model (i.e. perceptual inference). Alternatively, by acting on the world, it could change the sensory data, such that they are more consistent with the model. This implies a common objective function (variational free energy) for action and perception that scores the fit between an internal model and the world. We compare two free energy functionals for active inference in the framework of Markov decision processes. One of these is a functional of beliefs (i.e. probability distributions) about states and policies, but a function of observations, while the second is a functional of beliefs about all three. In the former (expected free energy), prior beliefs about outcomes are not part of the generative model (because they are absorbed into the prior over policies). Conversely, in the second (generalised free energy), priors over outcomes become an explicit component of the generative model. When using the free energy function, which is blind to future observations, we equip the generative model with a prior over policies that ensure preferred (i.e. priors over) outcomes are realised. In other words, if we expect to encounter a particular kind of outcome, this lends plausibility to those policies for which this outcome is a consequence. In addition, this formulation ensures that selected policies minimise uncertainty about future outcomes by minimising the free energy expected in the future. When using the free energy functional—that effectively treats future observations as hidden states—we show that policies are inferred or selected that realise prior preferences by minimising the free energy of future expectations. Interestingly, the form of posterior beliefs about policies (and associated belief updating) turns out to be identical under both formulations, but the quantities used to compute them are not.\n"
      },
      "date": 1629442626295
    },
    {
      "type": "add",
      "id": "96ce7acc443d8478",
      "item": {
        "type": "markdown",
        "id": "96ce7acc443d8478",
        "text": "\n# Introduction\nOver the past years, we have tried to establish active inference (a corollary of the free energy principle) as a relatively straightforward and principled explanation for action, perception and cognition. Active inference can be summarised as self-evidencing (Hohwy 2016), in the sense that action and perception can be cast as maximising Bayesian model evidence, under generative models of the world. When this maximisation uses approximate Bayesian inference, this is equivalent to minimising variational free energy (Friston et al. 2006)—a form of bounded rational behaviour that minimises a variational bound on model evidence. Recently, we have migrated the basic idea from models that generate continuous sensations (like velocity and luminance contrast) (Brown and Friston 2012) to discrete state-space models, specifically Markov decision processes (Friston et al. 2017a). These models represent the world in terms of discrete states, like I am on this page and reading this word (Friston et al. 2017d). Discrete state-space models can be inferred using belief propagation (Yedidia et al. 2005) or variational message passing (Dauwels 2007; Winn 2004) schemes that have a degree of neuronal plausibility (Friston et al. 2017c). The resulting planning as inference scheme (Attias 2003; Baker et al. 2009; Botvinick and Toussaint 2012; Verma and Rao 2006) has a pleasingly broad explanatory scope, accounting for a range of phenomena in cognitive neuroscience, active vision and motor control (see Table 1). In this paper, we revisit the role of (expected) free energy in active inference and offer an alternative, simpler and more general formulation. This formulation does not substantially change the message passing or belief updating; however, it provides an interesting perspective on planning as inference and the way that we may perceive the future.\n\nTable 1 Applications of active inference for Markov decision processes\nFull size table\nIn current descriptions of active inference, the basic argument goes as follows: active inference is based upon the maximisation of model evidence or minimisation of variational free energy in two complementary ways. First, one can update one’s beliefs about latent or hidden states of the world to make them consistent with observed evidence—or one can actively sample the world to make observations consistent with beliefs about states of the world. The important thing here is that both action and perception are in game of minimising the same quantity, namely variational free energy. A key aspect of this formulation is that action (i.e. behaviour) is absorbed into inference, which means that agents have beliefs about what they are doing—and will do. This calls for prior beliefs about action or policies (i.e. sequences of actions). So where did these prior beliefs come from?\n\nThe answer obtains from a reductio ad absurdum argument: if action realises prior beliefs and minimises free energy, then the only tenable prior beliefs are that action will minimise free energy. If this were not the case, we reach the following absurd conclusion. If a free energy minimising creature did not have the prior belief that it selects policies that minimise (expected) free energy, it would infer (and therefore pursue) policies that were not free energy minimising. As such, it would not be a free energy minimising creature, which is a contradiction. This leads to the prior belief that I will select policies that minimise the free energy expected under that policy. The endpoint of this argument is that action or policy selection becomes a form of Bayesian model selection, where the evidence for a particular policy becomes the free energy expected in the future. This expected free energy is a slightly unusual objective function because it scores the evidence for plausible policies based on outcomes that have yet to be observed. This means that the expected free energy becomes the variational free energy expected under (posterior predictive) beliefs about outcomes. These priors are usually informed by prior beliefs about outcomes that play the role of prior preferences or utility functions in reinforcement learning and economics.\n\nIn summary, beliefs about states of the world and policies are continuously updated to minimise variational free energy, where posterior beliefs about policies (that prescribe action) are based upon expected free energy (that may or may not include prior preferences over future outcomes). This is the current story and leads to interesting issues that rest on the fact that expected free energy can be decomposed into epistemic and pragmatic parts (Friston et al. 2015). This decomposition provides a principled explanation for the epistemics of planning and inference that underwrite the exploitation and exploration dilemma, novelty, salience and so on. However, there is another way of telling this story that leads to a conceptually different sort of interpretation.\n\nIn what follows, we show that the same Bayesian policy (model) selection obtains from minimising variational free energy when future outcomes are treated as hidden or latent states of the world. In other words, we can regard active inference as minimising a generalised free energy under generative models that entertain the consequences of (policy-dependent) hidden states of the world in the future. This simple generalisation induces posterior beliefs over future outcomes that now play the role of latent or hidden states. In this setting, the future is treated in exactly the same way as the hidden or unobservable states of the world generating observations in the past. On this view, one gets the expected free energy for free, because the variational free energy involves an expectation under posterior beliefs over future outcomes. In turn, this means that beliefs about states and policies can be simply and uniformly treated as minimising the same (generalised) free energy, without having to invoke any free energy minimising priors over policies.\n\nTechnically, this leads to the same form of belief updating and (Bayesian) policy selection but provides a different perspective on the free energy principle per se. This perspective says that self-evidencing and active inference both have one underlying imperative, namely to minimise generalised free energy or uncertainty. When this uncertainty is evaluated under models that generate outcomes in the future, future outcomes become hidden states that are only revealed by the passage of time. In this context, outcomes in the past become observations in standard variational inference, while outcomes in the future become posterior beliefs about latent observations that have yet to disclose themselves. In this way, the generalised free energy can be seen as comprising variational free energy contributions from the past and future.\n\nThe current paper provides the formal basis for the above arguments. In brief, we will see that both the expected and generalised free energy formulations lead to the same update equations. However, there is a subtle difference. In the expected free energy formalism, prior preferences or beliefs about outcomes are used to specify the prior over policies. In the generalised formulation, prior beliefs about outcomes in the future inform posterior beliefs about the hidden states that cause them. Because of the implicit forward and backward message passing in the belief propagation scheme obtained at the free energy minimum (Yedidia et al. 2005), these prior beliefs or preferences act to distort expected trajectories (into the future) towards preferences in an optimistic way (Sharot et al. 2012). Intuitively, the expected free energy contribution to generalised free energy evaluates the (complexity) cost of this distortion, thereby favouring policies that lead naturally to preferred outcomes—without violating beliefs about state transitions and the (likelihood) mapping between states and outcomes. The implicit coupling between beliefs about the future and current actions means that, in one sense, the future can cause the past.\n\nFraming probabilistic reasoning in terms of inferential message passing formalises several prominent concepts in the study of human decision making. The idea that prior beliefs distort beliefs about future and that this optimism about the future propagates backwards in time to influence behaviour in an adaptive way (McKay and Dennett 2010; Sharot 2011), is highly consistent with an influence of beliefs about the future over beliefs about the present. Simplistically, the idea behind these accounts is that adaptive behaviour relies upon the (possibly false) belief that future events will accord with our preferences. It is only by believing that we will realise these goals that we act in a manner consistent with their realisation. Intuitively, without the belief that we will end up eating dinner, there would be no reason to shop for ingredients. The passing of messages from past to future resonates with the notion that working memory is vital for predicting the future and planning actions accordingly (Gilhooly 2005; Hikosaka et al. 2000), and underwrites research on episodic future thinking and counterfactual reasoning (Schacter et al. 2015). Appealing to bidirectional inferential message passing has enabled us to reproduce a range of behavioural and electrophysiological phenomena through simulation (summarised in Table 1).\n\nThis paper comprises three sections. In the first, we outline the approach we have used to date (i.e. minimising the variational free energy under prior beliefs that policies with a low expected free energy are more probable). In the second, we introduce a generalisation of the variational free energy that incorporates beliefs about future outcomes. The third section compares these two approaches conceptually and through illustrative simulations.\n\nActive inference and variational free energy\nThe free energy principle is motivated by the defining characteristic of living creatures, namely that they persist in the face of a changing world. In other words, their states occupy a small proportion of all possible states with a high probability. From the perspective of statistical physics, this means that they show a form of self-organised, non-equilibrium steady-state that maintains a low entropy probability distribution over their states. In information theory, self-information or surprise (a.k.a. negative log model evidence) averaged over time is entropy. More generally, entropy is defined in terms of an ensemble average. However, under that assumption that a system has achieved its (non-equilibrium) steady state, the ensemble and time average are equivalent (under mild weakly mixing assumptions). This means, at any given time, all biological systems are compelled to minimise their surprise. While this may seem like a very bold statement, we do not intend to trivialise the many constraints that dictate behaviour. The point here is that when all these constraints are written into a generative model as prior beliefs, they all contribute to the same cost function: surprise. This reframes the problem of expressing the constraints biological systems must satisfy as a problem of specifying the right set of priors. Although the computation of surprise is often intractable, an approximation is simple to calculate. This is variational free energy (Beal 2003; Dayan et al. 1995; Friston 2003) which depends upon specifying a generative model of how data are caused. This generative model comprises a series of conditional probability distributions. For a Markov decision process, it assumes a series of states (s) that evolve through time. At each time step, the probability of transitioning from one state to the next depends upon a policy (π). Neither states nor policies are directly accessible to the creature in question. However, each state probabilistically generates an observable outcome (o). As Jensen’s inequality demonstrates, free energy is an upper bound on surprise.\n\n𝐹⏟Freeenergy=−𝐸𝑄(𝑠̃,𝜋)[ln𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]≥−ln𝐸𝑄(𝑠̃,𝜋)[𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]Jensen′sinequality=−ln𝑃(𝑜̃)Surprise\nF\n⏟\nFree\nenergy\n=\n−\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nln\n⁡\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n≥\n−\nln\n⁡\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n⏟\nJensen\n′\ns\ninequality\n=\n−\nln\n⁡\nP\n(\no\n~\n)\n⏟\nSurprise\nIn the equation above,  indicates a probability distribution over outcomes 𝑜̃=(𝑜1,𝑜2,…,𝑜𝑇)\no\n~\n=\n(\no\n1\n,\no\n2\n,\n…\n,\no\nT\n)\n that are generated by hidden states of the world 𝑠̃=(𝑠1,𝑠2,…,𝑠𝑇)\ns\n~\n=\n(\ns\n1\n,\ns\n2\n,\n…\n,\ns\nT\n)\n and policies, which define the generative model. The generative model is thus expressed as a joint probability distribution over outcomes (i.e. consequences) and their causes (i.e. hidden states of the world and policies available to the agent). Marginalising (i.e. summing or integrating) over the states and policies gives the evidence (a.k.a., marginal likelihood). The log of this marginal likelihood is negative surprise.  is a probability distribution over unobservable (hidden) states and policies—that becomes an approximate posterior distribution as free energy is minimised. The minimisation of free energy over time ensures entropy does not increase, thereby enabling biological systems to resist the second law of thermodynamics and their implicit dissipation or decay.\n\nNote that the generative model is not a model of the biological system itself, but an implicit model of how the environment generates its sensory data. The dynamics of inference and behaviour that we are interested in here emerge from minimising free energy under an appropriate choice of generative model. For readers with a physics background, and analogy would be that the free energy plays the role of a Lagrangian whose ‘potential energy’ component is given by the generative model. Just as a Lagrangian is used to recover the equations of motion for a physical system, we use the free energy to recover the belief updates that determine a biological system’s behaviour.\n\nIn the following, we begin by describing the form of the generative model we have used to date. We will then address the form of the approximate posterior distribution. To make inference tractable, this generally involves a mean-field approximation that factorises the approximate posterior distribution into independent factors or marginal distributions.\n\nThe generative models used in this paper are subtly different for each free energy functional, but the variables themselves are the same. These are policies (𝜋\nπ\n) and state trajectories (𝑠̃\ns\n~\n), all of which are latent (unknown random) variables that have to be inferred. States evolve as a discrete Markov chain, where the transition probabilities are functions of the policy. Likelihood distributions probabilistically map hidden states to observations (𝑜̃\no\n~\n). Figure  (left) shows these dependencies as a graphical Bayesian network. This type of generative model has been used extensively in simulations of active inference (FitzGerald et al. , ; Friston et al. , , , ; Schwartenbeck et al. ), see Table .\n\nFig. 1\nfigure1\nMarkov decision process. This shows the basic structure of the discrete state-space generative model used in this paper, assuming the current time is t = τ. The factor graph on the left is the generative model we have used in previous work. Importantly, the prior belief about observations only enters this graph through the expected free energy, 𝐺\nG\n (see main text), which enters the prior over policies. Policies index alternative trajectories, or sequences, of actions. In this sense, they are not time dependent, as each policy determines a sequence of actions for all time-points. Conversely, the actions (u) are time dependent. U is an array that specifies an action for each time step (rows) and each policy (columns). The selected action therefore depends upon the most likely policy and the action that policy implies for that time step. Action selection is technically not part of the generative model, as it relies upon the posterior distribution Q (please see main text for details), obtained by inverting the model. This is an important, aspect of active inference, as it underwrites the way in which the system performing inference may change the process generating its observed data. The grey region of this graph indicates that the observation at the next time step is not yet available, so cannot yet be incorporated into the graph. The right factor graph is the new version of the generative model considered in this paper. This generative model does not require an expected free energy, and the prior over outcomes enters the model directly as a constraint on outcomes. This also shows a time dependence, as future outcomes are treated as unobserved latent variables (indicated by an unfilled circle). Observed variables are shown as filled circles in both graphs and unobserved variables as unfilled circles. Factors of the generative model (i.e. conditional probability distributions and prior probabilities) are shown as squares. These squares are connected to those circles containing variables that participate in the same factor. Please refer to the main text and Table 2 for a description of the variables. In the panel on the right, the definitions are given for each of the factors in blue squares. Here, Cat refers to the categorical distribution (color figure online)\nFull size image\nThe role of the generative model is simply to define the free energy functional which, as we will see in Sects. –, gives rise to the belief update rules that we will employ for our simulations. However, it is helpful to imagine how we might generate data from such a model. We outline this process with the model on the left of Fig.  in mind. We could start at the first time step and sample a state from the categorical prior over initial states. The parameters of this prior () are simply a vector of probabilities for each alternative state. From this, we can now sample from the likelihood. This is formulated as a matrix (), whose columns correspond to a state and whose rows are the alternative outcomes that may be generated. To generate an outcome, we would select the column of this matrix corresponding to the state we sampled and sample an outcome from this column-vector of probabilities. It is this outcome that would be available to a synthetic creature.\n\nTaking a discrete time step into the future, we can sample a new state from the column of a transition matrix () associated with the state at the previous time. Crucially, the transition probabilities are conditioned upon the selected action. This means we have a separate -matrix for each action. Action selection depends upon the policy, with each policy and time point associated with an action. For the model on the left of Fig. , this means we calculate the expected free energy () for each policy, which depends upon a vector of prior probabilities for outcomes under these policies (). Combining these with a prior bias term ()—as set out in more detail in Sect. —we can construct a prior over policies. Sampling from this and selecting the action that corresponds to this policy, at this time, specify the -matrix from which to sample the state for the current time step. We could then sample the outcome for this time from the relevant column of the -matrix. This process can be repeated for a series of discrete time steps, generating a new outcome for each time. A similar approach could be taken to generate data from the model on the right of Fig. . However, note that the likelihood here comprises both  and , and the policy prior only includes  (i.e. the expected free energy does not explicitly feature in this model). The procedure outlined above provides an intuition into the beliefs a creature has about how its sensory data are generated by acting on hidden states in the environment.\n\nIt is worth noting that the free energy is a  of the distributions in the generative model and of the approximate posterior beliefs, but a  of observations. Continuing with this free energy, we now consider the mean-field approximation in current implementations of active inference, and its consequences for the variational free energy. In the next few sections, we unpack the variational free energy, and its role in active inference based on Markov decision processes. The argument that follows is a little involved, but we summarise the key steps here, such that the agenda of each of the following sections is clear. In Sect. , we specify the form of the variational distribution we employ, and the free energy that results from this. In Sect. , we unpack the terms in the free energy as they pertain to the generative model. This depends upon having a prior belief about policies. Section  attempts to identify this prior, through finding the optimal posterior and extrapolating backwards in time. This highlights a shortcoming of this approach that is resolved in Sect. . In addition to providing a more appropriate prior for policy selection, Sect.  sets out the role of free energy in simulating behaviour. In brief, this involves finding the variational distribution over policies that minimises free energy. As free energy is a function of sensory observations, this means we need to update these distributions following each new observation. Section  follows the same approach to find the free energy minima for beliefs about states, giving the fixed points to which these distributions must be updated following each new observation.\n\nDefinition of the mean-field variational free energy\nTo define the variational free energy for the above generative model, we first need to specify the form of the approximate posterior distribution, 𝑄\nQ\n. We do this via a mean-field approximation that treats the (policy dependent) state at each time step as approximately independent of the state at any other time step. We treat the distribution over the policy as a separate factor, which implies a set of (policy) models, 𝜋\nπ\n, over hidden variables 𝑠𝜏\ns\nτ\n:\n\n𝑄(𝑠̃,𝜋)=𝑄(𝜋)∏𝜏𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\n~\n,\nπ\n)\n=\nQ\n(\nπ\n)\n∏\nτ\nQ\n(\ns\nτ\n|\nπ\n)\nMean-field approximations originated in statistical physics, where they can be used to approximate Helmholtz free energy through appealing to an average with respect to a ‘reference’ Hamiltonian. This reference can be simply defined for a system with non-interacting components (or degrees of freedom). In virtue of the assumption that the system’s degrees of freedom do not interact, their Hamiltonian (scaled negative log probability) may be expressed as a sum of contributions from each component. Exponentiating this sum, the probability density can be expressed as a product of marginal probabilities for each degree of freedom. The same idea has been employed extensively in statistical inference and machine learning, where a mean-field approximation refers to the use of a variational distribution comprising a product of marginals (Winn and Bishop ; Yedidia et al. ). The ‘mean field’ is the expected value of each (log) factor of the generative model (), which include the interactions, under the fully factorised distribution (). The advantage to using a mean-field approximation is the computational tractability that comes from being able to separately optimise each marginal distribution. We can now substitute this factorised distribution into our definition for the variational free energy above:\n\n𝐹=𝐸𝑄(𝜋)[𝐹𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝐹𝜋=−𝐸𝑄(𝑠̃|𝜋)[ln𝑃(𝑜̃,𝑠̃|𝜋)−∑𝜏ln𝑄(𝑠𝜏|𝜋)]\nF=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=−\nE\nQ\n(\ns\n~\n|\nπ\n)\n[ln⁡P(\no\n~\n,\ns\n~\n|\nπ)−\n∑\nτ\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n] \nIn this form, the variational free energy is expressed in terms of policy-dependent terms (second equality) that bound the (negative log) evidence for each policy and a complexity cost or KL divergenceFootnote 1 () that scores the departure of the posterior beliefs over policies from the corresponding prior beliefs.\n\nPast and future\nThere is an important difference in how past and future outcomes are treated by the variational free energy. Note that—as a function of outcomes—the components of the free energy that depend on outcomes can only be evaluated for the past and present. Hidden states, on the other hand, enter the expression as  about states. In other words, the free energy is a functional of distributions over states, rather than a function, as in the case of outcomes. This means that free energy evaluation takes account of future states. We can express this explicitly by writing the variational free energy, at time , as a sum over all time steps, factorising the generative distribution according to the conditional independencies expressed in Fig. :\n\n𝐹𝜋=∑𝜏𝐹𝜋𝜏𝐹𝜋𝜏=−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[[𝜏≤𝑡]⋅ln𝑃(𝑜𝜏|𝑠𝜏)+ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)−ln𝑄(𝑠𝜏|𝜋)]\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\n[\nτ\n≤\nt\n]\n⋅\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n+\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n]\n \nIn the above, the Iverson (square) brackets return 1 if the expression is true, and 0 otherwise. It is this condition that differentiates contributions from the past from the future. This equation is obtained in a straightforward way by factorising the generative model (joint distribution) in the second line of Eq. , in line with the generative model depicted in Fig. . Because the generative model does not include future observations as random variables (given that these data have yet to be collected), there are no accompanying likelihood factors. This reflects the fact that the only data that contribute to the free energy are those we currently have access to. Given the dependence of the right-hand side on the current time () the free energy should, strictly speaking, be written as a function of  and . As we are interested here in online inference, we will assume an implicit conditioning upon  for all free energies throughout this paper. The Iverson brackets above allow us to decompose the sum into past and future components:\n\n𝐹𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷KL[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nKL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n(5)\nIn this decomposition, the contribution of beliefs about future states reduces to a complexity cost. This is the KL divergence between approximate posterior beliefs about states in the future and prior beliefs. The latter are based upon the (policy-specific) transition probabilities in the generative model.\n\nPolicy posteriors and priors\nUsing the full variational free energy (over all policies) from Eq. 3, we can evaluate posterior beliefs about policies. The variational derivative of the free energy with respect to these beliefs is (where we omit constants, and where 𝜎(⋅)\nσ\n(\n⋅\n)\n is a softmax function—i.e. a normalised exponential function):\n\n𝛿𝐹𝛿𝑄(𝜋)=𝐹𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(6)\nThe second line derives from the first through rearranging, exponentiating both sides of the equation, and normalising to ensure the approximate posterior sums to one. This, together with Eq. 5, implies the belief prior to any observations (i.e. at 𝑡=0\nt\n=\n0\n), which is given by:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−∑𝜏𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]])\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\n∑\nτ\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n)\n(7)\nThis is an unsatisfying result, in which it fails to accommodate our prior knowledge that outcomes will become available in the future. In other words, the posterior at each time step is calculated under a different model (see Fig. 2).\n\nFig. 2\nfigure2\nTemporal progression of Markov decision process. The upper graphs shows the structure of the generative model implied using the variational free energy, equipped with a prior that the expected free energy will be minimised by policy selection. Observations are added to the model as they occur. The lower graphs show the structure of the generative model that explicitly represents future outcomes, and minimises a generalised free energy through policy selection. As observations are made, the outcome variables collapse to delta functions. These graphics are intended to highlight two alternative conceptions of a generative model employed in an online setting. The key problem here is how to deal with missing (future) outcomes. These could be omitted until such a time as they become available. Alternatively, they could be treated as hidden variables about which we can hold beliefs. Please note that this graphic illustrates different ways of formulating the generative model used to calculate belief updates. It does not show belief updates, behaviour or any other free energy minimising process. These will be detailed in subsequent sections and figures. However, the reason for making this distinction is important for how we formulate the free energy. The key distinction between the free energies compared in this paper is which of the two perspectives on future outcomes we choose to adopt\nFull size image\nExpected free energy\nTo finesse this shortcoming, we can assume agents select the policy that they expect will lead to the lowest free energy (summed over time). This is motivated by the reductio ad absurdum in the introduction and is expressed mathematically as:\n\n𝑄𝑜(𝜋)≜𝜎(ln𝑃(𝜋)−𝐺𝜋)\nQ\no\n(\nπ\n)\n≜\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\nπ\n)\n(8)\nThis replaces the expression for 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n given in Sect. 2.3. (We retain the notation Qo(π) for the prior here to distinguish this from the fixed form prior P(π), which does not depend on the beliefs about states.) Gπ is the expected free energy, conditioned on a policy. It is defined as:\n\n𝐺𝜋=∑𝜏>𝑡𝐺𝜋𝜏𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏)−ln𝑄(𝑠𝜏|𝜋)]\nG\nπ\n=\n∑\nτ\n>\nt\nG\nπ\nτ\nG\nπ\nτ\n=−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n,\ns\nτ\n)−ln⁡Q(\ns\nτ\n|\nπ)] \n(9)\nThere is an apparent problem with this quantity: The first term within the expectation is a function of outcomes that have yet to be observed. To take this into account, we have defined an (approximate) joint distribution over states and outcomes: 𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)=𝑃(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nP\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, and take the expectation with respect to this. This means that we can express a (posterior predictive) belief about the observations in the future based on (posterior predictive) beliefs about hidden states. One can obtain a useful form of the expected free energy by rearranging the above: if we factorise the generative model, we obtain:\n\n𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑠𝜏|𝑜𝜏)−ln𝑄(𝑠𝜏|𝜋)Epistemicvalue+ln𝑃(𝑜𝜏)⏟Extrinsicvalue]\nG\nπ\nτ\n=\n−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\ns\nτ\n|\no\nτ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEpistemic\nvalue\n+\nln\n⁡\nP\n(\no\nτ\n)\n⏟\nExtrinsic\nvalue\n]\n(10)\nThis form shows that policies that have a low expected free energy are those that resolve uncertainty, and that fulfil prior preferences about outcomes. It is the first of these terms that endorses the metaphor of the brain as a scientist, performing experiments (i.e. actions with sensory consequences) to verify or refute hypotheses about the world (Friston et al. 2012b; Gregory 1980). The second term speaks to the notion of a ‘crooked scientist’ (Bruineberg et al. 2016), who designs experiments to confirm prior beliefs, i.e. preferred outcomes. This preference is the same as the evidence (a.k.a., marginal likelihood) associated with a given model. This means policies are selected such that the most probable outcomes under that policy match the most probable outcomes under prior preferences (defined in terms of a marginal likelihood).\n\nTreating 𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\nτ\n|\nπ\n)\n as a prior, and 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n as a posterior, we can directly substitute these into Bayes’ rule, which says that their ratio is equal to the ratio of the corresponding likelihood (𝑄(𝑜𝜏|𝑠𝜏,𝜋)≈𝑃(𝑜𝜏|𝑠𝜏)\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\n≈\nP\n(\no\nτ\n|\ns\nτ\n)\n) and marginal likelihood (𝑄(𝑜𝜏|𝜋)\nQ\n(\no\nτ\n|\nπ\n)\n):\n\n𝑃(𝑠𝜏|𝑜𝜏)𝑄(𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏,𝜋)𝑄(𝑜𝜏|𝜋)\nP\n(\ns\nτ\n|\no\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n(11)\nDue to the symmetry of Bayes’ rule, another perspective on this is that 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n is a likelihood that generates states from observations. This view treats the right-hand side of the above as the ratio between a posterior and a prior. Using this relationship, we can express expected free energy in terms of risk and ambiguity:\n\n𝐺𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[ln𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\nIn this equation, H is the Shannon entropy (i.e. negative expected log probability). This means that the prior belief about outcomes enters the generative model through the KL divergence between outcomes expected under any policy and prior preferences. This form also illustrates the correspondence between the expected free energy and the quantities ‘risk’ and ‘ambiguity’ from behavioural economics (Ellsberg 1961; Ghirardato and Marinacci 2002). Risk quantifies the expected cost of a policy as a divergence from preferred outcomes and is sometimes referred to as Bayesian risk or regret (Huggins and Tenenbaum 2015), which underlies KL control and related Bayesian control rules (Kappen et al. 2012; Ortega and Braun 2010; Todorov 2008) and special cases that include Thompson sampling (Lloyd and Leslie 2013; Strens 2000). Ambiguous states are those that have an uncertain mapping to observations. The greater these quantities, the less likely it is that the associated policy will be chosen.\n\nHaving identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\nMany of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\nL\n(Q(\ns\n~\n|\nπ),\ns\n~\n)=Q(\ns\n~\n|\nπ)(ln⁡Q(\ns\n~\n|\nπ)−ln⁡P(\no\n~\n,\ns\n~\n|\nπ))\t\tS=\nF\nπ\n=\n∑\ns\n~\nL\n(\nQ\n(\ns\n~\n|\nπ\n)\n,\ns\n~\n)\nP(\ns\n~\n|\nπ,\no\n~\n)≈\narg\n⁡\nmin\nQ\n(\ns\n~\n|\nπ\n)\n⁡\nF\nπ\n \nThis says that, to minimise a free energy functional with respect to a probability distribution, we need to find the point at which the partial derivative of the term inside the sum, with respect to this distribution, is zero.\n\nWe hope that this appendix is sufficient for readers not familiar with this style of mathematics to gain some intuition for the variational derivatives used throughout this paper. For interested readers, a more comprehensive introduction to this field can be found in (Moiseiwitsch 2013). For applications in the context of variational inference, please see (Beal 2003).\n\nRights and permissions\nOpen Access This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (http://creativecommons.org/licenses/by/4.0/), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made.\n\nReprints and Permissions\n\nAbout this article\nVerify currency and authenticity via CrossMark\nCite this article\nParr, T., Friston, K.J. Generalised free energy and active inference. Biol Cybern 113, 495–513 (2019). https://doi.org/10.1007/s00422-019-00805-w\n\nDownload citation\n\nReceived\n04 July 2017\n\nAccepted\n13 September 2019\n\nPublished\n27 September 2019\n\nIssue Date\nDecember 2019\n\nDOI\nhttps://doi.org/10.1007/s00422-019-00805-w\n\nShare this article\nAnyone you share the following link with will be able to read this content:\n\nGet shareable link\nProvided by the Springer Nature SharedIt content-sharing initiative\n\nKeywords\nBayesian\nActive inference\nFree energy\nData selection\nEpistemic value\nIntrinsic motivation\nDownload PDF"
      },
      "after": "e855e6952cd4b473",
      "date": 1629442629284
    },
    {
      "type": "edit",
      "id": "96ce7acc443d8478",
      "item": {
        "type": "markdown",
        "id": "96ce7acc443d8478",
        "text": "# Introduction\nOver the past years, we have tried to establish active inference (a corollary of the free energy principle) as a relatively straightforward and principled explanation for action, perception and cognition. Active inference can be summarised as self-evidencing (Hohwy 2016), in the sense that action and perception can be cast as maximising Bayesian model evidence, under generative models of the world. When this maximisation uses approximate Bayesian inference, this is equivalent to minimising variational free energy (Friston et al. 2006)—a form of bounded rational behaviour that minimises a variational bound on model evidence. Recently, we have migrated the basic idea from models that generate continuous sensations (like velocity and luminance contrast) (Brown and Friston 2012) to discrete state-space models, specifically Markov decision processes (Friston et al. 2017a). These models represent the world in terms of discrete states, like I am on this page and reading this word (Friston et al. 2017d). Discrete state-space models can be inferred using belief propagation (Yedidia et al. 2005) or variational message passing (Dauwels 2007; Winn 2004) schemes that have a degree of neuronal plausibility (Friston et al. 2017c). The resulting planning as inference scheme (Attias 2003; Baker et al. 2009; Botvinick and Toussaint 2012; Verma and Rao 2006) has a pleasingly broad explanatory scope, accounting for a range of phenomena in cognitive neuroscience, active vision and motor control (see Table 1). In this paper, we revisit the role of (expected) free energy in active inference and offer an alternative, simpler and more general formulation. This formulation does not substantially change the message passing or belief updating; however, it provides an interesting perspective on planning as inference and the way that we may perceive the future.\n\nTable 1 Applications of active inference for Markov decision processes\nFull size table\nIn current descriptions of active inference, the basic argument goes as follows: active inference is based upon the maximisation of model evidence or minimisation of variational free energy in two complementary ways. First, one can update one’s beliefs about latent or hidden states of the world to make them consistent with observed evidence—or one can actively sample the world to make observations consistent with beliefs about states of the world. The important thing here is that both action and perception are in game of minimising the same quantity, namely variational free energy. A key aspect of this formulation is that action (i.e. behaviour) is absorbed into inference, which means that agents have beliefs about what they are doing—and will do. This calls for prior beliefs about action or policies (i.e. sequences of actions). So where did these prior beliefs come from?\n\nThe answer obtains from a reductio ad absurdum argument: if action realises prior beliefs and minimises free energy, then the only tenable prior beliefs are that action will minimise free energy. If this were not the case, we reach the following absurd conclusion. If a free energy minimising creature did not have the prior belief that it selects policies that minimise (expected) free energy, it would infer (and therefore pursue) policies that were not free energy minimising. As such, it would not be a free energy minimising creature, which is a contradiction. This leads to the prior belief that I will select policies that minimise the free energy expected under that policy. The endpoint of this argument is that action or policy selection becomes a form of Bayesian model selection, where the evidence for a particular policy becomes the free energy expected in the future. This expected free energy is a slightly unusual objective function because it scores the evidence for plausible policies based on outcomes that have yet to be observed. This means that the expected free energy becomes the variational free energy expected under (posterior predictive) beliefs about outcomes. These priors are usually informed by prior beliefs about outcomes that play the role of prior preferences or utility functions in reinforcement learning and economics.\n\nIn summary, beliefs about states of the world and policies are continuously updated to minimise variational free energy, where posterior beliefs about policies (that prescribe action) are based upon expected free energy (that may or may not include prior preferences over future outcomes). This is the current story and leads to interesting issues that rest on the fact that expected free energy can be decomposed into epistemic and pragmatic parts (Friston et al. 2015). This decomposition provides a principled explanation for the epistemics of planning and inference that underwrite the exploitation and exploration dilemma, novelty, salience and so on. However, there is another way of telling this story that leads to a conceptually different sort of interpretation.\n\nIn what follows, we show that the same Bayesian policy (model) selection obtains from minimising variational free energy when future outcomes are treated as hidden or latent states of the world. In other words, we can regard active inference as minimising a generalised free energy under generative models that entertain the consequences of (policy-dependent) hidden states of the world in the future. This simple generalisation induces posterior beliefs over future outcomes that now play the role of latent or hidden states. In this setting, the future is treated in exactly the same way as the hidden or unobservable states of the world generating observations in the past. On this view, one gets the expected free energy for free, because the variational free energy involves an expectation under posterior beliefs over future outcomes. In turn, this means that beliefs about states and policies can be simply and uniformly treated as minimising the same (generalised) free energy, without having to invoke any free energy minimising priors over policies.\n\nTechnically, this leads to the same form of belief updating and (Bayesian) policy selection but provides a different perspective on the free energy principle per se. This perspective says that self-evidencing and active inference both have one underlying imperative, namely to minimise generalised free energy or uncertainty. When this uncertainty is evaluated under models that generate outcomes in the future, future outcomes become hidden states that are only revealed by the passage of time. In this context, outcomes in the past become observations in standard variational inference, while outcomes in the future become posterior beliefs about latent observations that have yet to disclose themselves. In this way, the generalised free energy can be seen as comprising variational free energy contributions from the past and future.\n\nThe current paper provides the formal basis for the above arguments. In brief, we will see that both the expected and generalised free energy formulations lead to the same update equations. However, there is a subtle difference. In the expected free energy formalism, prior preferences or beliefs about outcomes are used to specify the prior over policies. In the generalised formulation, prior beliefs about outcomes in the future inform posterior beliefs about the hidden states that cause them. Because of the implicit forward and backward message passing in the belief propagation scheme obtained at the free energy minimum (Yedidia et al. 2005), these prior beliefs or preferences act to distort expected trajectories (into the future) towards preferences in an optimistic way (Sharot et al. 2012). Intuitively, the expected free energy contribution to generalised free energy evaluates the (complexity) cost of this distortion, thereby favouring policies that lead naturally to preferred outcomes—without violating beliefs about state transitions and the (likelihood) mapping between states and outcomes. The implicit coupling between beliefs about the future and current actions means that, in one sense, the future can cause the past.\n\nFraming probabilistic reasoning in terms of inferential message passing formalises several prominent concepts in the study of human decision making. The idea that prior beliefs distort beliefs about future and that this optimism about the future propagates backwards in time to influence behaviour in an adaptive way (McKay and Dennett 2010; Sharot 2011), is highly consistent with an influence of beliefs about the future over beliefs about the present. Simplistically, the idea behind these accounts is that adaptive behaviour relies upon the (possibly false) belief that future events will accord with our preferences. It is only by believing that we will realise these goals that we act in a manner consistent with their realisation. Intuitively, without the belief that we will end up eating dinner, there would be no reason to shop for ingredients. The passing of messages from past to future resonates with the notion that working memory is vital for predicting the future and planning actions accordingly (Gilhooly 2005; Hikosaka et al. 2000), and underwrites research on episodic future thinking and counterfactual reasoning (Schacter et al. 2015). Appealing to bidirectional inferential message passing has enabled us to reproduce a range of behavioural and electrophysiological phenomena through simulation (summarised in Table 1).\n\nThis paper comprises three sections. In the first, we outline the approach we have used to date (i.e. minimising the variational free energy under prior beliefs that policies with a low expected free energy are more probable). In the second, we introduce a generalisation of the variational free energy that incorporates beliefs about future outcomes. The third section compares these two approaches conceptually and through illustrative simulations.\n\nActive inference and variational free energy\nThe free energy principle is motivated by the defining characteristic of living creatures, namely that they persist in the face of a changing world. In other words, their states occupy a small proportion of all possible states with a high probability. From the perspective of statistical physics, this means that they show a form of self-organised, non-equilibrium steady-state that maintains a low entropy probability distribution over their states. In information theory, self-information or surprise (a.k.a. negative log model evidence) averaged over time is entropy. More generally, entropy is defined in terms of an ensemble average. However, under that assumption that a system has achieved its (non-equilibrium) steady state, the ensemble and time average are equivalent (under mild weakly mixing assumptions). This means, at any given time, all biological systems are compelled to minimise their surprise. While this may seem like a very bold statement, we do not intend to trivialise the many constraints that dictate behaviour. The point here is that when all these constraints are written into a generative model as prior beliefs, they all contribute to the same cost function: surprise. This reframes the problem of expressing the constraints biological systems must satisfy as a problem of specifying the right set of priors. Although the computation of surprise is often intractable, an approximation is simple to calculate. This is variational free energy (Beal 2003; Dayan et al. 1995; Friston 2003) which depends upon specifying a generative model of how data are caused. This generative model comprises a series of conditional probability distributions. For a Markov decision process, it assumes a series of states (s) that evolve through time. At each time step, the probability of transitioning from one state to the next depends upon a policy (π). Neither states nor policies are directly accessible to the creature in question. However, each state probabilistically generates an observable outcome (o). As Jensen’s inequality demonstrates, free energy is an upper bound on surprise.\n\n𝐹⏟Freeenergy=−𝐸𝑄(𝑠̃,𝜋)[ln𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]≥−ln𝐸𝑄(𝑠̃,𝜋)[𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]Jensen′sinequality=−ln𝑃(𝑜̃)Surprise\nF\n⏟\nFree\nenergy\n=\n−\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nln\n⁡\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n≥\n−\nln\n⁡\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n⏟\nJensen\n′\ns\ninequality\n=\n−\nln\n⁡\nP\n(\no\n~\n)\n⏟\nSurprise\nIn the equation above,  indicates a probability distribution over outcomes 𝑜̃=(𝑜1,𝑜2,…,𝑜𝑇)\no\n~\n=\n(\no\n1\n,\no\n2\n,\n…\n,\no\nT\n)\n that are generated by hidden states of the world 𝑠̃=(𝑠1,𝑠2,…,𝑠𝑇)\ns\n~\n=\n(\ns\n1\n,\ns\n2\n,\n…\n,\ns\nT\n)\n and policies, which define the generative model. The generative model is thus expressed as a joint probability distribution over outcomes (i.e. consequences) and their causes (i.e. hidden states of the world and policies available to the agent). Marginalising (i.e. summing or integrating) over the states and policies gives the evidence (a.k.a., marginal likelihood). The log of this marginal likelihood is negative surprise.  is a probability distribution over unobservable (hidden) states and policies—that becomes an approximate posterior distribution as free energy is minimised. The minimisation of free energy over time ensures entropy does not increase, thereby enabling biological systems to resist the second law of thermodynamics and their implicit dissipation or decay.\n\nNote that the generative model is not a model of the biological system itself, but an implicit model of how the environment generates its sensory data. The dynamics of inference and behaviour that we are interested in here emerge from minimising free energy under an appropriate choice of generative model. For readers with a physics background, and analogy would be that the free energy plays the role of a Lagrangian whose ‘potential energy’ component is given by the generative model. Just as a Lagrangian is used to recover the equations of motion for a physical system, we use the free energy to recover the belief updates that determine a biological system’s behaviour.\n\nIn the following, we begin by describing the form of the generative model we have used to date. We will then address the form of the approximate posterior distribution. To make inference tractable, this generally involves a mean-field approximation that factorises the approximate posterior distribution into independent factors or marginal distributions.\n\nThe generative models used in this paper are subtly different for each free energy functional, but the variables themselves are the same. These are policies (𝜋\nπ\n) and state trajectories (𝑠̃\ns\n~\n), all of which are latent (unknown random) variables that have to be inferred. States evolve as a discrete Markov chain, where the transition probabilities are functions of the policy. Likelihood distributions probabilistically map hidden states to observations (𝑜̃\no\n~\n). Figure  (left) shows these dependencies as a graphical Bayesian network. This type of generative model has been used extensively in simulations of active inference (FitzGerald et al. , ; Friston et al. , , , ; Schwartenbeck et al. ), see Table .\n\nFig. 1\nfigure1\nMarkov decision process. This shows the basic structure of the discrete state-space generative model used in this paper, assuming the current time is t = τ. The factor graph on the left is the generative model we have used in previous work. Importantly, the prior belief about observations only enters this graph through the expected free energy, 𝐺\nG\n (see main text), which enters the prior over policies. Policies index alternative trajectories, or sequences, of actions. In this sense, they are not time dependent, as each policy determines a sequence of actions for all time-points. Conversely, the actions (u) are time dependent. U is an array that specifies an action for each time step (rows) and each policy (columns). The selected action therefore depends upon the most likely policy and the action that policy implies for that time step. Action selection is technically not part of the generative model, as it relies upon the posterior distribution Q (please see main text for details), obtained by inverting the model. This is an important, aspect of active inference, as it underwrites the way in which the system performing inference may change the process generating its observed data. The grey region of this graph indicates that the observation at the next time step is not yet available, so cannot yet be incorporated into the graph. The right factor graph is the new version of the generative model considered in this paper. This generative model does not require an expected free energy, and the prior over outcomes enters the model directly as a constraint on outcomes. This also shows a time dependence, as future outcomes are treated as unobserved latent variables (indicated by an unfilled circle). Observed variables are shown as filled circles in both graphs and unobserved variables as unfilled circles. Factors of the generative model (i.e. conditional probability distributions and prior probabilities) are shown as squares. These squares are connected to those circles containing variables that participate in the same factor. Please refer to the main text and Table 2 for a description of the variables. In the panel on the right, the definitions are given for each of the factors in blue squares. Here, Cat refers to the categorical distribution (color figure online)\nFull size image\nThe role of the generative model is simply to define the free energy functional which, as we will see in Sects. –, gives rise to the belief update rules that we will employ for our simulations. However, it is helpful to imagine how we might generate data from such a model. We outline this process with the model on the left of Fig.  in mind. We could start at the first time step and sample a state from the categorical prior over initial states. The parameters of this prior () are simply a vector of probabilities for each alternative state. From this, we can now sample from the likelihood. This is formulated as a matrix (), whose columns correspond to a state and whose rows are the alternative outcomes that may be generated. To generate an outcome, we would select the column of this matrix corresponding to the state we sampled and sample an outcome from this column-vector of probabilities. It is this outcome that would be available to a synthetic creature.\n\nTaking a discrete time step into the future, we can sample a new state from the column of a transition matrix () associated with the state at the previous time. Crucially, the transition probabilities are conditioned upon the selected action. This means we have a separate -matrix for each action. Action selection depends upon the policy, with each policy and time point associated with an action. For the model on the left of Fig. , this means we calculate the expected free energy () for each policy, which depends upon a vector of prior probabilities for outcomes under these policies (). Combining these with a prior bias term ()—as set out in more detail in Sect. —we can construct a prior over policies. Sampling from this and selecting the action that corresponds to this policy, at this time, specify the -matrix from which to sample the state for the current time step. We could then sample the outcome for this time from the relevant column of the -matrix. This process can be repeated for a series of discrete time steps, generating a new outcome for each time. A similar approach could be taken to generate data from the model on the right of Fig. . However, note that the likelihood here comprises both  and , and the policy prior only includes  (i.e. the expected free energy does not explicitly feature in this model). The procedure outlined above provides an intuition into the beliefs a creature has about how its sensory data are generated by acting on hidden states in the environment.\n\nIt is worth noting that the free energy is a  of the distributions in the generative model and of the approximate posterior beliefs, but a  of observations. Continuing with this free energy, we now consider the mean-field approximation in current implementations of active inference, and its consequences for the variational free energy. In the next few sections, we unpack the variational free energy, and its role in active inference based on Markov decision processes. The argument that follows is a little involved, but we summarise the key steps here, such that the agenda of each of the following sections is clear. In Sect. , we specify the form of the variational distribution we employ, and the free energy that results from this. In Sect. , we unpack the terms in the free energy as they pertain to the generative model. This depends upon having a prior belief about policies. Section  attempts to identify this prior, through finding the optimal posterior and extrapolating backwards in time. This highlights a shortcoming of this approach that is resolved in Sect. . In addition to providing a more appropriate prior for policy selection, Sect.  sets out the role of free energy in simulating behaviour. In brief, this involves finding the variational distribution over policies that minimises free energy. As free energy is a function of sensory observations, this means we need to update these distributions following each new observation. Section  follows the same approach to find the free energy minima for beliefs about states, giving the fixed points to which these distributions must be updated following each new observation.\n\nDefinition of the mean-field variational free energy\nTo define the variational free energy for the above generative model, we first need to specify the form of the approximate posterior distribution, 𝑄\nQ\n. We do this via a mean-field approximation that treats the (policy dependent) state at each time step as approximately independent of the state at any other time step. We treat the distribution over the policy as a separate factor, which implies a set of (policy) models, 𝜋\nπ\n, over hidden variables 𝑠𝜏\ns\nτ\n:\n\n𝑄(𝑠̃,𝜋)=𝑄(𝜋)∏𝜏𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\n~\n,\nπ\n)\n=\nQ\n(\nπ\n)\n∏\nτ\nQ\n(\ns\nτ\n|\nπ\n)\nMean-field approximations originated in statistical physics, where they can be used to approximate Helmholtz free energy through appealing to an average with respect to a ‘reference’ Hamiltonian. This reference can be simply defined for a system with non-interacting components (or degrees of freedom). In virtue of the assumption that the system’s degrees of freedom do not interact, their Hamiltonian (scaled negative log probability) may be expressed as a sum of contributions from each component. Exponentiating this sum, the probability density can be expressed as a product of marginal probabilities for each degree of freedom. The same idea has been employed extensively in statistical inference and machine learning, where a mean-field approximation refers to the use of a variational distribution comprising a product of marginals (Winn and Bishop ; Yedidia et al. ). The ‘mean field’ is the expected value of each (log) factor of the generative model (), which include the interactions, under the fully factorised distribution (). The advantage to using a mean-field approximation is the computational tractability that comes from being able to separately optimise each marginal distribution. We can now substitute this factorised distribution into our definition for the variational free energy above:\n\n𝐹=𝐸𝑄(𝜋)[𝐹𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝐹𝜋=−𝐸𝑄(𝑠̃|𝜋)[ln𝑃(𝑜̃,𝑠̃|𝜋)−∑𝜏ln𝑄(𝑠𝜏|𝜋)]\nF=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=−\nE\nQ\n(\ns\n~\n|\nπ\n)\n[ln⁡P(\no\n~\n,\ns\n~\n|\nπ)−\n∑\nτ\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n] \nIn this form, the variational free energy is expressed in terms of policy-dependent terms (second equality) that bound the (negative log) evidence for each policy and a complexity cost or KL divergenceFootnote 1 () that scores the departure of the posterior beliefs over policies from the corresponding prior beliefs.\n\nPast and future\nThere is an important difference in how past and future outcomes are treated by the variational free energy. Note that—as a function of outcomes—the components of the free energy that depend on outcomes can only be evaluated for the past and present. Hidden states, on the other hand, enter the expression as  about states. In other words, the free energy is a functional of distributions over states, rather than a function, as in the case of outcomes. This means that free energy evaluation takes account of future states. We can express this explicitly by writing the variational free energy, at time , as a sum over all time steps, factorising the generative distribution according to the conditional independencies expressed in Fig. :\n\n𝐹𝜋=∑𝜏𝐹𝜋𝜏𝐹𝜋𝜏=−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[[𝜏≤𝑡]⋅ln𝑃(𝑜𝜏|𝑠𝜏)+ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)−ln𝑄(𝑠𝜏|𝜋)]\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\n[\nτ\n≤\nt\n]\n⋅\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n+\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n]\n \nIn the above, the Iverson (square) brackets return 1 if the expression is true, and 0 otherwise. It is this condition that differentiates contributions from the past from the future. This equation is obtained in a straightforward way by factorising the generative model (joint distribution) in the second line of Eq. , in line with the generative model depicted in Fig. . Because the generative model does not include future observations as random variables (given that these data have yet to be collected), there are no accompanying likelihood factors. This reflects the fact that the only data that contribute to the free energy are those we currently have access to. Given the dependence of the right-hand side on the current time () the free energy should, strictly speaking, be written as a function of  and . As we are interested here in online inference, we will assume an implicit conditioning upon  for all free energies throughout this paper. The Iverson brackets above allow us to decompose the sum into past and future components:\n\n𝐹𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷KL[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nKL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n(5)\nIn this decomposition, the contribution of beliefs about future states reduces to a complexity cost. This is the KL divergence between approximate posterior beliefs about states in the future and prior beliefs. The latter are based upon the (policy-specific) transition probabilities in the generative model.\n\nPolicy posteriors and priors\nUsing the full variational free energy (over all policies) from Eq. 3, we can evaluate posterior beliefs about policies. The variational derivative of the free energy with respect to these beliefs is (where we omit constants, and where 𝜎(⋅)\nσ\n(\n⋅\n)\n is a softmax function—i.e. a normalised exponential function):\n\n𝛿𝐹𝛿𝑄(𝜋)=𝐹𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(6)\nThe second line derives from the first through rearranging, exponentiating both sides of the equation, and normalising to ensure the approximate posterior sums to one. This, together with Eq. 5, implies the belief prior to any observations (i.e. at 𝑡=0\nt\n=\n0\n), which is given by:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−∑𝜏𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]])\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\n∑\nτ\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n)\n(7)\nThis is an unsatisfying result, in which it fails to accommodate our prior knowledge that outcomes will become available in the future. In other words, the posterior at each time step is calculated under a different model (see Fig. 2).\n\nFig. 2\nfigure2\nTemporal progression of Markov decision process. The upper graphs shows the structure of the generative model implied using the variational free energy, equipped with a prior that the expected free energy will be minimised by policy selection. Observations are added to the model as they occur. The lower graphs show the structure of the generative model that explicitly represents future outcomes, and minimises a generalised free energy through policy selection. As observations are made, the outcome variables collapse to delta functions. These graphics are intended to highlight two alternative conceptions of a generative model employed in an online setting. The key problem here is how to deal with missing (future) outcomes. These could be omitted until such a time as they become available. Alternatively, they could be treated as hidden variables about which we can hold beliefs. Please note that this graphic illustrates different ways of formulating the generative model used to calculate belief updates. It does not show belief updates, behaviour or any other free energy minimising process. These will be detailed in subsequent sections and figures. However, the reason for making this distinction is important for how we formulate the free energy. The key distinction between the free energies compared in this paper is which of the two perspectives on future outcomes we choose to adopt\nFull size image\nExpected free energy\nTo finesse this shortcoming, we can assume agents select the policy that they expect will lead to the lowest free energy (summed over time). This is motivated by the reductio ad absurdum in the introduction and is expressed mathematically as:\n\n𝑄𝑜(𝜋)≜𝜎(ln𝑃(𝜋)−𝐺𝜋)\nQ\no\n(\nπ\n)\n≜\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\nπ\n)\n(8)\nThis replaces the expression for 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n given in Sect. 2.3. (We retain the notation Qo(π) for the prior here to distinguish this from the fixed form prior P(π), which does not depend on the beliefs about states.) Gπ is the expected free energy, conditioned on a policy. It is defined as:\n\n𝐺𝜋=∑𝜏>𝑡𝐺𝜋𝜏𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏)−ln𝑄(𝑠𝜏|𝜋)]\nG\nπ\n=\n∑\nτ\n>\nt\nG\nπ\nτ\nG\nπ\nτ\n=−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n,\ns\nτ\n)−ln⁡Q(\ns\nτ\n|\nπ)] \n(9)\nThere is an apparent problem with this quantity: The first term within the expectation is a function of outcomes that have yet to be observed. To take this into account, we have defined an (approximate) joint distribution over states and outcomes: 𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)=𝑃(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nP\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, and take the expectation with respect to this. This means that we can express a (posterior predictive) belief about the observations in the future based on (posterior predictive) beliefs about hidden states. One can obtain a useful form of the expected free energy by rearranging the above: if we factorise the generative model, we obtain:\n\n𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑠𝜏|𝑜𝜏)−ln𝑄(𝑠𝜏|𝜋)Epistemicvalue+ln𝑃(𝑜𝜏)⏟Extrinsicvalue]\nG\nπ\nτ\n=\n−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\ns\nτ\n|\no\nτ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEpistemic\nvalue\n+\nln\n⁡\nP\n(\no\nτ\n)\n⏟\nExtrinsic\nvalue\n]\n(10)\nThis form shows that policies that have a low expected free energy are those that resolve uncertainty, and that fulfil prior preferences about outcomes. It is the first of these terms that endorses the metaphor of the brain as a scientist, performing experiments (i.e. actions with sensory consequences) to verify or refute hypotheses about the world (Friston et al. 2012b; Gregory 1980). The second term speaks to the notion of a ‘crooked scientist’ (Bruineberg et al. 2016), who designs experiments to confirm prior beliefs, i.e. preferred outcomes. This preference is the same as the evidence (a.k.a., marginal likelihood) associated with a given model. This means policies are selected such that the most probable outcomes under that policy match the most probable outcomes under prior preferences (defined in terms of a marginal likelihood).\n\nTreating 𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\nτ\n|\nπ\n)\n as a prior, and 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n as a posterior, we can directly substitute these into Bayes’ rule, which says that their ratio is equal to the ratio of the corresponding likelihood (𝑄(𝑜𝜏|𝑠𝜏,𝜋)≈𝑃(𝑜𝜏|𝑠𝜏)\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\n≈\nP\n(\no\nτ\n|\ns\nτ\n)\n) and marginal likelihood (𝑄(𝑜𝜏|𝜋)\nQ\n(\no\nτ\n|\nπ\n)\n):\n\n𝑃(𝑠𝜏|𝑜𝜏)𝑄(𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏,𝜋)𝑄(𝑜𝜏|𝜋)\nP\n(\ns\nτ\n|\no\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n(11)\nDue to the symmetry of Bayes’ rule, another perspective on this is that 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n is a likelihood that generates states from observations. This view treats the right-hand side of the above as the ratio between a posterior and a prior. Using this relationship, we can express expected free energy in terms of risk and ambiguity:\n\n𝐺𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[ln𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\nIn this equation, H is the Shannon entropy (i.e. negative expected log probability). This means that the prior belief about outcomes enters the generative model through the KL divergence between outcomes expected under any policy and prior preferences. This form also illustrates the correspondence between the expected free energy and the quantities ‘risk’ and ‘ambiguity’ from behavioural economics (Ellsberg 1961; Ghirardato and Marinacci 2002). Risk quantifies the expected cost of a policy as a divergence from preferred outcomes and is sometimes referred to as Bayesian risk or regret (Huggins and Tenenbaum 2015), which underlies KL control and related Bayesian control rules (Kappen et al. 2012; Ortega and Braun 2010; Todorov 2008) and special cases that include Thompson sampling (Lloyd and Leslie 2013; Strens 2000). Ambiguous states are those that have an uncertain mapping to observations. The greater these quantities, the less likely it is that the associated policy will be chosen.\n\nHaving identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\nMany of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\n"
      },
      "date": 1629442656410
    },
    {
      "type": "add",
      "id": "6bf435d382412c49",
      "item": {
        "type": "markdown",
        "id": "6bf435d382412c49",
        "text": "L\n(Q(\ns\n~\n|\nπ),\ns\n~\n)=Q(\ns\n~\n|\nπ)(ln⁡Q(\ns\n~\n|\nπ)−ln⁡P(\no\n~\n,\ns\n~\n|\nπ))\t\tS=\nF\nπ\n=\n∑\ns\n~\nL\n(\nQ\n(\ns\n~\n|\nπ\n)\n,\ns\n~\n)\nP(\ns\n~\n|\nπ,\no\n~\n)≈\narg\n⁡\nmin\nQ\n(\ns\n~\n|\nπ\n)\n⁡\nF\nπ\n \n\n"
      },
      "after": "96ce7acc443d8478",
      "date": 1629442674303
    },
    {
      "type": "add",
      "id": "700202c447cc511c",
      "item": {
        "type": "markdown",
        "id": "700202c447cc511c",
        "text": "This says that, to minimise a free energy functional with respect to a probability distribution, we need to find the point at which the partial derivative of the term inside the sum, with respect to this distribution, is zero.\n\nWe hope that this appendix is sufficient for readers not familiar with this style of mathematics to gain some intuition for the variational derivatives used throughout this paper. For interested readers, a more comprehensive introduction to this field can be found in (Moiseiwitsch 2013). For applications in the context of variational inference, please see (Beal 2003).\n\nRights and permissions\nOpen Access This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (http://creativecommons.org/licenses/by/4.0/), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made.\n\nReprints and Permissions\n\nAbout this article\nVerify currency and authenticity via CrossMark\nCite this article\nParr, T., Friston, K.J. Generalised free energy and active inference. Biol Cybern 113, 495–513 (2019). https://doi.org/10.1007/s00422-019-00805-w\n\nDownload citation\n\nReceived\n04 July 2017\n\nAccepted\n13 September 2019\n\nPublished\n27 September 2019\n\nIssue Date\nDecember 2019\n\nDOI\nhttps://doi.org/10.1007/s00422-019-00805-w\n\nShare this article\nAnyone you share the following link with will be able to read this content:\n\nGet shareable link\nProvided by the Springer Nature SharedIt content-sharing initiative\n\nKeywords\nBayesian\nActive inference\nFree energy\nData selection\nEpistemic value\nIntrinsic motivation\nDownload PDF"
      },
      "after": "6bf435d382412c49",
      "date": 1629442676617
    },
    {
      "type": "remove",
      "id": "6bf435d382412c49",
      "date": 1629442683869
    },
    {
      "type": "edit",
      "id": "96ce7acc443d8478",
      "item": {
        "type": "markdown",
        "id": "96ce7acc443d8478",
        "text": "# Introduction\nOver the past years, we have tried to establish active inference (a corollary of the free energy principle) as a relatively straightforward and principled explanation for action, perception and cognition. Active inference can be summarised as self-evidencing (Hohwy 2016), in the sense that action and perception can be cast as maximising Bayesian model evidence, under generative models of the world. When this maximisation uses approximate Bayesian inference, this is equivalent to minimising variational free energy (Friston et al. 2006)—a form of bounded rational behaviour that minimises a variational bound on model evidence. Recently, we have migrated the basic idea from models that generate continuous sensations (like velocity and luminance contrast) (Brown and Friston 2012) to discrete state-space models, specifically Markov decision processes (Friston et al. 2017a). These models represent the world in terms of discrete states, like I am on this page and reading this word (Friston et al. 2017d). Discrete state-space models can be inferred using belief propagation (Yedidia et al. 2005) or variational message passing (Dauwels 2007; Winn 2004) schemes that have a degree of neuronal plausibility (Friston et al. 2017c). The resulting planning as inference scheme (Attias 2003; Baker et al. 2009; Botvinick and Toussaint 2012; Verma and Rao 2006) has a pleasingly broad explanatory scope, accounting for a range of phenomena in cognitive neuroscience, active vision and motor control (see Table 1). In this paper, we revisit the role of (expected) free energy in active inference and offer an alternative, simpler and more general formulation. This formulation does not substantially change the message passing or belief updating; however, it provides an interesting perspective on planning as inference and the way that we may perceive the future.\n\n\n"
      },
      "date": 1629442691935
    },
    {
      "type": "add",
      "id": "cd09b764b05c15ae",
      "item": {
        "type": "markdown",
        "id": "cd09b764b05c15ae",
        "text": "Table 1 Applications of active inference for Markov decision processes\nFull size table\nIn current descriptions of active inference, the basic argument goes as follows: active inference is based upon the maximisation of model evidence or minimisation of variational free energy in two complementary ways. First, one can update one’s beliefs about latent or hidden states of the world to make them consistent with observed evidence—or one can actively sample the world to make observations consistent with beliefs about states of the world. The important thing here is that both action and perception are in game of minimising the same quantity, namely variational free energy. A key aspect of this formulation is that action (i.e. behaviour) is absorbed into inference, which means that agents have beliefs about what they are doing—and will do. This calls for prior beliefs about action or policies (i.e. sequences of actions). So where did these prior beliefs come from?\n\n\n"
      },
      "after": "96ce7acc443d8478",
      "date": 1629442698576
    },
    {
      "type": "add",
      "id": "c150d55fbc8a26da",
      "item": {
        "type": "markdown",
        "id": "c150d55fbc8a26da",
        "text": "The answer obtains from a reductio ad absurdum argument: if action realises prior beliefs and minimises free energy, then the only tenable prior beliefs are that action will minimise free energy. If this were not the case, we reach the following absurd conclusion. If a free energy minimising creature did not have the prior belief that it selects policies that minimise (expected) free energy, it would infer (and therefore pursue) policies that were not free energy minimising. As such, it would not be a free energy minimising creature, which is a contradiction. This leads to the prior belief that I will select policies that minimise the free energy expected under that policy. The endpoint of this argument is that action or policy selection becomes a form of Bayesian model selection, where the evidence for a particular policy becomes the free energy expected in the future. This expected free energy is a slightly unusual objective function because it scores the evidence for plausible policies based on outcomes that have yet to be observed. This means that the expected free energy becomes the variational free energy expected under (posterior predictive) beliefs about outcomes. These priors are usually informed by prior beliefs about outcomes that play the role of prior preferences or utility functions in reinforcement learning and economics.\n\n\n"
      },
      "after": "cd09b764b05c15ae",
      "date": 1629442707112
    },
    {
      "type": "add",
      "id": "32b837ccb1f4102a",
      "item": {
        "type": "markdown",
        "id": "32b837ccb1f4102a",
        "text": "In summary, beliefs about states of the world and policies are continuously updated to minimise variational free energy, where posterior beliefs about policies (that prescribe action) are based upon expected free energy (that may or may not include prior preferences over future outcomes). This is the current story and leads to interesting issues that rest on the fact that expected free energy can be decomposed into epistemic and pragmatic parts (Friston et al. 2015). This decomposition provides a principled explanation for the epistemics of planning and inference that underwrite the exploitation and exploration dilemma, novelty, salience and so on. However, there is another way of telling this story that leads to a conceptually different sort of interpretation.\n\n\n"
      },
      "after": "c150d55fbc8a26da",
      "date": 1629442721895
    },
    {
      "type": "add",
      "id": "f98ae91698dd69ab",
      "item": {
        "type": "markdown",
        "id": "f98ae91698dd69ab",
        "text": "In what follows, we show that the same Bayesian policy (model) selection obtains from minimising variational free energy when future outcomes are treated as hidden or latent states of the world. In other words, we can regard active inference as minimising a generalised free energy under generative models that entertain the consequences of (policy-dependent) hidden states of the world in the future. This simple generalisation induces posterior beliefs over future outcomes that now play the role of latent or hidden states. In this setting, the future is treated in exactly the same way as the hidden or unobservable states of the world generating observations in the past. On this view, one gets the expected free energy for free, because the variational free energy involves an expectation under posterior beliefs over future outcomes. In turn, this means that beliefs about states and policies can be simply and uniformly treated as minimising the same (generalised) free energy, without having to invoke any free energy minimising priors over policies.\n\n\n"
      },
      "after": "32b837ccb1f4102a",
      "date": 1629442729347
    },
    {
      "type": "add",
      "id": "2e9f9307840cebb5",
      "item": {
        "type": "markdown",
        "id": "2e9f9307840cebb5",
        "text": "Technically, this leads to the same form of belief updating and (Bayesian) policy selection but provides a different perspective on the free energy principle per se. This perspective says that self-evidencing and active inference both have one underlying imperative, namely to minimise generalised free energy or uncertainty. When this uncertainty is evaluated under models that generate outcomes in the future, future outcomes become hidden states that are only revealed by the passage of time. In this context, outcomes in the past become observations in standard variational inference, while outcomes in the future become posterior beliefs about latent observations that have yet to disclose themselves. In this way, the generalised free energy can be seen as comprising variational free energy contributions from the past and future.\n\nThe current paper provides the formal basis for the above arguments. In brief, we will see that both the expected and generalised free energy formulations lead to the same update equations. However, there is a subtle difference. In the expected free energy formalism, prior preferences or beliefs about outcomes are used to specify the prior over policies. In the generalised formulation, prior beliefs about outcomes in the future inform posterior beliefs about the hidden states that cause them. Because of the implicit forward and backward message passing in the belief propagation scheme obtained at the free energy minimum (Yedidia et al. 2005), these prior beliefs or preferences act to distort expected trajectories (into the future) towards preferences in an optimistic way (Sharot et al. 2012). Intuitively, the expected free energy contribution to generalised free energy evaluates the (complexity) cost of this distortion, thereby favouring policies that lead naturally to preferred outcomes—without violating beliefs about state transitions and the (likelihood) mapping between states and outcomes. The implicit coupling between beliefs about the future and current actions means that, in one sense, the future can cause the past.\n\n\n"
      },
      "after": "f98ae91698dd69ab",
      "date": 1629442737798
    },
    {
      "type": "add",
      "id": "9fd630fb7bf645eb",
      "item": {
        "type": "markdown",
        "id": "9fd630fb7bf645eb",
        "text": "Framing probabilistic reasoning in terms of inferential message passing formalises several prominent concepts in the study of human decision making. The idea that prior beliefs distort beliefs about future and that this optimism about the future propagates backwards in time to influence behaviour in an adaptive way (McKay and Dennett 2010; Sharot 2011), is highly consistent with an influence of beliefs about the future over beliefs about the present. Simplistically, the idea behind these accounts is that adaptive behaviour relies upon the (possibly false) belief that future events will accord with our preferences. It is only by believing that we will realise these goals that we act in a manner consistent with their realisation. Intuitively, without the belief that we will end up eating dinner, there would be no reason to shop for ingredients. The passing of messages from past to future resonates with the notion that working memory is vital for predicting the future and planning actions accordingly (Gilhooly 2005; Hikosaka et al. 2000), and underwrites research on episodic future thinking and counterfactual reasoning (Schacter et al. 2015). Appealing to bidirectional inferential message passing has enabled us to reproduce a range of behavioural and electrophysiological phenomena through simulation (summarised in Table 1).\n\n\n"
      },
      "after": "2e9f9307840cebb5",
      "date": 1629442744973
    },
    {
      "type": "add",
      "id": "e71bd0039aea4fc0",
      "item": {
        "type": "markdown",
        "id": "e71bd0039aea4fc0",
        "text": "This paper comprises three sections. In the first, we outline the approach we have used to date (i.e. minimising the variational free energy under prior beliefs that policies with a low expected free energy are more probable). In the second, we introduce a generalisation of the variational free energy that incorporates beliefs about future outcomes. The third section compares these two approaches conceptually and through illustrative simulations.\n\n\n"
      },
      "after": "9fd630fb7bf645eb",
      "date": 1629442755041
    },
    {
      "type": "add",
      "id": "ed028bcbfafd6df9",
      "item": {
        "type": "markdown",
        "id": "ed028bcbfafd6df9",
        "text": "Active inference and variational free energy\n"
      },
      "after": "e71bd0039aea4fc0",
      "date": 1629442761369
    },
    {
      "type": "add",
      "id": "598af739b3625934",
      "item": {
        "type": "markdown",
        "id": "598af739b3625934",
        "text": "The free energy principle is motivated by the defining characteristic of living creatures, namely that they persist in the face of a changing world. In other words, their states occupy a small proportion of all possible states with a high probability. From the perspective of statistical physics, this means that they show a form of self-organised, non-equilibrium steady-state that maintains a low entropy probability distribution over their states. In information theory, self-information or surprise (a.k.a. negative log model evidence) averaged over time is [[entropy]]. More generally, entropy is defined in terms of an ensemble average. However, under that assumption that a system has achieved its (non-equilibrium) steady state, the ensemble and time average are equivalent (under mild weakly mixing assumptions). This means, at any given time, all biological systems are compelled to minimise their surprise. While this may seem like a very bold statement, we do not intend to trivialise the many constraints that dictate behaviour. The point here is that when all these constraints are written into a generative model as prior beliefs, they all contribute to the same cost function: surprise. This reframes the problem of expressing the constraints biological systems must satisfy as a problem of specifying the right set of priors. Although the computation of surprise is often intractable, an approximation is simple to calculate. This is variational free energy (Beal 2003; Dayan et al. 1995; Friston 2003) which depends upon specifying a generative model of how data are caused. This generative model comprises a series of conditional probability distributions. For a Markov decision process, it assumes a series of states (s) that evolve through time. At each time step, the probability of transitioning from one state to the next depends upon a policy (π). Neither states nor policies are directly accessible to the creature in question. However, each state probabilistically generates an observable outcome (o). As Jensen’s inequality demonstrates, free energy is an upper bound on surprise.\n"
      },
      "after": "ed028bcbfafd6df9",
      "date": 1629442856007
    },
    {
      "type": "add",
      "id": "1c2dcb9ffa6f2d72",
      "item": {
        "type": "markdown",
        "id": "1c2dcb9ffa6f2d72",
        "text": "\n𝐹⏟Freeenergy=−𝐸𝑄(𝑠̃,𝜋)[ln𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]≥−ln𝐸𝑄(𝑠̃,𝜋)[𝑃(𝑜̃,𝑠̃,𝜋)𝑄(𝑠̃,𝜋)]Jensen′sinequality=−ln𝑃(𝑜̃)Surprise\nF\n⏟\nFree\nenergy\n=\n−\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nln\n⁡\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n≥\n−\nln\n⁡\nE\nQ\n(\ns\n~\n,\nπ\n)\n[\nP\n(\no\n~\n,\ns\n~\n,\nπ\n)\nQ\n(\ns\n~\n,\nπ\n)\n]\n⏟\nJensen\n′\ns\ninequality\n=\n−\nln\n⁡\nP\n(\no\n~\n)\n⏟\n\n"
      },
      "after": "598af739b3625934",
      "date": 1629442872621
    },
    {
      "type": "add",
      "id": "77d3395122dc0e6a",
      "item": {
        "type": "markdown",
        "id": "77d3395122dc0e6a",
        "text": "Surprise\nIn the equation above,  indicates a probability distribution over outcomes 𝑜̃=(𝑜1,𝑜2,…,𝑜𝑇)\no\n~\n=\n(\no\n1\n,\no\n2\n,\n…\n,\no\nT\n)\n that are generated by hidden states of the world 𝑠̃=(𝑠1,𝑠2,…,𝑠𝑇)\ns\n~\n=\n(\ns\n1\n,\ns\n2\n,\n…\n,\ns\nT\n)\n \n"
      },
      "after": "1c2dcb9ffa6f2d72",
      "date": 1629442882262
    },
    {
      "type": "add",
      "id": "bb9d19da533d61c7",
      "item": {
        "type": "markdown",
        "id": "bb9d19da533d61c7",
        "text": "and policies, which define the generative model. The generative model is thus expressed as a joint probability distribution over outcomes (i.e. consequences) and their causes (i.e. hidden states of the world and policies available to the agent). Marginalising (i.e. summing or integrating) over the states and policies gives the evidence (a.k.a., marginal likelihood). The log of this marginal likelihood is negative surprise.  is a probability distribution over unobservable (hidden) states and policies—that becomes an approximate posterior distribution as free energy is minimised. The minimisation of free energy over time ensures entropy does not increase, thereby enabling biological systems to resist the second law of thermodynamics and their implicit dissipation or decay.\n\n\n"
      },
      "after": "77d3395122dc0e6a",
      "date": 1629442895939
    },
    {
      "type": "add",
      "id": "d2c264a7db61d407",
      "item": {
        "type": "markdown",
        "id": "d2c264a7db61d407",
        "text": "Note that the generative model is not a model of the biological system itself, but an implicit model of how the environment generates its sensory data. The dynamics of inference and behaviour that we are interested in here emerge from minimising free energy under an appropriate choice of generative model. For readers with a physics background, and analogy would be that the free energy plays the role of a Lagrangian whose ‘potential energy’ component is given by the generative model. Just as a Lagrangian is used to recover the equations of motion for a physical system, we use the free energy to recover the belief updates that determine a biological system’s behaviour.\n\n\n"
      },
      "after": "bb9d19da533d61c7",
      "date": 1629442905261
    },
    {
      "type": "add",
      "id": "c3da15f55be05fa0",
      "item": {
        "type": "markdown",
        "id": "c3da15f55be05fa0",
        "text": "In the following, we begin by describing the form of the generative model we have used to date. We will then address the form of the approximate posterior distribution. To make inference tractable, this generally involves a mean-field approximation that factorises the approximate posterior distribution into independent factors or marginal distributions.\n\n\n"
      },
      "after": "d2c264a7db61d407",
      "date": 1629442910612
    },
    {
      "type": "add",
      "id": "03d60d686c9a2e6b",
      "item": {
        "type": "markdown",
        "id": "03d60d686c9a2e6b",
        "text": "The generative models used in this paper are subtly different for each free energy functional, but the variables themselves are the same. These are policies (𝜋\nπ\n) and state trajectories (𝑠̃\ns\n~\n), all of which are latent (unknown random) variables that have to be inferred. States evolve as a discrete Markov chain, where the transition probabilities are functions of the policy. Likelihood distributions probabilistically map hidden states to observations (𝑜̃\no\n~\n). Figure  (left) shows these dependencies as a graphical Bayesian network. This type of generative model has been used extensively in simulations of active inference (FitzGerald et al. , ; Friston et al. , , , ; Schwartenbeck et al. ), see Table .\n\n\n"
      },
      "after": "c3da15f55be05fa0",
      "date": 1629442919931
    },
    {
      "type": "add",
      "id": "627fb909b9146d09",
      "item": {
        "type": "markdown",
        "id": "627fb909b9146d09",
        "text": "Fig. 1\nfigure1\nMarkov decision process. This shows the basic structure of the discrete state-space generative model used in this paper, assuming the current time is t = τ. The factor graph on the left is the generative model we have used in previous work. Importantly, the prior belief about observations only enters this graph through the expected free energy, 𝐺\nG\n (see main text), which enters the prior over policies. Policies index alternative trajectories, or sequences, of actions. In this sense, they are not time dependent, as each policy determines a sequence of actions for all time-points. Conversely, the actions (u) are time dependent. U is an array that specifies an action for each time step (rows) and each policy (columns). The selected action therefore depends upon the most likely policy and the action that policy implies for that time step. Action selection is technically not part of the generative model, as it relies upon the posterior distribution Q (please see main text for details), obtained by inverting the model. This is an important, aspect of active inference, as it underwrites the way in which the system performing inference may change the process generating its observed data. The grey region of this graph indicates that the observation at the next time step is not yet available, so cannot yet be incorporated into the graph. The right factor graph is the new version of the generative model considered in this paper. This generative model does not require an expected free energy, and the prior over outcomes enters the model directly as a constraint on outcomes. This also shows a time dependence, as future outcomes are treated as unobserved latent variables (indicated by an unfilled circle). Observed variables are shown as filled circles in both graphs and unobserved variables as unfilled circles. Factors of the generative model (i.e. conditional probability distributions and prior probabilities) are shown as squares. These squares are connected to those circles containing variables that participate in the same factor. Please refer to the main text and Table 2 for a description of the variables. In the panel on the right, the definitions are given for each of the factors in blue squares. Here, Cat refers to the categorical distribution (color figure online)\n\n"
      },
      "after": "03d60d686c9a2e6b",
      "date": 1629442929334
    },
    {
      "type": "add",
      "id": "10bfb4c4838863e1",
      "item": {
        "type": "markdown",
        "id": "10bfb4c4838863e1",
        "text": "Full size image\n\n"
      },
      "after": "627fb909b9146d09",
      "date": 1629442931442
    },
    {
      "type": "add",
      "id": "82ef4608454a729c",
      "item": {
        "type": "markdown",
        "id": "82ef4608454a729c",
        "text": "The role of the generative model is simply to define the free energy functional which, as we will see in Sects. –, gives rise to the belief update rules that we will employ for our simulations. However, it is helpful to imagine how we might generate data from such a model. We outline this process with the model on the left of Fig.  in mind. We could start at the first time step and sample a state from the categorical prior over initial states. The parameters of this prior () are simply a vector of probabilities for each alternative state. From this, we can now sample from the likelihood. This is formulated as a matrix (), whose columns correspond to a state and whose rows are the alternative outcomes that may be generated. To generate an outcome, we would select the column of this matrix corresponding to the state we sampled and sample an outcome from this column-vector of probabilities. It is this outcome that would be available to a synthetic creature.\n"
      },
      "after": "10bfb4c4838863e1",
      "date": 1629442968388
    },
    {
      "type": "add",
      "id": "98c45f5a21630bff",
      "item": {
        "type": "markdown",
        "id": "98c45f5a21630bff",
        "text": "\nTaking a discrete time step into the future, we can sample a new state from the column of a transition matrix () associated with the state at the previous time. Crucially, the transition probabilities are conditioned upon the selected action. This means we have a separate -matrix for each action. Action selection depends upon the policy, with each policy and time point associated with an action. For the model on the left of Fig. , this means we calculate the expected free energy () for each policy, which depends upon a vector of prior probabilities for outcomes under these policies (). Combining these with a prior bias term ()—as set out in more detail in Sect. —we can construct a prior over policies. Sampling from this and selecting the action that corresponds to this policy, at this time, specify the -matrix from which to sample the state for the current time step. We could then sample the outcome for this time from the relevant column of the -matrix. This process can be repeated for a series of discrete time steps, generating a new outcome for each time. A similar approach could be taken to generate data from the model on the right of Fig. . However, note that the likelihood here comprises both  and , and the policy prior only includes  (i.e. the expected free energy does not explicitly feature in this model). The procedure outlined above provides an intuition into the beliefs a creature has about how its sensory data are generated by acting on hidden states in the environment.\n\n\n"
      },
      "after": "82ef4608454a729c",
      "date": 1629442980015
    },
    {
      "type": "add",
      "id": "907cc2b9de05b71b",
      "item": {
        "type": "markdown",
        "id": "907cc2b9de05b71b",
        "text": "It is worth noting that the free energy is a  of the distributions in the generative model and of the approximate posterior beliefs, but a  of observations. Continuing with this free energy, we now consider the mean-field approximation in current implementations of active inference, and its consequences for the variational free energy. In the next few sections, we unpack the variational free energy, and its role in active inference based on Markov decision processes. The argument that follows is a little involved, but we summarise the key steps here, such that the agenda of each of the following sections is clear. In Sect. , we specify the form of the variational distribution we employ, and the free energy that results from this. In Sect. , we unpack the terms in the free energy as they pertain to the generative model. This depends upon having a prior belief about policies. Section  attempts to identify this prior, through finding the optimal posterior and extrapolating backwards in time. This highlights a shortcoming of this approach that is resolved in Sect. . In addition to providing a more appropriate prior for policy selection, Sect.  sets out the role of free energy in simulating behaviour. In brief, this involves finding the variational distribution over policies that minimises free energy. As free energy is a function of sensory observations, this means we need to update these distributions following each new observation. Section  follows the same approach to find the free energy minima for beliefs about states, giving the fixed points to which these distributions must be updated following each new observation.\n\n\n"
      },
      "after": "98c45f5a21630bff",
      "date": 1629442987991
    },
    {
      "type": "add",
      "id": "52862b5905754e0a",
      "item": {
        "type": "markdown",
        "id": "52862b5905754e0a",
        "text": "Definition of the mean-field variational free energy\nTo define the variational free energy for the above generative model, we first need to specify the form of the approximate posterior distribution, 𝑄\nQ\n. We do this via a mean-field approximation that treats the (policy dependent) state at each time step as approximately independent of the state at any other time step. We treat the distribution over the policy as a separate factor, which implies a set of (policy) models, 𝜋\nπ\n, over hidden variables 𝑠𝜏\ns\nτ\n:\n\n𝑄(𝑠̃,𝜋)=𝑄(𝜋)∏𝜏𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\n~\n,\nπ\n)\n=\nQ\n(\nπ\n)\n∏\nτ\nQ\n(\ns\nτ\n|\nπ\n)\n\n"
      },
      "after": "907cc2b9de05b71b",
      "date": 1629442995916
    },
    {
      "type": "add",
      "id": "22219767640fc90c",
      "item": {
        "type": "markdown",
        "id": "22219767640fc90c",
        "text": "Mean-field approximations originated in statistical physics, where they can be used to approximate Helmholtz free energy through appealing to an average with respect to a ‘reference’ Hamiltonian. This reference can be simply defined for a system with non-interacting components (or degrees of freedom). In virtue of the assumption that the system’s degrees of freedom do not interact, their Hamiltonian (scaled negative log probability) may be expressed as a sum of contributions from each component. Exponentiating this sum, the probability density can be expressed as a product of marginal probabilities for each degree of freedom. The same idea has been employed extensively in statistical inference and machine learning, where a mean-field approximation refers to the use of a variational distribution comprising a product of marginals (Winn and Bishop ; Yedidia et al. ). The ‘mean field’ is the expected value of each (log) factor of the generative model (), which include the interactions, under the fully factorised distribution (). The advantage to using a mean-field approximation is the computational tractability that comes from being able to separately optimise each marginal distribution. We can now substitute this factorised distribution into our definition for the variational free energy above:\n\n\n"
      },
      "after": "52862b5905754e0a",
      "date": 1629443023532
    },
    {
      "type": "add",
      "id": "2708a6a22f254bdb",
      "item": {
        "type": "markdown",
        "id": "2708a6a22f254bdb",
        "text": "𝐹=𝐸𝑄(𝜋)[𝐹𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝐹𝜋=−𝐸𝑄(𝑠̃|𝜋)[ln𝑃(𝑜̃,𝑠̃|𝜋)−∑𝜏ln𝑄(𝑠𝜏|𝜋)]\nF=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=−\nE\nQ\n(\ns\n~\n|\nπ\n)\n[ln⁡P(\no\n~\n,\ns\n~\n|\nπ)−\n∑\nτ\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n] \n\n"
      },
      "after": "22219767640fc90c",
      "date": 1629443031145
    },
    {
      "type": "add",
      "id": "6445f86ed8ef1b23",
      "item": {
        "type": "markdown",
        "id": "6445f86ed8ef1b23",
        "text": "In this form, the variational free energy is expressed in terms of policy-dependent terms (second equality) that bound the (negative log) evidence for each policy and a complexity cost or KL divergenceFootnote 1 () that scores the departure of the posterior beliefs over policies from the corresponding prior beliefs.\n\n\n"
      },
      "after": "2708a6a22f254bdb",
      "date": 1629443034684
    },
    {
      "type": "add",
      "id": "456da10290e506be",
      "item": {
        "type": "markdown",
        "id": "456da10290e506be",
        "text": "Past and future\n\n"
      },
      "after": "6445f86ed8ef1b23",
      "date": 1629443037633
    },
    {
      "type": "add",
      "id": "802de4abd7cdf2dc",
      "item": {
        "type": "markdown",
        "id": "802de4abd7cdf2dc",
        "text": "There is an important difference in how past and future outcomes are treated by the variational free energy. Note that—as a function of outcomes—the components of the free energy that depend on outcomes can only be evaluated for the past and present. Hidden states, on the other hand, enter the expression as  about states. In other words, the free energy is a functional of distributions over states, rather than a function, as in the case of outcomes. This means that free energy evaluation takes account of future states. We can express this explicitly by writing the variational free energy, at time , as a sum over all time steps, factorising the generative distribution according to the conditional independencies expressed in Fig. :\n"
      },
      "after": "456da10290e506be",
      "date": 1629443070970
    },
    {
      "type": "add",
      "id": "f210cc63390352df",
      "item": {
        "type": "markdown",
        "id": "f210cc63390352df",
        "text": "\n𝐹𝜋=∑𝜏𝐹𝜋𝜏𝐹𝜋𝜏=−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[[𝜏≤𝑡]⋅ln𝑃(𝑜𝜏|𝑠𝜏)+ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)−ln𝑄(𝑠𝜏|𝜋)]\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\n[\nτ\n≤\nt\n]\n⋅\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n+\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n]\n \n\n"
      },
      "after": "802de4abd7cdf2dc",
      "date": 1629443087387
    },
    {
      "type": "add",
      "id": "19dc9bdb60f290b2",
      "item": {
        "type": "markdown",
        "id": "19dc9bdb60f290b2",
        "text": "In the above, the Iverson (square) brackets return 1 if the expression is true, and 0 otherwise. It is this condition that differentiates contributions from the past from the future. This equation is obtained in a straightforward way by factorising the generative model (joint distribution) in the second line of Eq. , in line with the generative model depicted in Fig. . Because the generative model does not include future observations as random variables (given that these data have yet to be collected), there are no accompanying likelihood factors. This reflects the fact that the only data that contribute to the free energy are those we currently have access to. Given the dependence of the right-hand side on the current time () the free energy should, strictly speaking, be written as a function of  and . As we are interested here in online inference, we will assume an implicit conditioning upon  for all free energies throughout this paper. The Iverson brackets above allow us to decompose the sum into past and future components:\n\n\n"
      },
      "after": "f210cc63390352df",
      "date": 1629443124724
    },
    {
      "type": "add",
      "id": "b0b0338102c8a832",
      "item": {
        "type": "markdown",
        "id": "b0b0338102c8a832",
        "text": "𝐹𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷KL[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nKL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\n\n"
      },
      "after": "19dc9bdb60f290b2",
      "date": 1629443138939
    },
    {
      "type": "add",
      "id": "ab62a73c5a358c5b",
      "item": {
        "type": "markdown",
        "id": "ab62a73c5a358c5b",
        "text": "Complexity\n(5)\nIn this decomposition, the contribution of beliefs about future states reduces to a complexity cost. This is the KL divergence between approximate posterior beliefs about states in the future and prior beliefs. The latter are based upon the (policy-specific) transition probabilities in the generative model.\n\n\n"
      },
      "after": "b0b0338102c8a832",
      "date": 1629443152397
    },
    {
      "type": "add",
      "id": "6df0cf52eb73a28e",
      "item": {
        "type": "markdown",
        "id": "6df0cf52eb73a28e",
        "text": "Policy posteriors and priors\n\n"
      },
      "after": "ab62a73c5a358c5b",
      "date": 1629443155269
    },
    {
      "type": "add",
      "id": "c7a03df60343a857",
      "item": {
        "type": "markdown",
        "id": "c7a03df60343a857",
        "text": "Using the full variational free energy (over all policies) from Eq. 3, we can evaluate posterior beliefs about policies. The variational derivative of the free energy with respect to these beliefs is (where we omit constants, and where 𝜎(⋅)\nσ\n(\n⋅\n)\n is a softmax function—i.e. a normalised exponential function):\n\n𝛿𝐹𝛿𝑄(𝜋)=𝐹𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(6)\n\n"
      },
      "after": "6df0cf52eb73a28e",
      "date": 1629443169561
    },
    {
      "type": "add",
      "id": "ee782f82ba593e82",
      "item": {
        "type": "markdown",
        "id": "ee782f82ba593e82",
        "text": "The second line derives from the first through rearranging, exponentiating both sides of the equation, and normalising to ensure the approximate posterior sums to one. This, together with Eq. 5, implies the belief prior to any observations (i.e. at 𝑡=0\nt\n=\n0\n), which is given by:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−∑𝜏𝐸𝑄(𝑠𝜏−1|𝜋)[𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]])\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\n∑\nτ\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n)\n(7)\n\n"
      },
      "after": "c7a03df60343a857",
      "date": 1629443182611
    },
    {
      "type": "add",
      "id": "002213d99d9ee4c9",
      "item": {
        "type": "markdown",
        "id": "002213d99d9ee4c9",
        "text": "This is an unsatisfying result, in which it fails to accommodate our prior knowledge that outcomes will become available in the future. In other words, the posterior at each time step is calculated under a different model (see Fig. 2).\n\nFig. 2\nfigure2\nTemporal progression of Markov decision process. The upper graphs shows the structure of the generative model implied using the variational free energy, equipped with a prior that the expected free energy will be minimised by policy selection. Observations are added to the model as they occur. The lower graphs show the structure of the generative model that explicitly represents future outcomes, and minimises a generalised free energy through policy selection. As observations are made, the outcome variables collapse to delta functions. These graphics are intended to highlight two alternative conceptions of a generative model employed in an online setting. The key problem here is how to deal with missing (future) outcomes. These could be omitted until such a time as they become available. Alternatively, they could be treated as hidden variables about which we can hold beliefs. Please note that this graphic illustrates different ways of formulating the generative model used to calculate belief updates. It does not show belief updates, behaviour or any other free energy minimising process. These will be detailed in subsequent sections and figures. However, the reason for making this distinction is important for how we formulate the free energy. The key distinction between the free energies compared in this paper is which of the two perspectives on future outcomes we choose to adopt\n\n"
      },
      "after": "ee782f82ba593e82",
      "date": 1629443200711
    },
    {
      "type": "add",
      "id": "80e513b184b73f88",
      "item": {
        "type": "markdown",
        "id": "80e513b184b73f88",
        "text": "Full size image\n\n"
      },
      "after": "002213d99d9ee4c9",
      "date": 1629443203543
    },
    {
      "type": "add",
      "id": "0209de90b95947e9",
      "item": {
        "type": "markdown",
        "id": "0209de90b95947e9",
        "text": "Expected free energy\n\n"
      },
      "after": "80e513b184b73f88",
      "date": 1629443206554
    },
    {
      "type": "add",
      "id": "73f93561e9983ac9",
      "item": {
        "type": "markdown",
        "id": "73f93561e9983ac9",
        "text": "To finesse this shortcoming, we can assume agents select the policy that they expect will lead to the lowest free energy (summed over time). This is motivated by the reductio ad absurdum in the introduction and is expressed mathematically as:\n\n𝑄𝑜(𝜋)≜𝜎(ln𝑃(𝜋)−𝐺𝜋)\nQ\no\n(\nπ\n)\n≜\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\nπ\n)\n(8)\nThis replaces the expression for 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n given in Sect. 2.3. (We retain the notation Qo(π) for the prior here to distinguish this from the fixed form prior P(π), which does not depend on the beliefs about states.) Gπ is the expected free energy, conditioned on a policy. It is defined as:\n\n𝐺𝜋=∑𝜏>𝑡𝐺𝜋𝜏𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏)−ln𝑄(𝑠𝜏|𝜋)]\nG\nπ\n=\n∑\nτ\n>\nt\nG\nπ\nτ\nG\nπ\nτ\n=−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n,\ns\nτ\n)−ln⁡Q(\ns\nτ\n|\nπ)] \n(9)\n\n"
      },
      "after": "0209de90b95947e9",
      "date": 1629443218682
    },
    {
      "type": "add",
      "id": "521f9c9716859ace",
      "item": {
        "type": "markdown",
        "id": "521f9c9716859ace",
        "text": "There is an apparent problem with this quantity: The first term within the expectation is a function of outcomes that have yet to be observed. To take this into account, we have defined an (approximate) joint distribution over states and outcomes: 𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)=𝑃(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nP\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, and take the expectation with respect to this. This means that we can express a (posterior predictive) belief about the observations in the future based on (posterior predictive) beliefs about hidden states. One can obtain a useful form of the expected free energy by rearranging the above: if we factorise the generative model, we obtain:\n\n𝐺𝜋𝜏=−𝐸𝑄̃(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑠𝜏|𝑜𝜏)−ln𝑄(𝑠𝜏|𝜋)Epistemicvalue+ln𝑃(𝑜𝜏)⏟Extrinsicvalue]\nG\nπ\nτ\n=\n−\nE\nQ\n~\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\ns\nτ\n|\no\nτ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEpistemic\nvalue\n+\nln\n⁡\nP\n(\no\nτ\n)\n⏟\nExtrinsic\nvalue\n]\n(10)\n\n"
      },
      "after": "73f93561e9983ac9",
      "date": 1629443242415
    },
    {
      "type": "add",
      "id": "bb14057a7a2a4013",
      "item": {
        "type": "markdown",
        "id": "bb14057a7a2a4013",
        "text": "This form shows that policies that have a low expected free energy are those that resolve uncertainty, and that fulfil prior preferences about outcomes. It is the first of these terms that endorses the metaphor of the brain as a scientist, performing experiments (i.e. actions with sensory consequences) to verify or refute hypotheses about the world (Friston et al. 2012b; Gregory 1980). \n"
      },
      "after": "521f9c9716859ace",
      "date": 1629443271496
    },
    {
      "type": "add",
      "id": "8045d5039617fb28",
      "item": {
        "type": "markdown",
        "id": "8045d5039617fb28",
        "text": "The second term speaks to the notion of a ‘crooked scientist’ (Bruineberg et al. 2016), who designs experiments to confirm prior beliefs, i.e. preferred outcomes. This preference is the same as the evidence (a.k.a., marginal likelihood) associated with a given model. This means policies are selected such that the most probable outcomes under that policy match the most probable outcomes under prior preferences (defined in terms of a marginal likelihood).\n\nTreating 𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\nτ\n|\nπ\n)\n as a prior, and 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n as a posterior, we can directly substitute these into Bayes’ rule, which says that their ratio is equal to the ratio of the corresponding likelihood (𝑄(𝑜𝜏|𝑠𝜏,𝜋)≈𝑃(𝑜𝜏|𝑠𝜏)\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\n≈\nP\n(\no\nτ\n|\ns\nτ\n)\n) and marginal likelihood (𝑄(𝑜𝜏|𝜋)\nQ\n(\no\nτ\n|\nπ\n)\n):\n\n𝑃(𝑠𝜏|𝑜𝜏)𝑄(𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏,𝜋)𝑄(𝑜𝜏|𝜋)\nP\n(\ns\nτ\n|\no\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n(11)\nDue to the symmetry of Bayes’ rule, another perspective on this is that 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n is a likelihood that generates states from observations. This view treats the right-hand side of the above as the ratio between a posterior and a prior. Using this relationship, we can express expected free energy in terms of risk and ambiguity:\n\n𝐺𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[ln𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\nIn this equation, H is the Shannon entropy (i.e. negative expected log probability). This means that the prior belief about outcomes enters the generative model through the KL divergence between outcomes expected under any policy and prior preferences. This form also illustrates the correspondence between the expected free energy and the quantities ‘risk’ and ‘ambiguity’ from behavioural economics (Ellsberg 1961; Ghirardato and Marinacci 2002). Risk quantifies the expected cost of a policy as a divergence from preferred outcomes and is sometimes referred to as Bayesian risk or regret (Huggins and Tenenbaum 2015), which underlies KL control and related Bayesian control rules (Kappen et al. 2012; Ortega and Braun 2010; Todorov 2008) and special cases that include Thompson sampling (Lloyd and Leslie 2013; Strens 2000). Ambiguous states are those that have an uncertain mapping to observations. The greater these quantities, the less likely it is that the associated policy will be chosen.\n\nHaving identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\nMany of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\n"
      },
      "after": "bb14057a7a2a4013",
      "date": 1629443282339
    },
    {
      "type": "edit",
      "id": "bb14057a7a2a4013",
      "item": {
        "type": "markdown",
        "id": "bb14057a7a2a4013",
        "text": "This form shows that policies that have a low expected free energy are those that resolve uncertainty, and that fulfil prior preferences about outcomes. It is the first of these terms that endorses the [[metaphor of the brain as a scientist]], performing experiments (i.e. actions with sensory consequences) to verify or refute hypotheses about the world (Friston et al. 2012b; Gregory 1980). \n"
      },
      "date": 1629443303365
    },
    {
      "type": "edit",
      "id": "8045d5039617fb28",
      "item": {
        "type": "markdown",
        "id": "8045d5039617fb28",
        "text": "The second term speaks to the notion of a ‘crooked scientist’ (Bruineberg et al. 2016), who designs experiments to confirm prior beliefs, i.e. preferred outcomes. This preference is the same as the evidence (a.k.a., marginal likelihood) associated with a given model. This means policies are selected such that the most probable outcomes under that policy match the most probable outcomes under prior preferences (defined in terms of a marginal likelihood).\n\nTreating 𝑄(𝑠𝜏|𝜋)\nQ\n(\ns\nτ\n|\nπ\n)\n as a prior, and 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n as a posterior, we can directly substitute these into Bayes’ rule, which says that their ratio is equal to the ratio of the corresponding likelihood (𝑄(𝑜𝜏|𝑠𝜏,𝜋)≈𝑃(𝑜𝜏|𝑠𝜏)\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\n≈\nP\n(\no\nτ\n|\ns\nτ\n)\n) and marginal likelihood (𝑄(𝑜𝜏|𝜋)\nQ\n(\no\nτ\n|\nπ\n)\n):\n\n𝑃(𝑠𝜏|𝑜𝜏)𝑄(𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏,𝜋)𝑄(𝑜𝜏|𝜋)\nP\n(\ns\nτ\n|\no\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n,\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n(11)\nDue to the symmetry of Bayes’ rule, another perspective on this is that 𝑃(𝑠𝜏|𝑜𝜏)\nP\n(\ns\nτ\n|\no\nτ\n)\n is a likelihood that generates states from observations. This view treats the right-hand side of the above as the ratio between a posterior and a prior. Using this relationship, we can express expected free energy in terms of risk and ambiguity:\n\n𝐺𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[ln𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n\n"
      },
      "date": 1637902443986
    },
    {
      "type": "add",
      "id": "0e5836fa9286609f",
      "item": {
        "type": "markdown",
        "id": "0e5836fa9286609f",
        "text": "Ambiguity\nIn this equation, H is the Shannon entropy (i.e. negative expected log probability). This means that the prior belief about outcomes enters the generative model through the KL divergence between outcomes expected under any policy and prior preferences. This form also illustrates the correspondence between the expected free energy and the quantities ‘risk’ and ‘ambiguity’ from behavioural economics (Ellsberg 1961; Ghirardato and Marinacci 2002). Risk quantifies the expected cost of a policy as a divergence from preferred outcomes and is sometimes referred to as Bayesian risk or regret (Huggins and Tenenbaum 2015), which underlies KL control and related Bayesian control rules (Kappen et al. 2012; Ortega and Braun 2010; Todorov 2008) and special cases that include Thompson sampling (Lloyd and Leslie 2013; Strens 2000). Ambiguous states are those that have an uncertain mapping to observations. The greater these quantities, the less likely it is that the associated policy will be chosen.\n\n\n"
      },
      "after": "8045d5039617fb28",
      "date": 1637902455153
    },
    {
      "type": "add",
      "id": "0c0ab125fd97aa95",
      "item": {
        "type": "markdown",
        "id": "0c0ab125fd97aa95",
        "text": "Having identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\nMany of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\n"
      },
      "after": "0e5836fa9286609f",
      "date": 1637902463568
    },
    {
      "type": "edit",
      "id": "0c0ab125fd97aa95",
      "item": {
        "type": "markdown",
        "id": "0c0ab125fd97aa95",
        "text": "Having identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\n\n"
      },
      "date": 1637902529166
    },
    {
      "type": "add",
      "id": "5e974c66f595b242",
      "item": {
        "type": "markdown",
        "id": "5e974c66f595b242",
        "text": "Many of these schemes rely upon exact, as opposed to approximate, Bayesian inference. The former can be seen as a special case of the latter, in which the distributions Q are equal to the true posteriors. In some cases, this will violate the mean-field assumption used here, and such cases will factorise in a slightly more complicated way. However, it is still possible to represent the terms above in exactly the same way, as long as we introduce an additional corrective (mutual information) term to account for pairwise interactions in the marginal posterior distributions. This is the approach taken in the Bethe free energy that underwrites exact inference procedures such as belief propagation (Pearl 2014; Yedidia et al. 2005).\n\nAll of these quantities are emergent properties of a system that minimises its expected free energy. In the schemes mentioned above, the quantities were pragmatically selected to sample data efficiently. Here, they can be seen as special cases of the free energy functional used to define the active inference or sensing that underwrites perception (Friston et al. 2012b; Gregory 1980).\n\nAppendix B: Variational derivative of expected marginal\nBelow are the steps taken to obtain the variational derivative of an expected marginal. This is needed for the hidden state update equations under the generalised free energy. For those unfamiliar with variational calculus, “Appendix C” provides a brief introduction.\n\n𝛿𝛿𝑄(𝑠𝜏|𝜋)𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝛿𝛿𝑄(𝑠𝜏|𝜋)ln𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑜𝜏,𝑠′𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+∑𝑜𝜏[∑𝑠′𝜏𝑄(𝑜𝜏|𝑠′𝜏)𝑄(𝑠′𝜏|𝜋)∑𝑠𝜏𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝑠𝜏)]=𝐸𝑄(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)]+1\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t\t=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nδ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\nln\n⁡\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\nE\nQ\n(\no\nτ\n,\ns\nτ\n′\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+\n∑\no\nτ\n[\n∑\ns\nτ\n′\nQ\n(\no\nτ\n|\ns\nτ\n′\n)\nQ\n(\ns\nτ\n′\n|\nπ\n)\n∑\ns\nτ\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\ns\nτ\n)\n]\n=\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]+1 \nIn the update equations, we can omit the constant 1.\n\nAppendix C: A primer on variational calculus\nThis appendix offers a brief introduction to variational calculus, with a focus on the notion of a functional (or variational) derivative. Variational calculus deals with the problem of finding a function (f) that extremises a functional (a function of a function). Formally, this means we try to find:\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]𝑆[𝑓(𝑥)]≜∑𝑥(𝑓(𝑥),𝑥)\nf\n~\n(x)=\narg\n⁡\nmin\nf\n⁡S[f(x)]\t\tS[f(x)]≜\n∑\nx\nL\n(\nf\n(\nx\n)\n,\nx\n)\n \nWe can solve this problem by parameterising our function in terms of a second (arbitrary) function (g) and a scalar (u):\n\n𝑓(𝑥,𝑢)∂∂𝑢𝑆[𝑓(𝑥,𝑢)]≜𝑓̃(𝑥)+𝑢𝑔(𝑥)=∑𝑥∂∂𝑢(𝑓(𝑥,𝑢),𝑥)=∑𝑥∂𝑓(𝑥,𝑢)∂𝑢∂∂𝑓(𝑓(𝑥,𝑢),𝑥)=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥,𝑢),𝑥)\nf(x,u)\t≜\nf\n~\n(x)+ug(x)\t\n∂\n∂\nu\nS[f(x,u)]\t=\n∑\nx\n∂\n∂\nu\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\n∂\nf\n(\nx\n,\nu\n)\n∂\nu\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n,\nu\n)\n,\nx\n)\n \nWhen u is zero, 𝑓=𝑓̃\nf\n=\nf\n~\n and the functional is minimised. This implies:\n\n∂∂𝑢𝑆[𝑓(𝑥,𝑢)]∣∣∣𝑢=0=0=∑𝑥𝑔(𝑥)∂∂𝑓(𝑓(𝑥),𝑥)\n∂\n∂\nu\nS\n[\nf\n(\nx\n,\nu\n)\n]\n|\nu\n=\n0\n=\n0\n=\n∑\nx\ng\n(\nx\n)\n∂\n∂\nf\nL\n(\nf\n(\nx\n)\n,\nx\n)\nAs g may be any arbitrary function, the only way that the expression above will always hold is if the partial derivative of \nL\n with respect to f is zero for all x. This tells us (using δ to indicate a variational derivative with respect to a function):\n\n𝑓̃(𝑥)=argmin𝑓𝑆[𝑓(𝑥)]⇔𝛿𝑆𝛿𝑓∣∣∣𝑓=𝑓̃=0⇔∂∂𝑓∣∣∣𝑓=𝑓̃=0\nf\n~\n(\nx\n)\n=\narg\n⁡\nmin\nf\n⁡\nS\n[\nf\n(\nx\n)\n]\n⇔\nδ\nS\nδ\nf\n|\nf\n=\nf\n~\n=\n0\n⇔\n∂\nL\n∂\nf\n|\nf\n=\nf\n~\n=\n0\nNote that had we assumed that \nL\n was also a function of the gradient of f, we would instead have recovered the Euler–Lagrange equation used in analytical mechanics, for which \nL\n is referred to as a Lagrangian. In the main text of this paper, the functional (S) is typically a free energy, the function (f) is an approximate posterior distribution, and x are hidden states. For example:\n\n(𝑄(𝑠̃|𝜋),𝑠̃)=𝑄(𝑠̃|𝜋)(ln𝑄(𝑠̃|𝜋)−ln𝑃(𝑜̃,𝑠̃|𝜋))𝑆=𝐹𝜋=∑𝑠̃(𝑄(𝑠̃|𝜋),𝑠̃)𝑃(𝑠̃|𝜋,𝑜̃)≈argmin𝑄(𝑠̃|𝜋)𝐹𝜋\n"
      },
      "after": "0c0ab125fd97aa95",
      "date": 1637902532430
    },
    {
      "type": "edit",
      "id": "0c0ab125fd97aa95",
      "item": {
        "type": "markdown",
        "id": "0c0ab125fd97aa95",
        "text": "Having identified a suitable prior belief for policies 𝑄𝑜(𝜋)\nQ\no\n(\nπ\n)\n, we can calculate the fixed point of the free energy with respect to the variational posterior over policies and use this to update the posterior after each time step:\n\n𝛿𝐹𝛿𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑄0(𝜋)−𝐹𝜋(𝜋))=𝜎(ln𝑃(𝜋)−𝐺(𝜋)−𝐹𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡\nQ\n0\n(π)−\nF\nπ\n(π))\t\t=σ(ln⁡P(π)−G(π)−\nF\nπ\n) \n(12)\nThis highlights the way in which the expected free energy influences policy selection. Distributions over policies are updated at each time step to a fixed point that depends upon the expected free energy. The expected free energy is a functional of posterior beliefs about states. Section 2.5 sets out how these may be optimised in relation to sensory outcomes.\n\nHidden state updates\nTo complete our description of active inference, we derive the belief update equations for the hidden states:\n\n𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=−ln𝑃(𝑜𝜏|𝑠𝜏)−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+ln𝑄(𝑠𝜏|𝜋)𝛿𝐹𝜋𝛿𝑄(𝑠𝜏|𝜋)=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=−ln⁡P(\no\nτ\n|\ns\nτ\n)−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]+ln⁡Q(\ns\nτ\n|\nπ)\t\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q(\ns\nτ\n|\nπ)=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]) \n(13)\nThis result says that, to minimise free energy, we update beliefs about states under policies at each time step such that they are equal to a softmax function of a sum of expected log probabilities. These are the terms in the generative model that depend upon the state about which we optimise beliefs. Technically, these are the state’s Markov blanket (Pearl 1998). These comprise the constraints based upon beliefs about the previous state, the next state and the sensory outcome generated by the current state. The expectations here are simple to calculate, in virtue of the categorical distributions used to define the model and variational posterior. Practically, this means that the sufficient statistics of these are vectors (or matrices, for conditional distributions), where each element is the probability of each alternative value the state can take. (For conditional distributions, these are matrices where each column is a different value for the variable in the conditioning set.) Table 2 sets out the notation used for these sufficient statistics. Crucially, the linear algebraic expression of these statistics means expectations reduce to matrix–vector multiplications or dot products as set out in Fig. 3. Note that as we progress through time, new outcomes become available. As the free energy minima depend upon available outcomes, this means we need to update the variational posteriors following each new outcome.\n\nTable 2 Variables in update equations\nFull size table\nFig. 3\nfigure3\nBelief update equations. The blue panels show the update equations using the standard variational approach. The pink panels show the update equations when the generalised free energy is used. The equations in this figure show the fixed points for the sufficient statistics of each variational distribution. These are calculated as in the main text by finding the minima of each of the free energy functionals. As such, updating the variational distributions (left-hand side of each equation) to their fixed points (right-hand side of each equation) following each new observation minimises the corresponding free energy. The dotted outline indicates the correspondence between the generalised free energy and the sum of the variational and expected free energies, and therefore the equivalence of the form of the posteriors over policies. However, it should be remembered that the variables within these equations are not identical, as the update equations demonstrate. See Table 2 for the definitions of the variables as they appear here. The equations used here are discrete updates. A more biologically plausible (gradient ascent) scheme is used in the simulations. These simply replace the updates with differential equations that have stationary points corresponding to the variational solutions above. Because the belief updates specified in Fig. 3 take each belief distribution to its free energy minimum, the belief updates and corresponding policy choices necessarily minimise free energy. In the update equations shown here, oτ is treated as a binary vector with one in the element corresponding to the observed data, and zero for all other elements. This ensures consistency with the linear algebraic expression of the update equations (color figure online)\nFull size image\nSummary\nIn the above, we have provided an overview of our approach to date. This uses a variational free energy functional to derive belief updates, while policy selection is performed based on an expected free energy. The resulting update equations are shown in Fig. 3 (blue panels). This formulation has been very successful in explaining a range of cognitive functions, as summarised in Table 1. In the following, we present an alternative line of reasoning. As indicated in Fig. 2, there is more than one way to think about the data assimilation and evidence accumulation implicit in this formulation. So far, we have considered the addition of new observations as time progresses. We now consider the case in which (future) outcomes are represented throughout time. This means that future or latent outcomes have the potential to influence beliefs about past states.\n\nActive inference and generalised free energy\nWe define the generalised free energy as\n\n=𝐸𝑄(𝜋)[𝜋]+𝐷𝐾𝐿[𝑄(𝜋)||𝑃(𝜋)]𝜋=∑𝜏𝜋𝜏𝜋𝜏=−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏,𝑠𝜏|𝑠𝜏−1,𝜋)Energy−ln𝑄(𝑜𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)Entropy]\nF\n=\nE\nQ\n(\nπ\n)\n[\nF\nπ\n]+\nD\nK\nL\n[Q(π)\n|\n|\nP(π)]\t\t\nF\nπ\n=\n∑\nτ\nF\nπ\nτ\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n,\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n⏟\nEnergy\n−\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n⏟\nEntropy\n] \n(14)\nwhere, as above, the expectation is with respect to 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. However, we now distinguish the past and the future through the following:\n\n𝑄(𝑜𝜏|𝑠𝜏)={𝑃(𝑜𝜏|𝑠𝜏)𝛿(𝑜𝜏,𝑜∗𝜏):𝜏>𝑡:𝜏≤𝑡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\n{\nP\n(\no\nτ\n|\ns\nτ\n)\n:\nτ\n>\nt\nδ\n(\no\nτ\n,\no\nτ\n∗\n)\n:\nτ\n≤\nt\n \n(15)\nThe δ here is a Kronecker delta function (a discrete version of a Dirac delta) that is one when the arguments are equal, and zero otherwise. The starred (*) argument indicates the data we have actually observed. In the generalised free energy, the marginals of the joint distribution over outcomes and states define the entropy but the expectation is over the joint distribution. It is important to note that 𝑄(𝑜𝜏,𝑠𝜏|𝜋)≠𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n≠\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n. It is this inequality that underlies the epistemic components of generalised free energy. Interestingly, if we assumed conditional independence between outcomes and hidden states, 𝑄(𝑜𝜏,𝑠𝜏|𝜋)=𝑄(𝑜𝜏|𝜋)𝑄(𝑠𝜏|𝜋)\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n=\nQ\n(\no\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n, the resulting belief update equations would correspond exactly to a variational message passing algorithm (Dauwels 2007) applied to a model with missing data.\n\nWhen the expectation is taken with respect to the approximate posteriors, the marginalisation implicit in this definition ensures that\n\n−𝐸𝑄(𝑜𝜏,𝑠𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]=∑𝑜𝜏,𝑠𝜏𝑄(𝑜𝜏,𝑠𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=−∑𝑜𝜏𝑄(𝑜𝜏|𝜋)ln𝑄(𝑜𝜏|𝜋)=𝐻[𝑄(𝑜𝜏|𝜋)]\n−\nE\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n[ln⁡Q(\no\nτ\n|\nπ)]\t=\n∑\no\nτ\n,\ns\nτ\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=−\n∑\no\nτ\nQ\n(\no\nτ\n|\nπ\n)\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n=H[Q(\no\nτ\n|\nπ)] \n(16)\nIf we write out the generative model in full and substitute this (omitting constants) into Eq. 14, we can use the same implicit marginalisation to write:\n\n𝜋𝜏=−𝐸𝑄(𝑜𝜏|𝑠𝜏)𝑄(𝑠𝜏|𝜋)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏|𝜋)𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]+𝐸𝑄(𝑠𝜏|𝜋)[ln𝑄(𝑠𝜏|𝜋)]−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]𝑄(𝑜𝜏|𝜋)=𝐸𝑄(𝑠𝜏|𝜋)[𝑄(𝑜𝜏|𝑠𝜏)]\nF\nπ\nτ\n=−\nE\nQ\n(\no\nτ\n|\ns\nτ\n)\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]−\nE\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n]+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[ln⁡Q\n(\ns\nτ\n|\nπ\n)\n]−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[ln⁡P(\no\nτ\n)]\t\tQ\n(\no\nτ\n|\nπ\n)\n=\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[Q(\no\nτ\n|\ns\nτ\n)] \n(17)\nThe implicit generative model now incorporates a prior over observations. This means that the generative model is replaced with that shown on the right of Fig. 1:\n\n𝑃(𝑜̃,𝑠̃,𝜋|𝑚)=𝑃(𝑜̃|𝑠̃,𝑚)𝑃(𝑠̃|𝜋)𝑃(𝜋)𝑃(𝑜̃|𝑠̃,𝑚)=1𝑍𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)𝑍=∑𝑜̃𝑃(𝑜̃|𝑠̃)𝑃(𝑜̃|𝑚)\nP\n(\no\n~\n,\ns\n~\n,\nπ\n|\nm\n)\n=P(\no\n~\n|\ns\n~\n,m)P(\ns\n~\n|\nπ)P(π)\t\tP\n(\no\n~\n|\ns\n~\n,\nm\n)\n=\n1\nZ\nP(\no\n~\n|\ns\n~\n)P(\no\n~\n|\nm)\t\tZ=\n∑\no\n~\nP\n(\no\n~\n|\ns\n~\n)\nP\n(\no\n~\n|\nm\n)\n \n(18)\nHere, we have defined the distribution over states and observations in terms of two independent factors, a likelihood and a prior over observations, i.e. preferred observations conditioned on the model. For simplicity, we will omit the explicit conditioning on 𝑚\nm\n, so that 𝑃(𝑜̃|𝑚)=𝑃(𝑜̃)\nP\n(\no\n~\n|\nm\n)\n=\nP\n(\no\n~\n)\n. This quantity plays exactly the same role as that of the preferences in the formulation described in the previous section. However, while it has the same influence over policy selection, it can no longer be interpreted as model evidence. Instead, it is a policy-independent prior that contributes to the evidence.\n\nFor past states, this distribution is flat. Crucially, this means the generalised free energy reduces to the variational free energy for outcomes that had been observed in the past. Separating out contributions from the past and the future, we are left with the following:\n\n𝜋=∑𝜏≤𝑡𝐹𝜋𝜏+∑𝜏>𝑡𝜋𝜏\nF\nπ\n=\n∑\nτ\n≤\nt\nF\nπ\nτ\n+\n∑\nτ\n>\nt\nG\nπ\nτ\n(19)\nUnlike 𝐺\nG\n (the expected free energy), \nG\n is the free energy of the expected future. We can rearrange Eq. 17 (for future states) in several ways that offer some intuition for the properties of the generalised free energy.\n\n𝜋𝜏=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity+𝐷𝐾𝐿[𝑄(𝑜𝜏|𝜋)||𝑃(𝑜𝜏)]Risk+𝐸𝑄(𝑠𝜏|𝜋)[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]Ambiguity=𝐷𝐾𝐿[𝑄(𝑠𝜏|𝜋)||𝐸𝑄(𝑠𝜏−1|𝜋)[𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]]Complexity−𝐷𝐾𝐿[𝑄(𝑜𝜏,𝑠𝜏|𝜋)||𝑄(𝑠𝜏|𝜋)𝑄(𝑜𝜏|𝜋)]Epistemicvalue(Mutualinformation)−𝐸𝑄(𝑜𝜏|𝜋)[ln𝑃(𝑜𝜏)]Extrinsicvalue\nG\nπ\nτ\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n+\nD\nK\nL\n[\nQ\n(\no\nτ\n|\nπ\n)\n|\n|\nP\n(\no\nτ\n)\n]\n⏟\nRisk\n+\nE\nQ\n(\ns\nτ\n|\nπ\n)\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\nAmbiguity\n=\nD\nK\nL\n[\nQ\n(\ns\nτ\n|\nπ\n)\n|\n|\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n]\n⏟\nComplexity\n−\nD\nK\nL\n[\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n|\n|\nQ\n(\ns\nτ\n|\nπ\n)\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\nEpistemic\nvalue\n(\nMutual\ninformation\n)\n−\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\nExtrinsic\nvalue\n \n(20)\nTo obtain the mutual information term, we have used the relationship ln𝑃(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏|𝑠𝜏)=ln𝑄(𝑜𝜏,𝑠𝜏|𝜋)−ln𝑄(𝑠𝜏|𝜋)\nln\n⁡\nP\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n|\ns\nτ\n)\n=\nln\n⁡\nQ\n(\no\nτ\n,\ns\nτ\n|\nπ\n)\n−\nln\n⁡\nQ\n(\ns\nτ\n|\nπ\n)\n. The imperative to maximise the mutual information (Barlow 1961, 1974; Linsker 1990; Optican and Richmond 1987) can be interpreted as an epistemic drive (Denzler and Brown 2002). This is because policies that (are believed to) result in observations that are highly informative about the hidden states are associated with a lower generalised free energy. As a KL divergence is always greater than or equal to zero, the second equality indicates that the free energy of the expected future is an upper bound on expected surprise.\n\nTo find the belief update equations for the policies, we take the variational derivative of the generalised free energy with respect to the posterior over policies and set the result to zero in the usual way:\n\n𝛿𝛿𝑄(𝜋)𝛿𝛿𝑄(𝜋)=𝜋−ln𝑃(𝜋)+ln𝑄(𝜋)=0⇔𝑄(𝜋)=𝜎(ln𝑃(𝜋)−𝜋)\nδ\nF\nδ\nQ\n(\nπ\n)\n=\nF\nπ\n−ln⁡P(π)+ln⁡Q(π)\t\nδ\nF\nδ\nQ\n(\nπ\n)\n=0⇔Q(π)=σ(ln⁡P(π)−\nF\nπ\n) \n(21)\nAt time 𝜏=0\nτ\n=\n0\n, no observations have been made, and the distribution above becomes a prior. When this is the case, 𝜋=𝜋\nF\nπ\n=\nG\nπ\n, so the prior over policies is:\n\n𝑄𝑜(𝜋)=𝜎(ln𝑃(𝜋)−𝜏=0𝜋)=𝜎(ln𝑃(𝜋)−(𝜋))\nQ\no\n(\nπ\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nF\nπ\nτ\n=\n0\n)\n=\nσ\n(\nln\n⁡\nP\n(\nπ\n)\n−\nG\n(\nπ\n)\n)\nIf we take the variational derivative of Eq. 17 with respect to the hidden states:\n\n𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)𝛿𝜋𝛿𝑄(𝑠𝜏|𝜋)=ln𝑄(𝑠𝜏|𝜋)−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]−𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]−𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]+𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)]=0⇔𝑄(𝑠𝜏|𝜋)=𝜎(𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=ln⁡Q(\ns\nτ\n|\nπ)−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]\t\t−\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]−\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t+\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]\t\nδ\nF\nπ\nδ\nQ\n(\ns\nτ\n|\nπ\n)\n=0⇔Q\n(\ns\nτ\n|\nπ\n)\n=σ(\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]\t\t+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(22)\nThe derivative of 𝐸𝑄(𝑜𝜏|𝜋)[ln𝑄(𝑜𝜏|𝜋)]\nE\nQ\n(\no\nτ\n|\nπ\n)\n[\nln\n⁡\nQ\n(\no\nτ\n|\nπ\n)\n]\n is a little complicated, so this is presented step by step in “Appendix B”. The hidden state update has a different interpretation in the past compared to the future:\n\n∀𝜏≤𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(ln𝑃(𝑜𝜏|𝑠𝜏)+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)])∀𝜏>𝑡:𝑄(𝑠𝜏|𝜋)=𝜎(−𝐻[𝑃(𝑜𝜏|𝑠𝜏)]+𝐸𝑄(𝑠𝜏−1|𝜋)[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]+𝐸𝑄(𝑠𝜏+1|𝜋)[ln𝑃(𝑠𝜏+1|𝑠𝜏,𝜋)]−𝐸𝑃(𝑜𝜏|𝑠𝜏)[ln𝑄(𝑜𝜏|𝜋)−ln𝑃(𝑜𝜏)])\n∀τ≤t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(ln⁡P(\no\nτ\n|\ns\nτ\n)+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)])\t\t∀τ>t\n:\nQ\n(\ns\nτ\n|\nπ\n)\n=σ(−H[P(\no\nτ\n|\ns\nτ\n)]+\nE\nQ\n(\ns\nτ\n−\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n|\ns\nτ\n−\n1\n,π)]+\nE\nQ\n(\ns\nτ\n+\n1\n|\nπ\n)\n[ln⁡P(\ns\nτ\n+\n1\n|\ns\nτ\n,π)]\t\t−\nE\nP\n(\no\nτ\n|\ns\nτ\n)\n[ln⁡Q\n(\no\nτ\n|\nπ\n)\n−ln⁡P(\no\nτ\n)]) \n(23)\nThe final term for future beliefs implies that future states are considered more probable if they are expected to be similar to those that generate preferred outcomes. In other words, there is an optimistic distortion of beliefs about the trajectory into the future.\n\nSummary\nWe have introduced a generalised free energy functional that is expressed as a functional of beliefs about data. The variational free energy can be seen as a special case of this generalised functional, when beliefs about outcomes collapse to delta functions. When we derive update equations (Fig. 3, pink panels) under this functional, the updates look very similar to those based on the variational free energy approach. An important difference between the two approaches is that we have now included the prior probability of outcomes in the generative model. This has no influence over beliefs about the past, but distorts beliefs about the future in an optimistic fashion. This formulation generalises not only the standard active inference formalism, but also active data selection or sensing approaches in machine learning (MacKay 1992) and computational neuroscience (Yang et al. 2016b). See “Appendix A” for a discussion of the relationship between these.\n\nComparison of active inference under expected and generalised free energy\nThe generalised free energy has the appeal that belief updating and policy selection both minimise the same objective function. In contrast, formulations of active inference to date have required two different quantities (the variational free energy and the expected free energy, respectively) to derive these processes. Although the form of belief updating is the same, the belief updates resulting from the use of a generalised free energy are different in subtle ways. In this section, we will explore these differences and show how generalised active inference reproduces the behaviours illustrated in our earlier papers.\n\nThe notable differences between the updates are found in the policy prior, the treatment of outcomes and the future hidden state updates. The prior over policies is very similar in both formulations. The expected and generalised free energy (at 𝜏=0\nτ\n=\n0\n) differ only in that there is an additional complexity term in the latter. This has a negligible influence on behaviour, as the first action is performed after observations have been made at the first time step. At this point, the posterior belief about policies is identical, as the variational free energy supplies the missing complexity term. Although the priors are different, in both form and motivation, the posterior beliefs turn out to be computed identically. Any difference in these can be attributed to the quantities used to calculate them, namely the outcomes and the hidden states.\n\nOutcomes in the generalised formulation are represented explicitly as beliefs. This means that the prior over outcomes is incorporated explicitly in the generative model. There are two important consequences of this. The first is that the posterior beliefs about future outcomes (i.e. the probability of future outcomes given those already observed) can be derived in a parsimonious way, without the need to define additional prior distributions. The second is that hidden state beliefs in the future are biased towards these preferred outcomes. A prior belief about an outcome at a particular time point thus distorts the trajectory of hidden states at each time point reaching back to the present. In addition to this, beliefs about hidden states in the future acquire an ‘ambiguity’ term. This means that states associated with an imprecise mapping to sensory outcomes are believed less likely to be inferred. In summary, not only are belief trajectories drawn in optimistic directions, they also tend towards states that offer informative observations.\n\nTo make the abstract considerations above a little more concrete, we have employed an established generative model that has previously been used to demonstrate epistemic (i.e. information seeking) behaviours under active inference (Friston et al. 2015). This is a T-maze task (Fig. 4), in which an agent decides between (temporally deep) policies. Temporal depth here refers to the depth of the planning horizon. A temporally deep policy is one that considers sequences of actions, as opposed to only the next action. In one arm, there is an unconditionedFootnote 2 (rewarding) stimulus. In another, there is no stimulus, and this condition is considered aversive. In the final arm, there is always an instructional or conditioned stimulus that indicates the arm that contains the reward. There are two possible contexts for the maze. The first is that where the unconditioned stimulus is in the left arm and the second where it is in the right arm. The starting location and the location of the conditioned stimulus are neither aversive nor rewarding. Under each of the schemes illustrated here, the degree to which a stimulus is rewarding is expressed in terms of the prior preference (i.e. C). In other words, we can think of reward as the log probability of a given observation. The more probable an outcome is considered to be, the more attractive it appears to be. This is because policies that do not lead to these outcomes violate prior beliefs and are unlikely to be selected a posteriori. Please see “Appendix A” (term 4) for an interpretation of this that appeals to expected utility theory and risk aversion. There is an important distinction here between schemes based upon Bellman optimality and the scheme on offer here. This is that active inference depends upon probabilistic beliefs and does not assume direct access to knowledge about states of the world. Practically, this means that the agent has no direct access to the hidden states, but must infer them based upon the (observable) outcomes. The importance of this is that the information gain associated with an exploratory behaviour can be quantified by the change in beliefs (or uncertainty reduction) that this behaviour facilitates.\n\nFig. 4\nfigure4\nT-maze simulation. The left part of this figure shows the structure of the generative model used to illustrate the behavioural consequences of each set of update equations. We have previously used this generative model to address exploration and exploitation in two-step tasks; further details of which can be found in Friston et al. (2015). In brief, an agent can find itself in one of four different locations and can move among these locations. Locations 2 and 3 are absorbing states, so the agent is not able to leave these locations once they have been visited. The initial location is always 1. Policies define the possible sequences of movements the agent can take throughout the trial. For all ten available policies, after the second action, the agent stays where it is. There are two possible contexts: the unconditioned stimulus (US) may be in the left or right arm of the maze. The context and location together give rise to observable outcomes. The first of these is the location, which is obtained through an identity mapping from the hidden state representing location. The second outcome is the cue that is observed. In location 1, a conditioned stimulus (CS) is observed, but there is a 50% chance of observing blue or green, regardless of the context, so this is uninformative (and ambiguous). Location 4 deterministically generates a CS based on the context, so visiting this location resolves uncertainty about the location of the US. The US observation is probabilistically dependent on the context. It is observed with a 90% chance in the left arm in context 1 and a 90% chance in the right arm in context 2. The right part of this figure compares an agent that minimises its variational free energy (under the prior belief that it will select policies with a low expected free energy) with an agent that minimises its generalised free energy. The upper plots show the posterior beliefs about policies, where darker shades indicate more probable policies. Below these, the posterior beliefs about states (location and context) are shown, with blue dots superimposed to show the true states used to generate the data. The lower plots show the prior beliefs about outcomes (i.e. preferences), and the true outcomes (blue dots) the agent encountered. Note that a US is preferred to either CS, both of which are preferable to no stimulus (NS). Outcomes are observed at each time step, depending upon actions selected at the previous step. The time steps shown here align with the sequence of events during a trial, such that a new outcome is available at each step. Actions induce transitions from one time step to the next (color figure online)\nFull size image\nAs Fig. 4 shows, regardless of the active inference scheme we use, the agent first samples the unrewarding, but epistemically valuable, uncertainty resolving cue location. This entails moving from the initial location in the centre of the maze, where the agent is uncertain about the context, to the location with the conditioned stimulus. To have made the decision to make this move, the agent updated its beliefs about states of the world (sπτ) in relation to the outcomes (o1) available in the central location using the fixed-point solutions shown in the ‘hidden states’ panels of Fig. 3. It does so for beliefs about every time point from the start to the end of the (four step) planning horizon. As these belief updates were derived by finding the free energy minima, this means these belief updates necessarily minimise free energy. Once beliefs have been optimised, they may be used to compute the expected free energy (or the corresponding part of the generalised free energy) as in the ‘free energies’ panel of Fig. 3. These are then used to update beliefs about policies as in the ‘policy selection’ panel. In computing these free energies, we required a posterior predictive belief about outcomes, which can be obtained using the likelihood probabilities to project beliefs about states to beliefs about outcomes (‘outcomes’ panel of Fig. 3). Given that the context unambiguously determines the conditioned stimulus and that our agent is initially uncertain about the context, the greatest information gain (and therefore smallest expected or generalised free energy) is associated with policies that sample this cue location.\n\nOn reaching the conditioned stimulus and observing the green conditioned stimulus (o2), the agent again updates beliefs about states to their new fixed point. Here, the free energy minimum corresponds to the belief that the second context (with the unconditioned stimulus in the right arm) is in play. Having resolved uncertainty about the context of the maze, the agent proceeds to maximise its extrinsic reward by moving to the reward location and finding the unconditioned stimulus (o3). This is consistent with the smaller expected and generalised free energies associated with policies that realise prior beliefs about outcomes (C in the ‘free energies’ panels of Fig. 3).\n\nAlthough the most striking feature of these simulation results is their similarity, there are some interesting differences worth considering. These are primarily revealed by the beliefs about hidden states over time. Under each of the schemes presented here, for a hypothetical rat performing this task, there exist a set of (neuronal) units that encode beliefs about each possible state. For each state, there are units representing the configuration of that state in the past and future, in addition to the present. The activity in these units is shown in Fig. 5. The differences here are more dramatic than in the subsequent behaviours illustrated in Fig. 4. At the first time step (column 1), both agents infer that they will visit location 4 at the next time, resolving uncertainty about the context of the maze. From this future point onwards, however, the beliefs diverge. This can be seen clearly in the lower rows of column 1: the beliefs about the future at the first time step. The agent who employs expected free energy believes they will stay in the uncertainty resolving arm of the maze, while the generalised agent believes they will end up in one of the (potentially) rewarding arms. Despite a shared proximal belief trajectory, the distal elements of the two agents’ paths are pulled in opposite directions. As each future time point approaches, the beliefs about that time begin to converge—as observations become available.\n\nFig. 5\nfigure5\nOptimistic distortions of future beliefs. These raster plots represent the (Bayesian model average of the) approximate posterior beliefs about states (specifically, those pertaining to location). At each time step t, there is a set of units encoding beliefs about every other time step τ in the past and future. The evolution of these beliefs is reflected the evidence accumulation or belief updating of approximate posterior expectations, with lighter shades indicating more probable states\nFull size image\nTaken together, Figs. 4 and 5 illustrate an interesting feature of the generalised formulation. Although subtle, at t =1, beliefs about location at τ = 2 are different, as shown in Fig. 5. Specifically, locations 2 and 3 appear slightly more probable, at the expense of location 4. This illustrates that beliefs about the proximal future are distorted by beliefs about future outcomes. Similarly, at t =2, the generalised scheme considers it more likely that it will transition to location 4 relative to the variational scheme. Referring back to Fig. 4, we see that this corresponds to an increased posterior probability for policy 10 at this time step. Here, beliefs about future states and outcomes have influenced beliefs about the plausibility of different behavioural options at the present. In this case, the agent believes that it will experience observations associated with states 2 and 3 in the distal future (τ = 4). This enhances the probability of being in states in the more proximal future that are consistent with transitions into states 2 or 3. As these are absorbing states (the probability of staying in those states, once occupied, is one), these states are highly consistent with a transition to themselves. This induces a belief that states 2 and 3 are more probable at time τ = 3. Note that, as there are other plausible states that could have transitioned into 2 and 3 at τ = 4, the probability of states 2 and 3 at τ = 3 is less than at τ = 4. The same reasoning explains the higher probability of 2 and 3 at τ = 2 (relative to the standard scheme), but with a lower probability relative to occupying these states at later times. If instead the agent believed there was a very low probability of ending up at the goal location, this would induce beliefs that those states that lead to these locations with high probability were themselves unlikely. Another way of putting this is that if I had strong beliefs about where I were to end up, I could infer where I might have been immediately before this. This will depend upon the relative probabilities of going from plausible penultimate locations to the goal location. By propagating these back to the present, I will infer that the most probable trajectory is the one that leads to this goal, and will act to fulfil my beliefs about this trajectory. In the absence of, possibly false, beliefs about where I would end up, I would not end up acting to fulfil these beliefs.\n\nConclusion\nThe generalised free energy introduced in this paper provides a new perspective on active inference. It unifies the imperatives to minimise variational free energy with respect to data, and expected free energy through model selection, under a single objective function. Like the expected free energy, this generalised free energy can be decomposed in several ways, giving rise to familiar information theoretic measures and objective functions in Bayesian reinforcement learning. Generalised free energy minimisation replicates the epistemic and reward seeking behaviours induced in earlier active inference schemes, but prior preferences now induce an optimistic distortion of belief trajectories into the future. This allows beliefs about outcomes in the distal future to influence beliefs about states in the proximal future and present. That these beliefs then drive policy selection suggests that, under the generalised free energy formulation, (beliefs about) the future can indeed cause the past.\n\nSoftware note\nAlthough the generative model changes from application to application, the belief updates described in this paper are generic and can be implemented using standard routines (here spm_MDP_VB_X.m). These routines are available as MATLAB code in the SPM academic software: http://www.fil.ion.ucl.ac.uk/spm/. Simulations of the sort reported above can be reproduced (and customised) via a graphical user interface by typing in ≫ DEM and selecting the ‘+’ next to the ‘Habit learning’ button.\n\nNotes\n1.\nThe KL divergence (also known as relative entropy or information gain) is defined as follows: 𝐷KL[𝑄(𝑥)||𝑃(𝑥)]≜𝐸𝑄(𝑥)[ln𝑄(𝑥)−ln𝑃(𝑥)]\nD\nKL\n[\nQ\n(\nx\n)\n|\n|\nP\n(\nx\n)\n]\n≜\nE\nQ\n(\nx\n)\n[\nln\n⁡\nQ\n(\nx\n)\n−\nln\n⁡\nP\n(\nx\n)\n]\n.\n2.\nThe terms conditioned stimulus and unconditioned stimulus are used in the sense of classical (Pavlovian) conditioning paradigms.\nReferences\nAttias H (2003) Planning by probabilistic inference. In: Proceedings of the 9th international workshop on artificial intelligence and statistics\nBaker CL, Saxe R, Tenenbaum JB (2009) Action understanding as inverse planning. Cognition 113:329–349. https://doi.org/10.1016/j.cognition.2009.07.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBarlow H (1961) Possible principles underlying the transformations of sensory messages. In: Rosenblith W (ed) Sensory communication. MIT Press, Cambridge, pp 217–234\nGoogle Scholar\n \nBarlow HB (1974) Inductive inference, coding, perception, and language. Perception 3:123–134\nCAS\n \nArticle\n \nGoogle Scholar\n \nBeal MJ (2003) Variational algorithms for approximate Bayesian inference. University of London, London\nGoogle Scholar\n \nBenrimoh D, Parr T, Vincent P, Adams RA, Friston K (2018) Active inference and auditory hallucinations computational psychiatry 2:183–204. https://doi.org/10.1162/cpsy_a_00022\nArticle\n \nPubMed\n \nGoogle Scholar\n \nBotvinick M, Toussaint M (2012) Planning as inference. Trends Cognit Sci 16:485–488\nArticle\n \nGoogle Scholar\n \nBrown H, Friston KJ (2012) Free-energy and illusions: the Cornsweet effect. Front Psychol 3:43. https://doi.org/10.3389/fpsyg.2012.00043\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Kiverstein J, Rietveld E (2016) The anticipating brain is not a scientist: the free-energy principle from an ecological-enactive perspective. Synthese. https://doi.org/10.1007/s11229-016-1239-1\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nBruineberg J, Rietveld E, Parr T, van Maanen L, Friston KJ (2018) Free-energy minimization in joint agent-environment systems: a niche construction perspective. J Theor Biol 455:161–178. https://doi.org/10.1016/j.jtbi.2018.07.002\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDaunizeau J, Preuschoff K, Friston K, Stephan K (2011) Optimizing experimental design for comparing models of brain function. PLOS Comput Biol 7:e1002280. https://doi.org/10.1371/journal.pcbi.1002280\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nDauwels J (2007) On variational message passing on factor graphs. In: IEEE international symposium on information theory, ISIT 2007. IEEE, pp 2546–2550\nDayan P, Hinton GE, Neal RM, Zemel RS (1995) The Helmholtz machine. Neural Comput 7:889–904\nCAS\n \nArticle\n \nGoogle Scholar\n \nDenzler J, Brown CM (2002) Information theoretic sensor data selection for active object recognition and state estimation. IEEE Trans Pattern Anal Mach Intell 24:145–157. https://doi.org/10.1109/34.982896\nArticle\n \nGoogle Scholar\n \nEl-Gamal MA (1991) The role of priors in active bayesian learning in the sequential statistical decision framework. In: Grandy WT, Schick LH (eds) Maximum entropy and Bayesian methods: Laramie, Wyoming, 1990. Springer Netherlands, Dordrecht, pp 33–38. https://doi.org/10.1007/978-94-011-3460-6_3\nChapter\n \nGoogle Scholar\n \nEllsberg D (1961) Risk, ambiguity, and the savage axioms. Q J Econ 75:643–669. https://doi.org/10.2307/1884324\nArticle\n \nGoogle Scholar\n \nFitzGerald T, Dolan R, Friston K (2014) Model averaging, optimal inference, and habit formation. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2014.00457\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Dolan RJ, Friston K (2015a) Dopamine, reward learning, and active inference. Front Comput Neurosci 9:136. https://doi.org/10.3389/fncom.2015.00136\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Moran RJ, Friston KJ, Dolan RJ (2015b) Precision and neuronal dynamics in the human posterior parietal cortex during evidence accumulation. Neuroimage 107:219–228. https://doi.org/10.1016/j.neuroimage.2014.12.015\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFitzGerald TH, Schwartenbeck P, Moutoussis M, Dolan RJ, Friston K (2015c) Active inference, evidence accumulation, and the urn task. Neural Comput 27:306–328. https://doi.org/10.1162/neco_a_00699\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K (2003) Learning and inference in the brain. Neural Netw 16:1325–1352. https://doi.org/10.1016/j.neunet.2003.06.005\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Buzsaki G (2016) The functional anatomy of time: what and when in the brain. Trends Cognit Sci. https://doi.org/10.1016/j.tics.2016.05.001\nArticle\n \nGoogle Scholar\n \nFriston K, Kilner J, Harrison L (2006) A free energy principle for the brain. J Physiol-Paris 100:70–87. https://doi.org/10.1016/j.jphysparis.2006.10.001\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston K, Adams R, Montague R (2012a) What is value—accumulated reward or evidence? Front Neurorobotics 6:11. https://doi.org/10.3389/fnbot.2012.00011\nArticle\n \nGoogle Scholar\n \nFriston K, Adams RA, Perrinet L, Breakspear M (2012b) Perceptions as hypotheses: saccades as experiments. Front Psychol 3:151. https://doi.org/10.3389/fpsyg.2012.00151\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, Samothrakis S, Montague R (2012c) Active inference and agency: optimal control without cost functions. Biol Cybernet 106:523–541. https://doi.org/10.1007/s00422-012-0512-8\nArticle\n \nGoogle Scholar\n \nFriston K, Schwartenbeck P, FitzGerald T, Moutoussis M, Behrens T, Dolan RJ (2014) The anatomy of choice: dopamine and decision-making. Philos Trans R Soc B Biol Sci 369:20130481. https://doi.org/10.1098/rstb.2013.0481\nArticle\n \nGoogle Scholar\n \nFriston K, Rigoli F, Ognibene D, Mathys C, Fitzgerald T, Pezzulo G (2015) Active inference and epistemic value. Cognit Neurosci 6:187–214. https://doi.org/10.1080/17588928.2015.1020053\nArticle\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, O’Doherty J, Pezzulo G (2016) Active inference and learning. Neurosci Biobehav Rev 68:862–879. https://doi.org/10.1016/j.neubiorev.2016.06.022\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston K, FitzGerald T, Rigoli F, Schwartenbeck P, Pezzulo G (2017a) Active inference: a process theory. Neural Comput 29:1–49. https://doi.org/10.1162/NECO_a_00912\nArticle\n \nPubMed\n \nGoogle Scholar\n \nFriston KJ, Lin M, Frith CD, Pezzulo G, Hobson JA, Ondobaka S (2017b) Active inference, curiosity and insight. Neural Comput 29(10):2633–2683\nArticle\n \nGoogle Scholar\n \nFriston KJ, Parr T, de Vries B (2017c) The graphical brain: belief propagation and active inference. Netw Neurosci 1:381–414. https://doi.org/10.1162/NETN_a_00018\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nFriston KJ, Rosch R, Parr T, Price C, Bowman H (2017d) Deep temporal models and active inference. Neurosci Biobehav Rev 77:388–402. https://doi.org/10.1016/j.neubiorev.2017.04.009\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nGhirardato P, Marinacci M (2002) Ambiguity made precise: a comparative foundation. J Econ Theory 102:251–289. https://doi.org/10.1006/jeth.2001.2815\nArticle\n \nGoogle Scholar\n \nGilhooly (2005) Working memory and planning, 1st edn. In: Morris R, Ward G (eds) The cognitive psychology of planning. Psychology Press, London, 256 p. https://doi.org/10.4324/9780203493564\nBook\n \nGoogle Scholar\n \nGregory RL (1980) Perceptions as hypotheses. Philos Trans R Soc Lond B Biol Sci 290:181\nCAS\n \nArticle\n \nGoogle Scholar\n \nHikosaka O, Takikawa Y, Kawagoe R (2000) Role of the basal ganglia in the control of purposive saccadic eye movements. Physiol Rev 80:953\nCAS\n \nArticle\n \nGoogle Scholar\n \nHohwy J (2016) The self-evidencing brain. Noûs 50:259–285. https://doi.org/10.1111/nous.12062\nArticle\n \nGoogle Scholar\n \nHuggins JH, Tenenbaum JB (2015) Risk and regret of hierarchical Bayesian learners. Paper presented at the Proceedings of the 32nd international conference on international conference on machine learning—Volume 37, Lille, France\nHwa R (2004) Sample selection for statistical parsing. Comput Linguist 30:253–276\nArticle\n \nGoogle Scholar\n \nKaplan R, Friston KJ (2018) Planning and navigation as active inference. Biol Cybernet. https://doi.org/10.1007/s00422-018-0753-2\nArticle\n \nGoogle Scholar\n \nKappen HJ, Gomez Y, Opper M (2012) Optimal control as a graphical model inference problem. Mach Learn 87:159–182\nArticle\n \nGoogle Scholar\n \nKrause A (2008) Optimizing sensing: theory and applications. Carnegie Mellon University, Pittsburgh\nGoogle Scholar\n \nLewis DD, Gale WA (1994) A sequential algorithm for training text classifiers. In: Proceedings of the 17th annual international ACM SIGIR conference on Research and development in information retrieval. Springer-Verlag New York, Inc., pp 3–12\nLindley DV (1956) On a measure of the information provided by an experiment. Ann Math Stat 27:986–1005. https://doi.org/10.1214/aoms/1177728069\nArticle\n \nGoogle Scholar\n \nLinsker R (1990) Perceptual neural organization: some approaches based on network models and information theory. Annu Rev Neurosci 13:257–281\nCAS\n \nArticle\n \nGoogle Scholar\n \nLloyd K, Leslie DS (2013) Context-dependent decision-making: a simple Bayesian model. J R Soc Interface 10:1. https://doi.org/10.1098/rsif.2013.0069\nArticle\n \nGoogle Scholar\n \nMacKay DJC (1992) Information-based objective functions for active data selection. Neural Comput 4:590–604. https://doi.org/10.1162/neco.1992.4.4.590\nArticle\n \nGoogle Scholar\n \nMcKay RT, Dennett DC (2010) The evolution of misbelief. Behav Brain Sci 32:493–510. https://doi.org/10.1017/S0140525X09990975\nArticle\n \nGoogle Scholar\n \nMirza MB, Adams RA, Mathys CD, Friston KJ (2016) Scene construction, visual foraging, and active inference. Front Comput Neurosci. https://doi.org/10.3389/fncom.2016.00056\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nMoiseiwitsch BL (2013) Variational principles. Dover Publications, Mineola\nGoogle Scholar\n \nMoutoussis M, Trujillo-Barreto NJ, El-Deredy W, Dolan RJ, Friston KJ (2014) A formal model of interpersonal inference. Front Hum Neurosci 8:160. https://doi.org/10.3389/fnhum.2014.00160\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nOptican L, Richmond BJ (1987) Temporal encoding of two-dimensional patterns by single units in primate inferior cortex. II Information theoretic analysis. J Neurophysiol 57:132–146\nArticle\n \nGoogle Scholar\n \nOrtega PA, Braun DA (2010) A minimum relative entropy principle for learning and acting. J Artif Int Res 38:475–511\nGoogle Scholar\n \nParr T, Friston KJ (2017a) The computational anatomy of visual neglect. Cereb Cortex. https://doi.org/10.1093/cercor/bhx316\nArticle\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2017b) Uncertainty, epistemics and active inference. J R Soc Interface 14:20170376\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2017c) Working memory, attention, and salience in active inference. Sci Rep 7:14678. https://doi.org/10.1038/s41598-017-15249-0\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Friston KJ (2018) The discrete and continuous brain: from decisions to movement—and back again. Neural Comput 30:1–10\nArticle\n \nGoogle Scholar\n \nParr T, Friston KJ (2019) The computational pharmacology of oculomotion. Psychopharmacology. https://doi.org/10.1007/s00213-019-05240-0\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Benrimoh D, Vincent P, Friston K (2018a) Precision and false perceptual inference. Front Integr Neurosci. https://doi.org/10.3389/fnint.2018.00039\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rees G, Friston KJ (2018b) Computational neuropsychology and Bayesian inference. Front Hum Neurosci. https://doi.org/10.3389/fnhum.2018.00061\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nParr T, Rikhye RV, Halassa MM, Friston KJ (2019) Prefrontal computation as active inference. Cereb Cortex. https://doi.org/10.1093/cercor/bhz118\nArticle\n \nPubMed\n \nGoogle Scholar\n \nPearl J (1998) Graphical models for probabilistic and causal reasoning. In: Smets P (ed) Quantified representation of uncertainty and imprecision. Springer Netherlands, Dordrecht, pp 367–389. https://doi.org/10.1007/978-94-017-1735-9_12\nChapter\n \nGoogle Scholar\n \nPearl J (2014) Probabilistic reasoning in intelligent systems: networks of plausible inference. Elsevier, Amsterdam\nGoogle Scholar\n \nProsser A, Friston KJ, Bakker N, Parr T (2018) A Bayesian account of psychopathy: a model of lacks remorse and self-aggrandizing. Comput Psychiatry. https://doi.org/10.1162/cpsy_a_00016\nArticle\n \nGoogle Scholar\n \nRasmussen CE, Ghahramani Z (2001) Occam's razor, advances in neural information processing systems 13. In: Leen TK, Dietterich TG, Tresp V (eds) Proceedings from the conference, neural information processing systems. https://papers.nips.cc/book/advances-in-neural-information-processing-systems-13-2000\nSales AC, Friston KJ, Jones MW, Pickering AE, Moran RJ (2018) Locus Coeruleus tracking of prediction errors optimises cognitive flexibility: an Active Inference model bioRxiv:340620\nSchacter DL, Benoit RG, De Brigard F, Szpunar KK (2015) Episodic future thinking and episodic counterfactual thinking: intersections between memory and decisions. Neurobiol Learn Mem 117:14–21. https://doi.org/10.1016/j.nlm.2013.12.008\nArticle\n \nPubMed\n \n\n"
      },
      "date": 1637902550542
    },
    {
      "type": "add",
      "id": "5cdf6e90ea6dc2c9",
      "item": {
        "type": "markdown",
        "id": "5cdf6e90ea6dc2c9",
        "text": "Google Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain encodes the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\nArticle\n \nPubMed\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.1038/srep16575\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\n\n"
      },
      "after": "0c0ab125fd97aa95",
      "date": 1637902554472
    },
    {
      "type": "edit",
      "id": "5cdf6e90ea6dc2c9",
      "item": {
        "type": "markdown",
        "id": "5cdf6e90ea6dc2c9",
        "text": "Schwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain [[encodes]] the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\n\n"
      },
      "date": 1637902580236
    },
    {
      "type": "add",
      "id": "af8257d2339238b6",
      "item": {
        "type": "markdown",
        "id": "af8257d2339238b6",
        "text": "Schwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Kronbichler M, Friston K (2015b) Evidence for surprise minimization over value maximization in choice behavior. Sci Rep 5:16575. https://doi.org/10.10/srep16575\n\n"
      },
      "after": "5cdf6e90ea6dc2c9",
      "date": 1637902604187
    },
    {
      "type": "add",
      "id": "9c78057fc62df395",
      "item": {
        "type": "markdown",
        "id": "9c78057fc62df395",
        "text": "Article\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSchwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Wurst F, Kronbichler M, Friston K (2015c) Optimal inference with suboptimal models: addiction and active Bayesian inference. Med Hypotheses 84:109–117. https://doi.org/10.1016/j.mehy.2014.12.007\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nSettles B (2010) Active learning literature survey, vol 52. University of Wisconsin, Madison, p 11\nGoogle Scholar\n \nSharot T (2011) The optimism bias. Curr Biol 21:R941–R945. https://doi.org/10.1016/j.cub.2011.10.030\nCAS\n \nArticle\n \nPubMed\n \nGoogle Scholar\n \nSharot T, Guitart-Masip M, Korn Christoph W, Chowdhury R, Dolan Raymond J (2012) How dopamine enhances an optimism bias in humans. Curr Biol 22:1477–1481. https://doi.org/10.1016/j.cub.2012.05.053\nCAS\n \nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nShewry MC, Wynn HP (1987) Maximum entropy sampling. J Appl Stat 14:165–170. https://doi.org/10.1080/02664768700000020\nArticle\n \nGoogle Scholar\n \nStrens MJA (2000) A Bayesian framework for reinforcement learning. Paper presented at the proceedings of the seventeenth international conference on machine learning\nSutton RS, Barto AG (1998) Reinforcement learning: an introduction, vol 1. MIT Press, Cambridge\nGoogle Scholar\n \nTodorov E (2008) General duality between optimal control and estimation. In: IEEE conference on decision and control\nVerma D, Rao RP (2006) Planning and acting in uncertain environments using probabilistic inference. In: 2006 IEEE/RSJ international conference on intelligent robots and systems. IEEE, pp 2382–2387\nVincent P, Parr T, Benrimoh D, Friston KJ (2019) With an eye on uncertainty: Modelling pupillary responses to environmental volatility. PLOS Comput Biol 15:e1007126. https://doi.org/10.1371/journal.pcbi.1007126\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nWald A (1947) An essentially complete class of admissible decision functions. Ann Math Stat 4:549–555. https://doi.org/10.1214/aoms/1177730345\nArticle\n \nGoogle Scholar\n \nWinn JM (2004) Variational message passing and its applications. Citeseer\nWinn J, Bishop CM (2005) Variational message passing. J Mach Learn Res 6:661–694\nGoogle Scholar\n \nYang SC-H, Lengyel M, Wolpert DM (2016a) Active sensing in the categorization of visual patterns. eLife 5:e12215. https://doi.org/10.7554/elife.12215\nArticle\n \nPubMed\n \nPubMed Central\n \nGoogle Scholar\n \nYang SC-H, Wolpert DM, Lengyel M (2016b) Theoretical perspectives on active sensing. Curr Opin Behav Sci 11:100–108. https://doi.org/10.1016/j.cobeha.2016.06.009\nCAS\n \nArticle\n \nGoogle Scholar\n \nYedidia JS, Freeman WT, Weiss Y (2005) Constructing free-energy approximations and generalized belief propagation algorithms. IEEE Trans Inf Theory 51:2282–2312\nArticle\n \nGoogle Scholar\n \nDownload references\n\nAcknowledgements\nTP is supported by the Rosetrees Trust (Award Number 173346). KJF is a Wellcome Principal Research Fellow (Ref: 088130/Z/09/Z). The authors thank Dimitrije Markovic for his insightful comments on the manuscript.\n\nAuthor information\nAffiliations\nWellcome Centre for Human Neuroimaging, Institute of Neurology, University College London, 12 Queen Square, London, WC1N 3BG, UK\nThomas Parr & Karl J. Friston\n\nCorresponding author\nCorrespondence to Thomas Parr.\n\nEthics declarations\nConflict of interest\nThe authors declare that they have no conflict of interest.\n\nAdditional information\nPublisher's Note\nSpringer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\n\nCommunicated by Benjamin Lindner.\n\nAppendices\nAppendix A: Active data selection\nActive data selection has been a topic of interest in both neuroscience and machine learning for a number of years (Krause 2008). Several different approaches have been taken to define the best data to sample (Settles 2010), and the optimal experiments to perform to do this (Daunizeau et al. 2011). This appendix addresses the relationship between the future components of the expected free energy and established methods. Writing in full, the (negative) free energy of the expected future is\n\n−𝐺𝜋𝜏=𝐻[𝑄(𝑠𝜏|𝜋)]1+𝐸𝑄[ln𝑃(𝑠𝜏|𝑠𝜏−1,𝜋)]2+𝐻[𝑄(𝑜𝜏|𝜋)]3+𝐸𝑄[ln𝑃(𝑜𝜏)]4−𝐸𝑄[𝐻[𝑃(𝑜𝜏|𝑠𝜏)]]5\n−\nG\nπ\nτ\n=\nH\n[\nQ\n(\ns\nτ\n|\nπ\n)\n]\n⏟\n1\n+\nE\nQ\n[\nln\n⁡\nP\n(\ns\nτ\n|\ns\nτ\n−\n1\n,\nπ\n)\n]\n⏟\n2\n+\nH\n[\nQ\n(\no\nτ\n|\nπ\n)\n]\n⏟\n3\n+\nE\nQ\n[\nln\n⁡\nP\n(\no\nτ\n)\n]\n⏟\n4\n−\nE\nQ\n[\nH\n[\nP\n(\no\nτ\n|\ns\nτ\n)\n]\n]\n⏟\n5\nUnder active inference, the above functional is maximised. If we were to use only term 3, this maximisation reduces to ‘uncertainty sampling’ (Hwa 2004; Lewis and Gale 1994; Shewry and Wynn 1987). This involves (as the name suggests) selecting the data points about which uncertainty is highest. A problem with this approach is that it may favour the sampling of ambiguous (uninformative) data. This means that location 1 in our simulation would be very attractive, as there is always a 50% chance of observing each (uninformative) cue. A more sophisticated objective function includes both 3 and 5 (Denzler and Brown 2002; Lindley 1956; MacKay 1992; Yang et al. 2016a). This means that uncertain data points are more likely to be sampled, but only if there is an unambiguous mapping between the latent variable of interest and the data. This renders location 4 more attractive, as it initially associated with uncertain observations but also a precise likelihood mapping. If we were to use just term 5, location 4 would continue to be attractive even after being observed. The contribution of term 3 is to implement a form of ‘inhibition of return’. The relative influences of these terms are unpacked in greater detail in (Parr and Friston 2017b). Term 4 is a homologue of expected utility (reward) in reinforcement learning (Sutton and Barto 1998) and is an important quantity in sequential statistical decision theory (El-Gamal 1991; Wald 1947). On its own, this would not lead to any information seeking behaviour. Terms 1 and 2 together contribute to an ‘Occam factor’ (Rasmussen and Ghahramani 2001), a component of some previously used objective functions (MacKay 1992). We have assumed here that active learning models are myopic, but this is not necessarily the case. On inclusion of an explicit transition model, these models implicitly acquire terms 1 and 2 in the evaluation of posterior beliefs.\n\n\n"
      },
      "after": "af8257d2339238b6",
      "date": 1637902608858
    },
    {
      "type": "edit",
      "id": "5cdf6e90ea6dc2c9",
      "item": {
        "type": "markdown",
        "id": "5cdf6e90ea6dc2c9",
        "text": "Schwartenbeck P, FitzGerald TH, Mathys C, Dolan R, Friston K (2015a) The dopaminergic midbrain [[encode]]s the expected certainty about desired outcomes. Cereb Cortex 25:3434–3445. https://doi.org/10.1093/cercor/bhu159\n\n"
      },
      "date": 1637918801730
    }
  ]
}