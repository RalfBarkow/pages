{
  "title": "electric-starter-app",
  "story": [
    {
      "type": "paragraph",
      "id": "86de70dc929d8388",
      "text": "hyperfiddle / electric-starter-app [https://github.com/hyperfiddle/electric-starter-app github]"
    },
    {
      "type": "code",
      "id": "9ddcfb930cbed76f",
      "text": "clj -A:dev -X user/main"
    },
    {
      "type": "image",
      "id": "0c5d6d20fdc5f706",
      "text": "http://0.0.0.0:8080/",
      "size": "wide",
      "width": 416,
      "height": 160,
      "url": "/assets/plugins/image/ec74a626524a24c34b96701737edd31b.jpg"
    },
    {
      "type": "image",
      "id": "58b835eb18c4a5dd",
      "text": "todo_list.cljc",
      "size": "wide",
      "width": 416,
      "height": 266,
      "url": "/assets/plugins/image/cfe14509448f4caad652d2fd86b697f7.jpg"
    },
    {
      "type": "markdown",
      "id": "f7ad63b82b49b7b9",
      "text": "# Deployment"
    },
    {
      "type": "paragraph",
      "id": "7a95ec46d143af5e",
      "text": "ClojureScript optimized build, Dockerfile, Uberjar, Github actions CD to [[Fly.io]]"
    },
    {
      "type": "code",
      "id": "697b03d560105bb3",
      "text": "HYPERFIDDLE_ELECTRIC_APP_VERSION=`git describe --tags --long --always --dirty`\nclojure -X:build build-client          # optimized release build\nclojure -X:build uberjar :jar-name \"app.jar\" :version '\"'$HYPERFIDDLE_ELECTRIC_APP_VERSION'\"'\njava -DHYPERFIDDLE_ELECTRIC_SERVER_VERSION=$HYPERFIDDLE_ELECTRIC_APP_VERSION -jar app.jar"
    },
    {
      "type": "code",
      "id": "f1739578a4a1d005",
      "text": "docker build --progress=plain --build-arg VERSION=\"$HYPERFIDDLE_ELECTRIC_APP_VERSION\" -t electric-starter-app .\ndocker run --rm -p 7070:8080 electric-starter-app"
    },
    {
      "type": "code",
      "id": "ee7409990679f247",
      "text": "# flyctl launch ... ? create fly app, generate fly.toml, see dashboard\n# https://fly.io/apps/electric-starter-app\n\nNO_COLOR=1 flyctl deploy --build-arg VERSION=\"$HYPERFIDDLE_ELECTRIC_APP_VERSION\"\n# https://electric-starter-app.fly.dev/"
    },
    {
      "type": "markdown",
      "id": "a8d4cfaf7e93211c",
      "text": "- `NO_COLOR=1` disables docker-cli fancy shell GUI, so that we see the full log (not paginated) in case of exception\n- `--build-only` tests the build on fly.io without deploying"
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "electric-starter-app",
        "story": []
      },
      "date": 1684829449467
    },
    {
      "item": {
        "type": "factory",
        "id": "86de70dc929d8388"
      },
      "id": "86de70dc929d8388",
      "type": "add",
      "date": 1684829463393
    },
    {
      "type": "edit",
      "id": "86de70dc929d8388",
      "item": {
        "type": "paragraph",
        "id": "86de70dc929d8388",
        "text": "[https://github.com/hyperfiddle/electric-starter-app github]"
      },
      "date": 1684829468545
    },
    {
      "item": {
        "type": "factory",
        "id": "9ddcfb930cbed76f"
      },
      "id": "9ddcfb930cbed76f",
      "type": "add",
      "after": "86de70dc929d8388",
      "date": 1684829479992
    },
    {
      "type": "edit",
      "id": "9ddcfb930cbed76f",
      "item": {
        "type": "code",
        "id": "9ddcfb930cbed76f",
        "text": "clj -A:dev -X user/main"
      },
      "date": 1684829482061
    },
    {
      "item": {
        "type": "factory",
        "id": "0c5d6d20fdc5f706"
      },
      "id": "0c5d6d20fdc5f706",
      "type": "add",
      "after": "9ddcfb930cbed76f",
      "date": 1684829617773
    },
    {
      "type": "edit",
      "id": "0c5d6d20fdc5f706",
      "item": {
        "type": "image",
        "id": "0c5d6d20fdc5f706",
        "text": "Uploaded image",
        "size": "wide",
        "width": 416,
        "height": 160,
        "url": "/assets/plugins/image/ec74a626524a24c34b96701737edd31b.jpg"
      },
      "date": 1684829672077
    },
    {
      "type": "edit",
      "id": "0c5d6d20fdc5f706",
      "item": {
        "type": "image",
        "id": "0c5d6d20fdc5f706",
        "text": "http://0.0.0.0:8080/",
        "size": "wide",
        "width": 416,
        "height": 160,
        "url": "/assets/plugins/image/ec74a626524a24c34b96701737edd31b.jpg"
      },
      "date": 1684829677874
    },
    {
      "type": "edit",
      "id": "86de70dc929d8388",
      "item": {
        "type": "paragraph",
        "id": "86de70dc929d8388",
        "text": "hyperfiddle / electric-starter-app [https://github.com/hyperfiddle/electric-starter-app github]"
      },
      "date": 1684829705026
    },
    {
      "item": {
        "type": "factory",
        "id": "58b835eb18c4a5dd"
      },
      "id": "58b835eb18c4a5dd",
      "type": "add",
      "after": "0c5d6d20fdc5f706",
      "date": 1684829893023
    },
    {
      "type": "edit",
      "id": "58b835eb18c4a5dd",
      "item": {
        "type": "image",
        "id": "58b835eb18c4a5dd",
        "text": "Uploaded image",
        "size": "wide",
        "width": 416,
        "height": 266,
        "url": "/assets/plugins/image/cfe14509448f4caad652d2fd86b697f7.jpg"
      },
      "date": 1684829931627
    },
    {
      "type": "edit",
      "id": "58b835eb18c4a5dd",
      "item": {
        "type": "image",
        "id": "58b835eb18c4a5dd",
        "text": "todo_list.cljc",
        "size": "wide",
        "width": 416,
        "height": 266,
        "url": "/assets/plugins/image/cfe14509448f4caad652d2fd86b697f7.jpg"
      },
      "date": 1684829958240
    },
    {
      "item": {
        "type": "factory",
        "id": "f7ad63b82b49b7b9"
      },
      "id": "f7ad63b82b49b7b9",
      "type": "add",
      "after": "58b835eb18c4a5dd",
      "date": 1684851271805
    },
    {
      "type": "edit",
      "id": "f7ad63b82b49b7b9",
      "item": {
        "type": "paragraph",
        "id": "f7ad63b82b49b7b9",
        "text": "Deployment"
      },
      "date": 1684851273694
    },
    {
      "type": "edit",
      "id": "f7ad63b82b49b7b9",
      "item": {
        "type": "paragraph",
        "id": "f7ad63b82b49b7b9",
        "text": "# Deployment"
      },
      "date": 1684851278773
    },
    {
      "item": {
        "type": "factory",
        "id": "7a95ec46d143af5e"
      },
      "id": "7a95ec46d143af5e",
      "type": "add",
      "after": "f7ad63b82b49b7b9",
      "date": 1684851287309
    },
    {
      "type": "edit",
      "id": "7a95ec46d143af5e",
      "item": {
        "type": "paragraph",
        "id": "7a95ec46d143af5e",
        "text": "ClojureScript optimized build, Dockerfile, Uberjar, Github actions CD to fly.io"
      },
      "date": 1684851289693
    },
    {
      "type": "edit",
      "id": "f7ad63b82b49b7b9",
      "item": {
        "type": "markdown",
        "id": "f7ad63b82b49b7b9",
        "text": "# Deployment"
      },
      "date": 1684851290894
    },
    {
      "item": {
        "type": "factory",
        "id": "697b03d560105bb3"
      },
      "id": "697b03d560105bb3",
      "type": "add",
      "after": "7a95ec46d143af5e",
      "date": 1684851297351
    },
    {
      "type": "edit",
      "id": "697b03d560105bb3",
      "item": {
        "type": "code",
        "id": "697b03d560105bb3",
        "text": "HYPERFIDDLE_ELECTRIC_APP_VERSION=`git describe --tags --long --always --dirty`\nclojure -X:build build-client          # optimized release build\nclojure -X:build uberjar :jar-name \"app.jar\" :version '\"'$HYPERFIDDLE_ELECTRIC_APP_VERSION'\"'\njava -DHYPERFIDDLE_ELECTRIC_SERVER_VERSION=$HYPERFIDDLE_ELECTRIC_APP_VERSION -jar app.jar"
      },
      "date": 1684851298865
    },
    {
      "item": {
        "type": "factory",
        "id": "f1739578a4a1d005"
      },
      "id": "f1739578a4a1d005",
      "type": "add",
      "after": "697b03d560105bb3",
      "date": 1684851518381
    },
    {
      "type": "edit",
      "id": "f1739578a4a1d005",
      "item": {
        "type": "code",
        "id": "f1739578a4a1d005",
        "text": "docker build --progress=plain --build-arg VERSION=\"$HYPERFIDDLE_ELECTRIC_APP_VERSION\" -t electric-starter-app .\ndocker run --rm -p 7070:8080 electric-starter-app"
      },
      "date": 1684851520852
    },
    {
      "item": {
        "type": "factory",
        "id": "3ff0e83a75d2af0b"
      },
      "id": "3ff0e83a75d2af0b",
      "type": "add",
      "after": "f1739578a4a1d005",
      "date": 1684851545097
    },
    {
      "type": "edit",
      "id": "3ff0e83a75d2af0b",
      "item": {
        "type": "paragraph",
        "id": "3ff0e83a75d2af0b",
        "text": "docker build --progress=plain --build-arg VERSION=\"$HYPERFIDDLE_ELECTRIC_APP_VERSION\" -t electric-starter-app .\ndocker run --rm -p 7070:8080 electric-starter-app"
      },
      "date": 1684851547785
    },
    {
      "item": {
        "type": "factory",
        "id": "a8d4cfaf7e93211c"
      },
      "id": "a8d4cfaf7e93211c",
      "type": "add",
      "after": "3ff0e83a75d2af0b",
      "date": 1684851585998
    },
    {
      "type": "edit",
      "id": "a8d4cfaf7e93211c",
      "item": {
        "type": "markdown",
        "id": "a8d4cfaf7e93211c",
        "text": "- `NO_COLOR=1` disables docker-cli fancy shell GUI, so that we see the full log (not paginated) in case of exception\n- `--build-only` tests the build on fly.io without deploying"
      },
      "date": 1684851589691
    },
    {
      "type": "remove",
      "id": "3ff0e83a75d2af0b",
      "date": 1684851596620
    },
    {
      "item": {
        "type": "factory",
        "id": "ee7409990679f247"
      },
      "id": "ee7409990679f247",
      "type": "add",
      "after": "a8d4cfaf7e93211c",
      "date": 1684851614678
    },
    {
      "id": "ee7409990679f247",
      "type": "move",
      "order": [
        "86de70dc929d8388",
        "9ddcfb930cbed76f",
        "0c5d6d20fdc5f706",
        "58b835eb18c4a5dd",
        "f7ad63b82b49b7b9",
        "7a95ec46d143af5e",
        "697b03d560105bb3",
        "f1739578a4a1d005",
        "ee7409990679f247",
        "a8d4cfaf7e93211c"
      ],
      "date": 1684851616722
    },
    {
      "type": "edit",
      "id": "ee7409990679f247",
      "item": {
        "type": "code",
        "id": "ee7409990679f247",
        "text": "# flyctl launch ... ? create fly app, generate fly.toml, see dashboard\n# https://fly.io/apps/electric-starter-app\n\nNO_COLOR=1 flyctl deploy --build-arg VERSION=\"$HYPERFIDDLE_ELECTRIC_APP_VERSION\"\n# https://electric-starter-app.fly.dev/"
      },
      "date": 1684851619198
    },
    {
      "type": "edit",
      "id": "7a95ec46d143af5e",
      "item": {
        "type": "paragraph",
        "id": "7a95ec46d143af5e",
        "text": "ClojureScript optimized build, Dockerfile, Uberjar, Github actions CD to [[Fly.io]]"
      },
      "date": 1684851676363
    }
  ]
}