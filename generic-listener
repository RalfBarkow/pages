{
  "title": "Generic Listener",
  "story": [
    {
      "type": "html",
      "text": "<b>Context</b>",
      "id": "7f77f0bdb9ccc83e128ac134ec3c9b36"
    },
    {
      "type": "html",
      "text": " APIs in Java often require listeners to implement a specific interface.",
      "id": "4f38124242552ea018560879f757be31"
    },
    {
      "type": "html",
      "text": " Listener interfaces are often quite similar, varying generally in the name of the method, and the manner in which context is given.",
      "id": "0af0fa040082a0c3748f40fd4c4d18b2"
    },
    {
      "type": "html",
      "text": " Different levels of abstraction may need semantically different but functionally equivalent listener interfaces.",
      "id": "d3f86925a7563c4dcec644d69010f2c5"
    },
    {
      "type": "html",
      "text": " Many possible events may result very similar reactions.",
      "id": "a7bdd1d31d610114db1056eae981368f"
    },
    {
      "type": "html",
      "text": "<b>Problem</b>",
      "id": "9ecfd3da439cbfdb03b077a8fa1cdb7b"
    },
    {
      "type": "html",
      "text": " The typical method of defining a specific listener class for each type of listener required can become cumbersome, especially if the same behaviour needs to be implemented through several interfaces, or levels of abstraction.",
      "id": "c8765533d8a61da245350eba8de47e9e"
    },
    {
      "type": "html",
      "text": "<b>Forces</b>",
      "id": "35e472dc8151170be9f13c2bea1707b2"
    },
    {
      "type": "html",
      "text": " A common listener interface would be beneficial.",
      "id": "c7969f9dfd4da174d994a6d7bd09beae"
    },
    {
      "type": "html",
      "text": " Listener interface names tend to be nondescriptive, showing the 'what', but not the 'why'.",
      "id": "53c8f18013fb438d8afbb74f1b93d509"
    },
    {
      "type": "html",
      "text": " A common interface needs to be generally useful to show much benefit.",
      "id": "86e2ed9b099a5d2fba942b778f8c4ddc"
    },
    {
      "type": "html",
      "text": " Tricky non-obvious solutions are hard to follow.",
      "id": "4f291a8e91360af83889911f58576c22"
    },
    {
      "type": "html",
      "text": "<b>Solution</b>",
      "id": "9bf5b24b267d81ec3065d107af635b28"
    },
    {
      "type": "html",
      "text": "\nDefine a base class with an abstract no-arg no-return method, an input member variable, an output member variable, and at least one 'invocation' method, which will populate the input, call the abstract method, and return the contents of the output. Use this base class anywhere you would normally use a typed listener, using an adapter as necessary.  Call the invocation method to notify the listener, passing in the context <i>if necessary.</i>",
      "id": "5e57862107ae4a86497c7256cd8807c6"
    },
    {
      "type": "html",
      "text": "<i>[A question--why would you use member variables?  Why wouldn't the abstract method just take the input context Object as a parameter and return the resulting output Object?  Wouldn't this avoid the clone-on-invocation requirement below?]</i>",
      "id": "c6d02dd508cf3944d07c3275fbdfedcd"
    },
    {
      "type": "html",
      "text": "<b>Example</b>",
      "id": "6c2784ed4b40ca14c220e193ae5e9e83"
    },
    {
      "type": "code",
      "text": " class Something{\n     private Method listener;\n     public void somethingCausingAnEvent(){\n  listener.invoke();\n     }",
      "id": "9d76f961a1217dcd45a7186eca6106b5"
    },
    {
      "type": "code",
      "text": "     public void doWhenSomethingHappens(Method listener){\n  this.listener = listener;\n     }\n }",
      "id": "116196796017bd6a9866e179891b0fe5"
    },
    {
      "type": "code",
      "text": " class E''''''xitProgram extends Method{\n     protected void method(){\n  System.exit(0);\n     }\n }",
      "id": "0762a0c9963008f0785ac8f26d96b263"
    },
    {
      "type": "code",
      "text": " class P''''''rintObject extends Method{\n     protected void method(){\n  System.out.println(parameter);\n     }\n }",
      "id": "0df0c76eb9606a1a2f624caa88e5a85e"
    },
    {
      "type": "code",
      "text": " class Notification extends Method{\n     public synchronized void doWait(){\n        try{\n            wait();\n        }catch(I''''''nterruptedException ignore){\n        }\n     }",
      "id": "587404a5eb260ee9b0ecbd0ba48d7e0f"
    },
    {
      "type": "code",
      "text": "     protected void method(){\n        notifyAll();\n     }\n }",
      "id": "3ad3e8a0270211cc7f75990528806f7b"
    },
    {
      "type": "code",
      "text": " class Method {\n     private Object parameter;\n     private Object returnValue;\n     public Object invoke(){\n  invoke(null);\n     }",
      "id": "c5147dd7473210632d794a60c00bb96c"
    },
    {
      "type": "code",
      "text": "     public Object invoke(Object parameter){\n  this.parameter = parameter;\n  method();\n  return returnValue;\n     }",
      "id": "d33c0588090f7fd4bbf9d3fc4db5493e"
    },
    {
      "type": "code",
      "text": "     protected abstract void method();\n }",
      "id": "88aa4cb44faf70d0f267ac59427efe17"
    },
    {
      "type": "html",
      "text": "<b>Resulting Context</b>",
      "id": "06466e31564388a0dae5fa0712b2c0b9"
    },
    {
      "type": "html",
      "text": " Listener code becomes reusable.  ",
      "id": "82125fbef3bc5a2238643c7b479be74e"
    },
    {
      "type": "html",
      "text": " Listener classes become named for their effects (i.e., a good name for a method), not for the events that cause them.",
      "id": "2b7c3522cfd26533884aa895822fc229"
    },
    {
      "type": "html",
      "text": " A small set of test and utility Methods can be created, as opposed to creating different ones for every use.",
      "id": "cf2beaad38603fd6d80a0e222241bad1"
    },
    {
      "type": "html",
      "text": " High level listeners can be passed directly through to the low level events which cause them, without breaking encapsulation.",
      "id": "0aa1d9d66fec3b78191042c83b777e22"
    },
    {
      "type": "html",
      "text": " A [[Generic Listener Collection]] becomes trivially easy to create, and allows for some neat tricks as well :)",
      "id": "57856741ccab851b245ee6f10f8e7144"
    },
    {
      "type": "html",
      "text": " Not very common, and therefore could become a source of confusion.",
      "id": "4be84691217ceef681ec573b3ecc6e44"
    },
    {
      "type": "html",
      "text": " Parameters must be passed in as Object, this can require some casting... then again, I've found it lends a degree of dynamisism that is often lacking from Java.",
      "id": "af3fded49e3266b5a5dcf16ed47180f1"
    },
    {
      "type": "html",
      "text": " Threading issues need to be considered. A naive implementation, although fine for many purposes, is specifically thread-unsafe. Generally, a thread safe version will clone the method on every invocation (similar to creating a new stack frame for a normal method invocation).",
      "id": "e5bb45b5ca648f8ec621bc6871a77e4b"
    },
    {
      "type": "html",
      "text": " 'addActionListener(new A<b></b>ctionListener(){...});' methods start turning into 'doWhenButtonClicked(new C<b></b>loseProgram());'... they get treated more like normal methods than blobs of code inside a method.",
      "id": "86a6b8fad497cf48bbc7fd58cce62797"
    },
    {
      "type": "html",
      "text": " Gives a nice little bit of simulated [[Dynamic Typing]] in a [[Stubbornly Static Typed]] language.",
      "id": "446c4cf3eaf69fbf023adc3185adcc22"
    },
    {
      "type": "html",
      "text": "<b>Known Uses</b>",
      "id": "45dc0f8a7137ef51ba5eea67d1699fe3"
    },
    {
      "type": "html",
      "text": "\nCurrently it's making appearances in my personal Collections implementations (forEach() type stuff), listeners, instead of the occasional global variable (pass in a method which will return the current [[Foo Bar]], even if you don't know which one it'll be yet). Don't think this quite qualifies as three distinct uses though :)",
      "id": "21c373e9324c502e0a70f2dd5ea5e095"
    },
    {
      "type": "html",
      "text": "<b>Related Patterns</b>",
      "id": "9a0b7788b52e6ceb376acfcdf57a93cc"
    },
    {
      "type": "html",
      "text": " Basically, a specialization (of purpose) / generalization (of form) of a [[Method Object]]... blocks for Java.",
      "id": "b71b8380a5abc5bdf05727aaf691a43a"
    },
    {
      "type": "html",
      "text": " [[Generic Listener Collection]] (when I get to writing it... couple of interesting things there :)",
      "id": "dd6246a313b449cb458dbf4da5333d34"
    },
    {
      "type": "html",
      "text": "-- [[William Underwood]]",
      "id": "0a5ecabb45ccf9c08bca00d9e8ce86ba"
    },
    {
      "type": "html",
      "text": "<hr>",
      "id": "7cea50e4f815e522a738f0e2cc6466f1"
    },
    {
      "type": "html",
      "text": "[[Category Java]]",
      "id": "3a91d951ecd0ede84382d9dde6ce560e"
    },
    {
      "type": "html",
      "text": "See original on  [http://c2.com/cgi/wiki?GenericListener c2.com]",
      "id": "141d44db82a04e279dea898c2fad650e"
    }
  ],
  "journal": [
    {
      "date": 1419198203000,
      "id": "624c8d4014de7aa088657e33e8106c4a",
      "type": "create",
      "item": {
        "title": "Generic Listener",
        "story": [
          {
            "type": "html",
            "text": "<b>Context</b>",
            "id": "7f77f0bdb9ccc83e128ac134ec3c9b36"
          },
          {
            "type": "html",
            "text": " APIs in Java often require listeners to implement a specific interface.",
            "id": "4f38124242552ea018560879f757be31"
          },
          {
            "type": "html",
            "text": " Listener interfaces are often quite similar, varying generally in the name of the method, and the manner in which context is given.",
            "id": "0af0fa040082a0c3748f40fd4c4d18b2"
          },
          {
            "type": "html",
            "text": " Different levels of abstraction may need semantically different but functionally equivalent listener interfaces.",
            "id": "d3f86925a7563c4dcec644d69010f2c5"
          },
          {
            "type": "html",
            "text": " Many possible events may result very similar reactions.",
            "id": "a7bdd1d31d610114db1056eae981368f"
          },
          {
            "type": "html",
            "text": "<b>Problem</b>",
            "id": "9ecfd3da439cbfdb03b077a8fa1cdb7b"
          },
          {
            "type": "html",
            "text": " The typical method of defining a specific listener class for each type of listener required can become cumbersome, especially if the same behaviour needs to be implemented through several interfaces, or levels of abstraction.",
            "id": "c8765533d8a61da245350eba8de47e9e"
          },
          {
            "type": "html",
            "text": "<b>Forces</b>",
            "id": "35e472dc8151170be9f13c2bea1707b2"
          },
          {
            "type": "html",
            "text": " A common listener interface would be beneficial.",
            "id": "c7969f9dfd4da174d994a6d7bd09beae"
          },
          {
            "type": "html",
            "text": " Listener interface names tend to be nondescriptive, showing the 'what', but not the 'why'.",
            "id": "53c8f18013fb438d8afbb74f1b93d509"
          },
          {
            "type": "html",
            "text": " A common interface needs to be generally useful to show much benefit.",
            "id": "86e2ed9b099a5d2fba942b778f8c4ddc"
          },
          {
            "type": "html",
            "text": " Tricky non-obvious solutions are hard to follow.",
            "id": "4f291a8e91360af83889911f58576c22"
          },
          {
            "type": "html",
            "text": "<b>Solution</b>",
            "id": "9bf5b24b267d81ec3065d107af635b28"
          },
          {
            "type": "html",
            "text": "\nDefine a base class with an abstract no-arg no-return method, an input member variable, an output member variable, and at least one 'invocation' method, which will populate the input, call the abstract method, and return the contents of the output. Use this base class anywhere you would normally use a typed listener, using an adapter as necessary.  Call the invocation method to notify the listener, passing in the context <i>if necessary.</i>",
            "id": "5e57862107ae4a86497c7256cd8807c6"
          },
          {
            "type": "html",
            "text": "<i>[A question--why would you use member variables?  Why wouldn't the abstract method just take the input context Object as a parameter and return the resulting output Object?  Wouldn't this avoid the clone-on-invocation requirement below?]</i>",
            "id": "c6d02dd508cf3944d07c3275fbdfedcd"
          },
          {
            "type": "html",
            "text": "<b>Example</b>",
            "id": "6c2784ed4b40ca14c220e193ae5e9e83"
          },
          {
            "type": "code",
            "text": " class Something{\n     private Method listener;\n     public void somethingCausingAnEvent(){\n  listener.invoke();\n     }",
            "id": "9d76f961a1217dcd45a7186eca6106b5"
          },
          {
            "type": "code",
            "text": "     public void doWhenSomethingHappens(Method listener){\n  this.listener = listener;\n     }\n }",
            "id": "116196796017bd6a9866e179891b0fe5"
          },
          {
            "type": "code",
            "text": " class E''''''xitProgram extends Method{\n     protected void method(){\n  System.exit(0);\n     }\n }",
            "id": "0762a0c9963008f0785ac8f26d96b263"
          },
          {
            "type": "code",
            "text": " class P''''''rintObject extends Method{\n     protected void method(){\n  System.out.println(parameter);\n     }\n }",
            "id": "0df0c76eb9606a1a2f624caa88e5a85e"
          },
          {
            "type": "code",
            "text": " class Notification extends Method{\n     public synchronized void doWait(){\n        try{\n            wait();\n        }catch(I''''''nterruptedException ignore){\n        }\n     }",
            "id": "587404a5eb260ee9b0ecbd0ba48d7e0f"
          },
          {
            "type": "code",
            "text": "     protected void method(){\n        notifyAll();\n     }\n }",
            "id": "3ad3e8a0270211cc7f75990528806f7b"
          },
          {
            "type": "code",
            "text": " class Method {\n     private Object parameter;\n     private Object returnValue;\n     public Object invoke(){\n  invoke(null);\n     }",
            "id": "c5147dd7473210632d794a60c00bb96c"
          },
          {
            "type": "code",
            "text": "     public Object invoke(Object parameter){\n  this.parameter = parameter;\n  method();\n  return returnValue;\n     }",
            "id": "d33c0588090f7fd4bbf9d3fc4db5493e"
          },
          {
            "type": "code",
            "text": "     protected abstract void method();\n }",
            "id": "88aa4cb44faf70d0f267ac59427efe17"
          },
          {
            "type": "html",
            "text": "<b>Resulting Context</b>",
            "id": "06466e31564388a0dae5fa0712b2c0b9"
          },
          {
            "type": "html",
            "text": " Listener code becomes reusable.  ",
            "id": "82125fbef3bc5a2238643c7b479be74e"
          },
          {
            "type": "html",
            "text": " Listener classes become named for their effects (i.e., a good name for a method), not for the events that cause them.",
            "id": "2b7c3522cfd26533884aa895822fc229"
          },
          {
            "type": "html",
            "text": " A small set of test and utility Methods can be created, as opposed to creating different ones for every use.",
            "id": "cf2beaad38603fd6d80a0e222241bad1"
          },
          {
            "type": "html",
            "text": " High level listeners can be passed directly through to the low level events which cause them, without breaking encapsulation.",
            "id": "0aa1d9d66fec3b78191042c83b777e22"
          },
          {
            "type": "html",
            "text": " A [[Generic Listener Collection]] becomes trivially easy to create, and allows for some neat tricks as well :)",
            "id": "57856741ccab851b245ee6f10f8e7144"
          },
          {
            "type": "html",
            "text": " Not very common, and therefore could become a source of confusion.",
            "id": "4be84691217ceef681ec573b3ecc6e44"
          },
          {
            "type": "html",
            "text": " Parameters must be passed in as Object, this can require some casting... then again, I've found it lends a degree of dynamisism that is often lacking from Java.",
            "id": "af3fded49e3266b5a5dcf16ed47180f1"
          },
          {
            "type": "html",
            "text": " Threading issues need to be considered. A naive implementation, although fine for many purposes, is specifically thread-unsafe. Generally, a thread safe version will clone the method on every invocation (similar to creating a new stack frame for a normal method invocation).",
            "id": "e5bb45b5ca648f8ec621bc6871a77e4b"
          },
          {
            "type": "html",
            "text": " 'addActionListener(new A<b></b>ctionListener(){...});' methods start turning into 'doWhenButtonClicked(new C<b></b>loseProgram());'... they get treated more like normal methods than blobs of code inside a method.",
            "id": "86a6b8fad497cf48bbc7fd58cce62797"
          },
          {
            "type": "html",
            "text": " Gives a nice little bit of simulated [[Dynamic Typing]] in a [[Stubbornly Static Typed]] language.",
            "id": "446c4cf3eaf69fbf023adc3185adcc22"
          },
          {
            "type": "html",
            "text": "<b>Known Uses</b>",
            "id": "45dc0f8a7137ef51ba5eea67d1699fe3"
          },
          {
            "type": "html",
            "text": "\nCurrently it's making appearances in my personal Collections implementations (forEach() type stuff), listeners, instead of the occasional global variable (pass in a method which will return the current [[Foo Bar]], even if you don't know which one it'll be yet). Don't think this quite qualifies as three distinct uses though :)",
            "id": "21c373e9324c502e0a70f2dd5ea5e095"
          },
          {
            "type": "html",
            "text": "<b>Related Patterns</b>",
            "id": "9a0b7788b52e6ceb376acfcdf57a93cc"
          },
          {
            "type": "html",
            "text": " Basically, a specialization (of purpose) / generalization (of form) of a [[Method Object]]... blocks for Java.",
            "id": "b71b8380a5abc5bdf05727aaf691a43a"
          },
          {
            "type": "html",
            "text": " [[Generic Listener Collection]] (when I get to writing it... couple of interesting things there :)",
            "id": "dd6246a313b449cb458dbf4da5333d34"
          },
          {
            "type": "html",
            "text": "-- [[William Underwood]]",
            "id": "0a5ecabb45ccf9c08bca00d9e8ce86ba"
          },
          {
            "type": "html",
            "text": "<hr>",
            "id": "7cea50e4f815e522a738f0e2cc6466f1"
          },
          {
            "type": "html",
            "text": "[[Category Java]]",
            "id": "3a91d951ecd0ede84382d9dde6ce560e"
          },
          {
            "type": "html",
            "text": "See original on  [http://c2.com/cgi/wiki?GenericListener c2.com]",
            "id": "141d44db82a04e279dea898c2fad650e"
          }
        ]
      }
    },
    {
      "type": "fork",
      "site": "sfw.c2.com",
      "date": 1707806859481
    }
  ]
}